<!DOCTYPE html><html lang="en"><head><title>Build Your Team an Accessible, Shareable Component Library</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Use React and TypeScript to build your team an accessible, shareable component library that can be included in as many projects as you can manage."><meta name="author" content="Robert Pearce"><meta name="keywords" content="javascript, react, react library, react component library, component library, storybook, accessibility"><meta name="google-site-verification" content="QX4bn65yOXBfgnwxlO09yIBc1H8blur-Erx3lmsDVhU"><meta http-equiv="origin-trial" content="Am4BZ0c7GMyB72dgo/Ny2FfIFscXhYMoN+CVe4jduWh24FvsaCwf7kjZzHzfrJXtIilyZVAEKRxOItGLY7lvkAgAAABSeyJvcmlnaW4iOiJodHRwczovL3JvYmVydHdwZWFyY2UuY29tOjQ0MyIsImZlYXR1cmUiOiJQb3J0YWxzIiwiZXhwaXJ5IjoxNjAzNTQ2NDc3fQ=="><meta property="og:site_name" content="Robert Pearce"><meta property="og:title" content="Build Your Team an Accessible, Shareable Component Library"><meta property="og:url" content="https://robertwpearce.com/build-your-team-an-accessible-shareable-component-library.html"><meta property="og:description" content="Use React and TypeScript to build your team an accessible, shareable component library that can be included in as many projects as you can manage."><meta property="og:type" content="article"><meta property="twitter:site" content="Robert Pearce"><meta property="twitter:title" content="Build Your Team an Accessible, Shareable Component Library"><meta property="twitter:description" content="Use React and TypeScript to build your team an accessible, shareable component library that can be included in as many projects as you can manage."><meta property="twitter:creator" content="@RobertWPearce"><link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>💾</text></svg>"><link rel="canonical" href="https://robertwpearce.com/build-your-team-an-accessible-shareable-component-library.html"><link rel="alternate" href="./atom.xml" title="Robert Pearce's blog" type="application/atom+xml"><link rel="alternate" href="./rss.xml" title="Robert Pearce's blog" type="application/rss+xml"><link rel="stylesheet" href="./css/base.css"><link rel="stylesheet" href="./css/t-clean.css"><link rel="stylesheet" href="./css/t-clean-note.css"><link rel="stylesheet" href="./css/t-code-dracula.css"><link rel="prefetch" href="./css/t-clean-note.css"></head><body data-theme="clean-night"><script> (() => { window.site = { prefFont: localStorage.getItem('prefFont') || 'monospace', setFont: (family) => { localStorage.setItem('prefFont', family); const rootStyle = document.querySelector(':root').style; rootStyle.setProperty('--type-family-body', family+',monospace'); /* Remove when https://github.com/googlefonts/spacemono/pull/2 is resolved */ if (family === 'Liga Space Mono') { rootStyle.setProperty('font-feature-settings', '"liga" 0'); } else { rootStyle.removeProperty('font-feature-settings'); } return window.site._fetchFont(family); }, prefTheme: localStorage.getItem('prefTheme') || (matchMedia('(prefers-color-scheme: dark)').matches ? 'clean-night' : 'clean-day'), setTheme: (name) => { const rootStyle = document.querySelector(':root').style; if (name === 'clean-night') { rootStyle.removeProperty('color-scheme'); } else { rootStyle.setProperty('color-scheme', 'light'); } document.body.setAttribute('data-theme', name); localStorage.setItem('prefTheme', name); }, _fetchFont: (family) => { if (family === 'monospace') { return Promise.resolve(); } const familyNoSpaces = family.replaceAll(' ', ''); const fontz = [ new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-Regular.woff2") format("woff2")', { display: 'swap', weight: 400 }), new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-Bold.woff2") format("woff2")', { display: 'swap', weight: 700 }), ]; if (family !== 'Fira Code') { fontz.push( new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-Italic.woff2") format("woff2")', { display: 'swap', style: 'italic', weight: 400 }), new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-BoldItalic.woff2") format("woff2")', { display: 'swap', style: 'italic', weight: 700 }) ); } for (const f of fontz) { document.fonts.add(f); } return Promise.allSettled(fontz).then(results => { results.forEach((res, i) => { if (res.status === 'rejected') { console.error('site failed to load font: ' + fontz[i]?.family ?? 'unknown'); } }); }); } }; window.site.setTheme(window.site.prefTheme); window.site.setFont(window.site.prefFont); })(); </script><header><nav><div class="nav-skip"><a href="#content">Skip to content</a></div><a aria-label="Home" class="nav-home" href="./">~</a><span>/</span></nav><div class="header-extra"><a href="./atom.xml">RSS</a><span aria-hidden="true">&compfn;</span><noscript>(requires JS &rarr;)</noscript><label for="select-theme">Theme</label><select data-select-theme id="select-theme"><option value="clean-day">Clean (Day)</option><option value="clean-night">Clean (Night)</option></select><span aria-hidden="true">&compfn;</span><label for="select-font">Font</label><select data-select-font id="select-font"><option value="monospace">monospace</option><option value="Liga Space Mono">Space Mono</option><option value="Victor Mono">Victor Mono</option><option value="Fira Code">Fira Code</option><option value="JetBrains Mono">JetBrains Mono</option></select></div></header><main id="content"><header data-area="heading"><h1>Build Your Team an Accessible, Shareable Component Library</h1></header><section data-area="meta"><h2>Info</h2><table data-type="cols-y"><tbody><tr><th>Summary</th><td>Use React and TypeScript to build your team an accessible, shareable component library that can be included in as many projects as you can manage.</td></tr><tr><th>Shared</th><td>2020-04-27</td></tr></tbody></table></section><section data-area="note"><p>Today we’re going to dive into building a frontend component library from start to finish that you can share privately with your team or publicly with everyone!</p><p>By the end of this post, you will be able to use <a href="https://www.typescriptlang.org">TypeScript</a>, <a href="https://github.com/facebook/react">React</a>, <a href="https://github.com/storybookjs/storybook">Storybook</a>, and more to provide a simple way to create accessible components that can be included in all of your projects.</p><p>If you’d like to skip to the code, here is the example component library we’re going to make: <a href="https://github.com/rpearce/example-component-library" class="uri">https://github.com/rpearce/example-component-library</a>.</p><h2 id="overview">Overview</h2><p>This is a big post that covers a lot of ground, so buckle up.</p><ol><li><a href="#when-should-i-make-a-component-library-and-why">When Should I Make a Component Library and Why?</a></li><li><a href="#project-api-usage">Project API (Usage)</a></li><li><a href="#main-project-tools">Main Project Tools</a></li><li><a href="#project-structure">Project Structure</a></li><li><a href="#component-structure">Component Structure</a></li><li><a href="#creating-the-project">Creating the Project</a></li><li><a href="#typescript-setup">TypeScript Setup</a></li><li><a href="#linting-setup">Linting Setup</a></li><li><a href="#testing-setup">Testing Setup</a></li><li><a href="#typescript-setup">Storybook Setup</a></li><li><a href="#an-example-component">An Example Component</a></li><li><a href="#building-our-typescript">Building Our TypeScript</a></li><li><a href="#building-our-css">Building Our CSS</a></li><li><a href="#building-our-stories">Building Our Stories</a></li><li><a href="#continuous-integration-notes">Continuous Integration Notes</a></li><li><a href="#publishing-notes">Publishing Notes</a></li></ol><h2 id="when-should-i-make-a-component-library-and-why">When Should I Make a Component Library and Why?</h2><h3 id="scenario-1-component-entropy">Scenario 1: Component Entropy</h3><p>Components make up large parts of our applications. As projects age, components can become increasingly coupled with other components, business logic, and application state management tools like <a href="https://github.com/reduxjs/redux">redux</a>.</p><p>These components usually start out small, focused, and pure. As time passes and the imperative of timely code delivery takes its toll, these components become harder to compose, harder to reason about, and cause us to yearn for simpler, less-involved times.</p><p>Instead of rewriting those components in place and repeating the same process, consider extracting and developing each one in isolation in a library. This will allow you to keep each one’s surface area small and keep your business logic, state management, routing logic, etc., where it belongs: in your application.</p><p>With this scenario, a good intermediary step, before pulling components into their own project, would be to create a folder in your application for these components and set up a tool like storybook to house the individual examples and compositions of them.</p><h3 id="scenario-2-multiple-projects-or-the-possibility-of-multiple-projects">Scenario 2: Multiple Projects (or The Possibility of Multiple Projects)</h3><p>Consider this exchange:</p><blockquote><p><strong>Them</strong>: You know that spinner/widget/dropdown/search thing we have over here? It looks and works great! We want the same thing over here and over here. How difficult is that?</p><p><strong>Me</strong>: Those are different projects, and that is really more like 4 different components working together, so a) hard to do cleanly but good for the long-term or b) easy (for now) if I copy and paste.</p><p><strong>Them</strong>: We need to ship.</p><p><strong>Me</strong>: Okay, so copy and paste it is…</p></blockquote><p>What’s special about this exchange is that <em>both sets of concerns and perspectives are valid</em>. Software stakeholders typically want and need to ship features and fixes quickly, and they usually want to maintain brand consistency across their ecosystems. Software developers at those companies want to be able to ship features and fixes and maintain brand consistency, but they are also aware of the cost of short-term decision making (this is a way of accruing technical debt).</p><p>We know that even the best code is useless to a business if there are no customers around paying to use it, but we also know that suboptimal tech decision making can grind projects to a halt over time, averting the stakeholder’s directive of shipping features and fixes quickly.</p><p>So what can we do to not only amend the scenario above but also make this undesired state unrepresentable in the future? We can start our projects with an accompanying component library! For existing projects, we can begin moving them in that direction.</p><h2 id="project-api-usage">Project API (Usage)</h2><p>Let’s first define how we are going to include our components in our project.</p><h3 id="js-imports">JS Imports</h3><p>Component JavaScript can be imported in a few different ways:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// import from the main (or module) specification in
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// package.json, depending on your bundler and its version
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-kr">import</span> <span class="pl-p">{</span> <span class="pl-nx">Circle</span> <span class="pl-p">}</span> <span class="pl-nx">from</span> <span class="pl-s1">'mylib'</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// straight from the ESModule build
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-kr">import</span> <span class="pl-nx">Circle</span> <span class="pl-nx">from</span> <span class="pl-s1">'mylib/dist/esm/Circle'</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// straight from the CommonJS build
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-kr">import</span> <span class="pl-nx">Circle</span> <span class="pl-nx">from</span> <span class="pl-s1">'mylib/dist/cjs/Circle'</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// straight from the Universal Module Definition build
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-kr">import</span> <span class="pl-nx">Circle</span> <span class="pl-nx">from</span> <span class="pl-s1">'mylib/dist/umd/Circle'</span></span></span></code></pre><h3 id="css-imports">CSS Imports</h3><p>Component CSS can be imported like this:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-kr">import</span> <span class="pl-s1">'mylib/dist/css/Circle/styles.css'</span></span></span></code></pre><p>If you know you will use all of the components and wish to import all of their CSS at once:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-kr">import</span> <span class="pl-s1">'mylib/dist/css/styles.css'</span></span></span></code></pre><p>The JS import is simple enough, but you might be wondering, “What’s the deal with importing CSS like this? I thought we were on to things like styled-components, emotion, CSS modules, etc?”</p><p>These tools are great if the consuming application can bundle up and inject the styles using the same instance of the tool, but can you guarantee each app will use these same styling tools? If so, by all means go that direction. However, if your library is injecting its own styles into the document at runtime, you will not only potentially run into style specificity / collision issues if you don’t have the application styles load last, but strict content security policies will potentially disallow the dynamically added styles from even being applied!</p><p>The solution? Go with the lowest common denominator: regular, vanilla CSS (or something that outputs regular, vanilla CSS). We’ll come back to this in <a href="#an-example-component">the example component section</a>.</p><h2 id="main-project-tools">Main Project Tools</h2><p>It’s time to build the project! Here are the main tools we will use:</p><ul><li><a href="https://nodejs.org/en/">NodeJS</a> (version <code>13.13.0</code>)</li><li><a href="https://www.typescriptlang.org">TypeScript</a></li><li><a href="https://github.com/facebook/react">React</a></li><li><a href="https://github.com/storybookjs/storybook">Storybook (UI examples)</a></li><li><a href="https://github.com/facebook/jest">jest</a> (testing)</li><li><a href="https://github.com/dequelabs/axe-core">axe-core</a> (testing accessibility)</li><li>linting <ul><li><a href="https://github.com/eslint/eslint">eslint</a> with <a href="https://github.com/prettier/prettier">prettier</a></li><li><a href="https://www.npmjs.com/package/husky">husky</a> with <a href="https://www.npmjs.com/package/lint-staged">lint-staged</a>; only on <code>pre-push</code></li></ul></li></ul><h2 id="project-structure">Project Structure</h2><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">.
</span></span><span class="pl-line"><span class="pl-cl">├── .storybook            (1)
</span></span><span class="pl-line"><span class="pl-cl">│   └── ...
</span></span><span class="pl-line"><span class="pl-cl">├── dist                  (2)
</span></span><span class="pl-line"><span class="pl-cl">│   └── ...
</span></span><span class="pl-line"><span class="pl-cl">├── docs                  (3)
</span></span><span class="pl-line"><span class="pl-cl">│   └── ...
</span></span><span class="pl-line"><span class="pl-cl">├── examples              (4)
</span></span><span class="pl-line"><span class="pl-cl">│   └── ...
</span></span><span class="pl-line"><span class="pl-cl">├── scripts
</span></span><span class="pl-line"><span class="pl-cl">│   └── buildCSS          (5)
</span></span><span class="pl-line"><span class="pl-cl">├── source                (6)
</span></span><span class="pl-line"><span class="pl-cl">│   └── ...
</span></span><span class="pl-line"><span class="pl-cl">├── .eslintignore
</span></span><span class="pl-line"><span class="pl-cl">├── .eslintrc.js
</span></span><span class="pl-line"><span class="pl-cl">├── .gitignore
</span></span><span class="pl-line"><span class="pl-cl">├── .prettierrc.js
</span></span><span class="pl-line"><span class="pl-cl">├── CHANGELOG.md          (7)
</span></span><span class="pl-line"><span class="pl-cl">├── LICENSE               (8)
</span></span><span class="pl-line"><span class="pl-cl">├── README.md
</span></span><span class="pl-line"><span class="pl-cl">├── husky.config.js
</span></span><span class="pl-line"><span class="pl-cl">├── jest.config.js
</span></span><span class="pl-line"><span class="pl-cl">├── lint-staged.config.js
</span></span><span class="pl-line"><span class="pl-cl">├── package.json
</span></span><span class="pl-line"><span class="pl-cl">├── testSetup.ts
</span></span><span class="pl-line"><span class="pl-cl">├── tsconfig.base.json    (9)
</span></span><span class="pl-line"><span class="pl-cl">├── tsconfig.cjs.json
</span></span><span class="pl-line"><span class="pl-cl">├── tsconfig.esm.json
</span></span><span class="pl-line"><span class="pl-cl">├── tsconfig.json
</span></span><span class="pl-line"><span class="pl-cl">└── tsconfig.umd.json</span></span></code></pre><ol><li><code>.storybook/</code> – storybook examples configuration</li><li><code>dist/</code> – compiled project output</li><li><code>docs/</code> – compiled storybook examples output</li><li><code>examples/</code> – add <code>create-react-app</code>, <code>gatsby</code>, and other example projects here</li><li><code>scripts/buildCSS</code> – store build scripts here like this CSS-related one</li><li><code>source/</code> – where your project lives; we’ll dive into this in the next section</li><li><code>CHANGELOG.md</code> – be a good teammate and document your library’s changes; very useful for your teams and useful if you decide to open source the project</li><li><code>LICENSE</code> – a good idea if you plan to open source; otherwise, put <code>UNLICENSED</code> in your <code>package.json</code> license field</li><li><code>tsconfig.json</code>, et al – typescript build configs; we’ll dive into this in <a href="#project-setup">the project setup section</a></li></ol><h2 id="component-structure">Component Structure</h2><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">.
</span></span><span class="pl-line"><span class="pl-cl">└── source
</span></span><span class="pl-line"><span class="pl-cl">    └── ComponentA
</span></span><span class="pl-line"><span class="pl-cl">        ├── __snapshots__
</span></span><span class="pl-line"><span class="pl-cl">        │   └── test.tsx.snap
</span></span><span class="pl-line"><span class="pl-cl">        ├── index.tsx
</span></span><span class="pl-line"><span class="pl-cl">        ├── stories.tsx
</span></span><span class="pl-line"><span class="pl-cl">        ├── styles.css
</span></span><span class="pl-line"><span class="pl-cl">        └── test.tsx
</span></span><span class="pl-line"><span class="pl-cl">    └── ComponentB
</span></span><span class="pl-line"><span class="pl-cl">        └── ...
</span></span><span class="pl-line"><span class="pl-cl">    └── ComponentC
</span></span><span class="pl-line"><span class="pl-cl">        └── ...
</span></span><span class="pl-line"><span class="pl-cl">    ├── index.ts
</span></span><span class="pl-line"><span class="pl-cl">    └── test.tsx</span></span></code></pre><p>The component and everything to do with it are co-located in the <code>source/ComponentA/</code> folder: * <code>index.tsx</code> component file (and any additional component files) * storybook stories * CSS * tests</p><p>This grouping of everything having to do with a component makes it very easy to find everything you need. If you would prefer a different setup, you can adjust the tool configurations however you like.</p><p>Each component is then exported from the main <code>index.ts</code> file.</p><p>It’s now time to start the project from scratch and make this outline a reality!</p><h2 id="creating-the-project">Creating the Project</h2><p>To begin, let’s create the project and a <code>package.json</code> file with some project-related information:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">$ mkdir example-component-library &amp;&amp; cd $_
</span></span><span class="pl-line"><span class="pl-cl">$ touch package.json</span></span></code></pre><p>And in <code>package.json</code>:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"name"</span><span class="pl-o">:</span> <span class="pl-s2">"@yournpm/example-component-library"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"version"</span><span class="pl-o">:</span> <span class="pl-s2">"0.1.0"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"description"</span><span class="pl-o">:</span> <span class="pl-s2">"Example repository for a shared React components library"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"main"</span><span class="pl-o">:</span> <span class="pl-s2">"dist/cjs/index.js"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"module"</span><span class="pl-o">:</span> <span class="pl-s2">"dist/esm/index.js"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"repository"</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s2">"type"</span><span class="pl-o">:</span> <span class="pl-s2">"git"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s2">"url"</span><span class="pl-o">:</span> <span class="pl-s2">"git@github.com:yourgithub/example-component-library.git"</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">},</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"homepage"</span><span class="pl-o">:</span> <span class="pl-s2">"https://github.com/yourgithub/example-component-library"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"bugs"</span><span class="pl-o">:</span> <span class="pl-s2">"https://github.com/yourgithub/example-component-library"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"author"</span><span class="pl-o">:</span> <span class="pl-s2">"Your Name &lt;you@youremail.com&gt;"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"license"</span><span class="pl-o">:</span> <span class="pl-s2">"BSD-3"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"keywords"</span><span class="pl-o">:</span> <span class="pl-p">[],</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"tags"</span><span class="pl-o">:</span> <span class="pl-p">[],</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"sideEffects"</span><span class="pl-o">:</span> <span class="pl-p">[</span><span class="pl-s2">"dist/**/*.css"</span><span class="pl-p">],</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"files"</span><span class="pl-o">:</span> <span class="pl-p">[</span><span class="pl-s2">"LICENSE"</span><span class="pl-p">,</span> <span class="pl-s2">"dist/"</span><span class="pl-p">],</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"scripts"</span><span class="pl-o">:</span> <span class="pl-p">{},</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"devDependencies"</span><span class="pl-o">:</span> <span class="pl-p">{},</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"peerDependencies"</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s2">"react"</span><span class="pl-o">:</span> <span class="pl-s2">"*"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s2">"react-dom"</span><span class="pl-o">:</span> <span class="pl-s2">"*"</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">},</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"dependencies"</span><span class="pl-o">:</span> <span class="pl-p">{}</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">}</span></span></span></code></pre><p>Once you save that, run your build tool to make sure everything is ok:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">$ npm install</span></span></code></pre><p>Notably, we’ve set our <code>main</code> field to <code>dist/cjs/index.js</code>, the CommonJS build, for compatibility with NodeJS environments because they don’t yet work well with ESModules. We’ve set our <code>module</code> field to look at <code>dist/esm/index.js</code>, the ESModule build. If you want to make use of the Universal Module Definition build we’ll create later on, you can use the <code>browser</code> field: <code>"browser": "dist/umd/index.js"</code>. Personally, if I build with webpack, I want webpack to select the <code>module</code> field over the <code>browser</code> one because it will always be of a smaller size, for the UMD builds are meant to be run in any of a few different environments.</p><p>Also of importance is the <code>sideEffects</code> field. If our library code was pure and didn’t have side effects, we would set the value to <code>false</code>, and build tools like webpack would prune away all of the unused code. However, since we also are exporting CSS, we need to make sure that it doesn’t get dropped by the build tool, so we do that with <code>"sideEffects": ["dist/**/*.css"]</code>.</p><p>Lastly, we know we’re going to be using React, so we can go ahead and set that as a <code>peerDependency</code> (it’s up to you to decide what versions of React you’ll support).</p><h2 id="typescript-setup">TypeScript Setup</h2><p>We can now add TypeScript to our project with some compiler and project-related options. We’ll also add some type definition libraries that we’ll use later, as well as a dependency on <a href="https://www.npmjs.com/package/tslib"><code>tslib</code></a> to make compiling our code to ES5 seamless.</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">$ npm install --save-dev --save-exact \
</span></span><span class="pl-line"><span class="pl-cl">  @types/node \
</span></span><span class="pl-line"><span class="pl-cl">  @types/react \
</span></span><span class="pl-line"><span class="pl-cl">  @types/react-dom \
</span></span><span class="pl-line"><span class="pl-cl">  typescript
</span></span><span class="pl-line"><span class="pl-cl">$ npm install --save --save-exact tslib
</span></span><span class="pl-line"><span class="pl-cl">$ touch tsconfig.base.json tsconfig.json</span></span></code></pre><p>We will place our <code>compilerOptions</code> in <code>tsconfig.base.json</code> so that they can be extended in all our different builds in the future:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"compilerOptions"</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s2">"allowJs"</span><span class="pl-o">:</span> <span class="pl-kc">false</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s2">"allowSyntheticDefaultImports"</span><span class="pl-o">:</span> <span class="pl-kc">true</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s2">"declaration"</span><span class="pl-o">:</span> <span class="pl-kc">true</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s2">"esModuleInterop"</span><span class="pl-o">:</span> <span class="pl-kc">true</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s2">"importHelpers"</span><span class="pl-o">:</span> <span class="pl-kc">true</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s2">"jsx"</span><span class="pl-o">:</span> <span class="pl-s2">"react"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s2">"lib"</span><span class="pl-o">:</span> <span class="pl-p">[</span><span class="pl-s2">"es2020"</span><span class="pl-p">,</span> <span class="pl-s2">"dom"</span><span class="pl-p">],</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s2">"moduleResolution"</span><span class="pl-o">:</span> <span class="pl-s2">"node"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s2">"noImplicitAny"</span><span class="pl-o">:</span> <span class="pl-kc">true</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s2">"outDir"</span><span class="pl-o">:</span> <span class="pl-s2">"dist/"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s2">"sourceMap"</span><span class="pl-o">:</span> <span class="pl-kc">false</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s2">"strict"</span><span class="pl-o">:</span> <span class="pl-kc">true</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s2">"target"</span><span class="pl-o">:</span> <span class="pl-s2">"es5"</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">}</span></span></span></code></pre><p>Note that the <code>importHelpers</code> flag tells <code>tslib</code> whether it should be enabled or not.</p><p>The <code>tsconfig.json</code> will be used as a default to include our future <code>source</code> directory:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"extends"</span><span class="pl-o">:</span> <span class="pl-s2">"./tsconfig.base.json"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"include"</span><span class="pl-o">:</span> <span class="pl-p">[</span><span class="pl-s2">"source/**/*"</span><span class="pl-p">]</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">}</span></span></span></code></pre><p>We’ll add some more TypeScript-related packages when we get to the tools that need them, and we’ll add more TypeScript build configurations in the section on <a href="#building-our-typescript">building our typescript</a>.</p><h2 id="linting-setup">Linting Setup</h2><p>Linting is a great way to have everyone adhere to the same set of rules for code style. For our project, we’re going to install a few tools to help us out.</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">$ npm install --save-dev --save-exact \
</span></span><span class="pl-line"><span class="pl-cl">  @typescript-eslint/eslint-plugin \
</span></span><span class="pl-line"><span class="pl-cl">  @typescript-eslint/parser \
</span></span><span class="pl-line"><span class="pl-cl">  eslint \
</span></span><span class="pl-line"><span class="pl-cl">  eslint-config-prettier \
</span></span><span class="pl-line"><span class="pl-cl">  eslint-plugin-jest \
</span></span><span class="pl-line"><span class="pl-cl">  eslint-plugin-jsx-a11y \
</span></span><span class="pl-line"><span class="pl-cl">  eslint-plugin-prettier \
</span></span><span class="pl-line"><span class="pl-cl">  eslint-plugin-react \
</span></span><span class="pl-line"><span class="pl-cl">  eslint-plugin-react-hooks \
</span></span><span class="pl-line"><span class="pl-cl">  husky \
</span></span><span class="pl-line"><span class="pl-cl">  lint-staged \
</span></span><span class="pl-line"><span class="pl-cl">  prettier
</span></span><span class="pl-line"><span class="pl-cl">$ touch \
</span></span><span class="pl-line"><span class="pl-cl">  .eslintignore \
</span></span><span class="pl-line"><span class="pl-cl">  .eslintrc.js \
</span></span><span class="pl-line"><span class="pl-cl">  .prettierrc.js \
</span></span><span class="pl-line"><span class="pl-cl">  husky.config.js \
</span></span><span class="pl-line"><span class="pl-cl">  lint-staged.config.js</span></span></code></pre><p>The <code>.eslintignore</code> file will make sure we include files and folders that are ignored by default (using the <code>!</code>) and exclude files and folders that we don’t care about linting.</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">!.eslintrc.js
</span></span><span class="pl-line"><span class="pl-cl">!.prettierrc.js
</span></span><span class="pl-line"><span class="pl-cl">!.storybook/
</span></span><span class="pl-line"><span class="pl-cl">dist/
</span></span><span class="pl-line"><span class="pl-cl">docs/
</span></span><span class="pl-line"><span class="pl-cl">examples/</span></span></code></pre><p>The <code>.eslintrc.js</code> file is something you and your team will need to figure out for yourselves, but here’s where I stand on the issues:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nx">module</span><span class="pl-p">.</span><span class="pl-nx">exports</span> <span class="pl-o">=</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">env</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">browser</span><span class="pl-o">:</span> <span class="pl-kc">true</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">es6</span><span class="pl-o">:</span> <span class="pl-kc">true</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">jest</span><span class="pl-o">:</span> <span class="pl-kc">true</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">node</span><span class="pl-o">:</span> <span class="pl-kc">true</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">},</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-kr">extends</span><span class="pl-o">:</span> <span class="pl-p">[</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s1">'plugin:react/recommended'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s1">'plugin:@typescript-eslint/recommended'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s1">'prettier/@typescript-eslint'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s1">'plugin:prettier/recommended'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s1">'plugin:jsx-a11y/recommended'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">],</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">parserOptions</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">ecmaVersion</span><span class="pl-o">:</span> <span class="pl-mi">2020</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">sourceType</span><span class="pl-o">:</span> <span class="pl-s1">'module'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">},</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">parser</span><span class="pl-o">:</span> <span class="pl-s1">'@typescript-eslint/parser'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">plugins</span><span class="pl-o">:</span> <span class="pl-p">[</span><span class="pl-s1">'jsx-a11y'</span><span class="pl-p">,</span> <span class="pl-s1">'react'</span><span class="pl-p">,</span> <span class="pl-s1">'react-hooks'</span><span class="pl-p">,</span> <span class="pl-s1">'@typescript-eslint'</span><span class="pl-p">],</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">rules</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s1">'@typescript-eslint/no-unused-vars'</span><span class="pl-o">:</span> <span class="pl-s1">'error'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s1">'jsx-quotes'</span><span class="pl-o">:</span> <span class="pl-p">[</span><span class="pl-s1">'error'</span><span class="pl-p">,</span> <span class="pl-s1">'prefer-double'</span><span class="pl-p">],</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s1">'jsx-a11y/no-onchange'</span><span class="pl-o">:</span> <span class="pl-s1">'off'</span><span class="pl-p">,</span> <span class="pl-c1">// https://github.com/evcohen/eslint-plugin-jsx-a11y/issues/398
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>    <span class="pl-s1">'no-trailing-spaces'</span><span class="pl-o">:</span> <span class="pl-s1">'error'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s1">'object-curly-spacing'</span><span class="pl-o">:</span> <span class="pl-p">[</span><span class="pl-s1">'error'</span><span class="pl-p">,</span> <span class="pl-s1">'always'</span><span class="pl-p">],</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">quotes</span><span class="pl-o">:</span> <span class="pl-p">[</span><span class="pl-s1">'error'</span><span class="pl-p">,</span> <span class="pl-s1">'single'</span><span class="pl-p">,</span> <span class="pl-p">{</span> <span class="pl-nx">allowTemplateLiterals</span><span class="pl-o">:</span> <span class="pl-kc">true</span> <span class="pl-p">}],</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s1">'react-hooks/exhaustive-deps'</span><span class="pl-o">:</span> <span class="pl-s1">'error'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s1">'react-hooks/rules-of-hooks'</span><span class="pl-o">:</span> <span class="pl-s1">'error'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s1">'react/prop-types'</span><span class="pl-o">:</span> <span class="pl-s1">'off'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">semi</span><span class="pl-o">:</span> <span class="pl-p">[</span><span class="pl-s1">'error'</span><span class="pl-p">,</span> <span class="pl-s1">'never'</span><span class="pl-p">],</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">},</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">settings</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">react</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-nx">version</span><span class="pl-o">:</span> <span class="pl-s1">'detect'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">},</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">},</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">overrides</span><span class="pl-o">:</span> <span class="pl-p">[</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-nx">files</span><span class="pl-o">:</span> <span class="pl-p">[</span><span class="pl-s1">'*.js'</span><span class="pl-p">,</span> <span class="pl-s1">'*.jsx'</span><span class="pl-p">],</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-nx">rules</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-s1">'@typescript-eslint/explicit-function-return-type'</span><span class="pl-o">:</span> <span class="pl-s1">'off'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-s1">'@typescript-eslint/no-var-requires'</span><span class="pl-o">:</span> <span class="pl-s1">'off'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-p">},</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">},</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">],</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">}</span></span></span></code></pre><p>The <code>.prettierrc.js</code> file defines your <a href="https://github.com/prettier/prettier">prettier</a> configuration:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nx">module</span><span class="pl-p">.</span><span class="pl-nx">exports</span> <span class="pl-o">=</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">semi</span><span class="pl-o">:</span> <span class="pl-kc">false</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">singleQuote</span><span class="pl-o">:</span> <span class="pl-kc">true</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">}</span></span></span></code></pre><p>We’re almost done with the linting! There are two files left.</p><p>For our <code>husky.config.js</code> file, we’ll set it up to run <code>lint-staged</code> before we push our code to our repository:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nx">module</span><span class="pl-p">.</span><span class="pl-nx">exports</span> <span class="pl-o">=</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">hooks</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s1">'pre-push'</span><span class="pl-o">:</span> <span class="pl-s1">'lint-staged'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">},</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">}</span></span></span></code></pre><p>And for <code>lint-staged.config.js</code>, we’ll specify that we want to run <code>eslint --fix</code> on our staged files:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nx">module</span><span class="pl-p">.</span><span class="pl-nx">exports</span> <span class="pl-o">=</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s1">'*'</span><span class="pl-o">:</span> <span class="pl-p">[</span><span class="pl-s1">'eslint --fix'</span><span class="pl-p">],</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">}</span></span></span></code></pre><p>Now that we’ve got this all in place, we can update our <code>package.json</code>’s <code>script</code> object to include a <code>lint</code> command:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-s2">"scripts"</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"lint"</span><span class="pl-o">:</span> <span class="pl-s2">"eslint ."</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">},</span></span></span></code></pre><p>You can test this by running:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">$ npm run lint</span></span></code></pre><h2 id="testing-setup">Testing Setup</h2><p>We’re going to use Jest and <a href="https://testing-library.com/react"><code>@testing-library/react</code></a> to handle running our tests and testing our component code, so let’s install those tools and their companion TypeScript libraries. We’ll also install axe-core to handle some automated accessibility testing.</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">$ npm install --save-dev --save-exact \
</span></span><span class="pl-line"><span class="pl-cl">  @testing-library/jest-dom \
</span></span><span class="pl-line"><span class="pl-cl">  @testing-library/react \
</span></span><span class="pl-line"><span class="pl-cl">  @types/jest \
</span></span><span class="pl-line"><span class="pl-cl">  axe-core \
</span></span><span class="pl-line"><span class="pl-cl">  jest \
</span></span><span class="pl-line"><span class="pl-cl">  ts-jest
</span></span><span class="pl-line"><span class="pl-cl">$ touch jest.config.js testSetup.ts</span></span></code></pre><p>Our <code>jest.config.js</code> collects coverage from the right places, ignores distribution and example directories, requires the <code>testSetup.ts</code> file, and sets us up to use TypeScript in our tests.</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nx">module</span><span class="pl-p">.</span><span class="pl-nx">exports</span> <span class="pl-o">=</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">clearMocks</span><span class="pl-o">:</span> <span class="pl-kc">true</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">collectCoverage</span><span class="pl-o">:</span> <span class="pl-kc">true</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">collectCoverageFrom</span><span class="pl-o">:</span> <span class="pl-p">[</span><span class="pl-s1">'&lt;rootDir&gt;/source/**/*.{ts,tsx}'</span><span class="pl-p">],</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">coveragePathIgnorePatterns</span><span class="pl-o">:</span> <span class="pl-p">[</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s1">'/node_modules/'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s1">'&lt;rootDir&gt;/source/@types'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s1">'stories'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">],</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">moduleNameMapper</span><span class="pl-o">:</span> <span class="pl-p">{},</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">preset</span><span class="pl-o">:</span> <span class="pl-s1">'ts-jest'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">setupFilesAfterEnv</span><span class="pl-o">:</span> <span class="pl-p">[</span><span class="pl-s1">'&lt;rootDir&gt;/testSetup.ts'</span><span class="pl-p">],</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">testPathIgnorePatterns</span><span class="pl-o">:</span> <span class="pl-p">[</span><span class="pl-s1">'dist/'</span><span class="pl-p">,</span> <span class="pl-s1">'examples/'</span><span class="pl-p">],</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">verbose</span><span class="pl-o">:</span> <span class="pl-kc">true</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">}</span></span></span></code></pre><p>And here is our <code>testSetup.ts</code> file that you can use to provide global testing tools, patch JSDOM, and more:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-kr">import</span> <span class="pl-s1">'@testing-library/jest-dom/extend-expect'</span></span></span></code></pre><p>All we do in <code>testSetup.ts</code> is add a lot of custom matchers to the <code>expect</code> function from jest via <a href="https://github.com/testing-library/jest-dom"><code>@testing-library/jest-dom</code></a>.</p><p>While we’re on the testing subject, we should also update our <code>package.json</code>’s <code>scripts</code> object to include a <code>test</code> command:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-s2">"scripts"</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>  <span class="pl-s2">"test"</span><span class="pl-o">:</span> <span class="pl-s2">"jest"</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">},</span></span></span></code></pre><p>We don’t have any test files yet, but you can confirm everything is set up correctly by running</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">$ npm run test</span></span></code></pre><h2 id="storybook-setup">Storybook Setup</h2><p>Storybook is a great way to not only share examples of your components but also get instant feedback while developing them, as well. It also comes with <a href="https://storybook.js.org/addons/">a great set of official addons</a>.</p><p>Let’s install Storybook for React with TypeScript, and let’s also add the addons for accessibility and knobs:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">$ npm install --save-dev --save-exact \
</span></span><span class="pl-line"><span class="pl-cl">  @storybook/addon-a11y \
</span></span><span class="pl-line"><span class="pl-cl">  @storybook/addon-knobs \
</span></span><span class="pl-line"><span class="pl-cl">  @storybook/preset-typescript \
</span></span><span class="pl-line"><span class="pl-cl">  @storybook/react \
</span></span><span class="pl-line"><span class="pl-cl">  babel-loader \
</span></span><span class="pl-line"><span class="pl-cl">  ts-loader
</span></span><span class="pl-line"><span class="pl-cl">$ mkdir .storybook
</span></span><span class="pl-line"><span class="pl-cl">$ touch .storybook/main.js</span></span></code></pre><p>The <code>.storybook/main.js</code> file is where we can specify our Storybook options:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nx">module</span><span class="pl-p">.</span><span class="pl-nx">exports</span> <span class="pl-o">=</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">addons</span><span class="pl-o">:</span> <span class="pl-p">[</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s1">'@storybook/addon-a11y'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s1">'@storybook/addon-knobs'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s1">'@storybook/preset-typescript'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">],</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">stories</span><span class="pl-o">:</span> <span class="pl-p">[</span><span class="pl-s1">'../source/**/*/stories.tsx'</span><span class="pl-p">],</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">}</span></span></span></code></pre><h2 id="an-example-component">An Example Component</h2><p>For our example component, we are going to make a circle with SVG. With only this simple component, we will cover the following aspects of component development: * TypeScript interfaces for required and optional React props * Component CSS * Testing (regular, snapshot, and accessibility) * Storybook examples</p><p>Let’s create the files we know we’re going to need:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">$ mkdir source/Circle
</span></span><span class="pl-line"><span class="pl-cl">$ touch source/Circle/index.tsx \
</span></span><span class="pl-line"><span class="pl-cl">  source/Circle/stories.tsx \
</span></span><span class="pl-line"><span class="pl-cl">  source/Circle/styles.css \
</span></span><span class="pl-line"><span class="pl-cl">  source/Circle/test.tsx</span></span></code></pre><h3 id="component-file">Component File</h3><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-kr">import</span> <span class="pl-nx">React</span><span class="pl-p">,</span> <span class="pl-p">{</span> <span class="pl-nx">FC</span> <span class="pl-p">}</span> <span class="pl-kr">from</span> <span class="pl-s1">'react'</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// className, desc, and fill are optional,
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// whereas title and size are required
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-kr">interface</span> <span class="pl-nx">Props</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">className?</span>: <span class="pl-kt">string</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">desc?</span>: <span class="pl-kt">string</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">fill?</span>: <span class="pl-kt">string</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">size</span>: <span class="pl-kt">number</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">title</span>: <span class="pl-kt">string</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// we provide our Props interface to the
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// function component type
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-kr">const</span> <span class="pl-nx">Circle</span>: <span class="pl-kt">FC</span><span class="pl-p">&lt;</span><span class="pl-nt">Props</span><span class="pl-p">&gt;</span> <span class="pl-o">=</span> <span class="pl-p">({</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">className</span> <span class="pl-o">=</span> <span class="pl-s1">'rl-circle'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">desc</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">fill</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">size</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">title</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">})</span> <span class="pl-o">=&gt;</span> <span class="pl-p">(</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">&lt;</span><span class="pl-nt">svg</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-na">className</span><span class="pl-o">=</span><span class="pl-p">{</span><span class="pl-nx">className</span><span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-na">height</span><span class="pl-o">=</span><span class="pl-p">{</span><span class="pl-nx">size</span><span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-na">fill</span><span class="pl-o">=</span><span class="pl-p">{</span><span class="pl-nx">fill</span><span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-na">role</span><span class="pl-o">=</span><span class="pl-s">"img"</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-na">viewBox</span><span class="pl-o">=</span><span class="pl-s">"0 0 100 100"</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-na">width</span><span class="pl-o">=</span><span class="pl-p">{</span><span class="pl-nx">size</span><span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-na">xmlns</span><span class="pl-o">=</span><span class="pl-s">"http://www.w3.org/2000/svg"</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">&lt;</span><span class="pl-nt">title</span><span class="pl-p">&gt;{</span><span class="pl-nx">title</span><span class="pl-p">}&lt;/</span><span class="pl-nt">title</span><span class="pl-p">&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">{</span><span class="pl-nx">desc</span> <span class="pl-o">&amp;&amp;</span> <span class="pl-p">&lt;</span><span class="pl-nt">desc</span><span class="pl-p">&gt;{</span><span class="pl-nx">desc</span><span class="pl-p">}&lt;/</span><span class="pl-nt">desc</span><span class="pl-p">&gt;}</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">&lt;</span><span class="pl-nt">circle</span> <span class="pl-na">cx</span><span class="pl-o">=</span><span class="pl-s">"50"</span> <span class="pl-na">cy</span><span class="pl-o">=</span><span class="pl-s">"50"</span> <span class="pl-na">r</span><span class="pl-o">=</span><span class="pl-s">"50"</span> <span class="pl-p">/&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">&lt;/</span><span class="pl-nt">svg</span><span class="pl-p">&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">export</span> <span class="pl-k">default</span> <span class="pl-nx">Circle</span></span></span></code></pre><p>In this component file, we define the parameters that we’re willing to work with, provide a fallback in the case of <code>className</code>, and make a regular old component.</p><p>This file should be pretty straightforward, so let’s move on to the CSS!</p><h3 id="component-css">Component CSS</h3><p>This is a real easy one.</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-p">.</span><span class="pl-nc">rl-circle</span> <span class="pl-p">{</span> <span class="pl-k">margin</span><span class="pl-p">:</span> <span class="pl-mi">1</span><span class="pl-kt">em</span><span class="pl-p">;</span> <span class="pl-p">}</span></span></span></code></pre><p>The <code>rl</code> is short for “react library”, and I made it up. The CSS that we are creating needs to be made unique, and prefixing your classes is the simplest way of doing that.</p><h3 id="component-tests">Component Tests</h3><p>It’s time to write some tests! We’re going to make explicit expectations and do some snapshot tests so that everybody is happy.</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-kr">import</span> <span class="pl-nx">React</span> <span class="pl-kr">from</span> <span class="pl-s1">'react'</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">import</span> <span class="pl-p">{</span> <span class="pl-nx">render</span> <span class="pl-p">}</span> <span class="pl-kr">from</span> <span class="pl-s1">'@testing-library/react'</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">import</span> <span class="pl-nx">Circle</span> <span class="pl-kr">from</span> <span class="pl-s1">'./index'</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nx">test</span><span class="pl-p">(</span><span class="pl-s1">'with all props'</span><span class="pl-p">,</span> <span class="pl-p">()</span> <span class="pl-o">=&gt;</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-kr">const</span> <span class="pl-p">{</span> <span class="pl-nx">asFragment</span><span class="pl-p">,</span> <span class="pl-nx">container</span><span class="pl-p">,</span> <span class="pl-nx">getByText</span> <span class="pl-p">}</span> <span class="pl-o">=</span> <span class="pl-nx">render</span><span class="pl-p">(</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">&lt;</span><span class="pl-nt">Circle</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-na">className</span><span class="pl-o">=</span><span class="pl-s">"class-override"</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-na">desc</span><span class="pl-o">=</span><span class="pl-s">"A blue circle"</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-na">fill</span><span class="pl-o">=</span><span class="pl-s">"#30336b"</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-na">size</span><span class="pl-o">=</span><span class="pl-p">{</span><span class="pl-mi">200</span><span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-na">title</span><span class="pl-o">=</span><span class="pl-s">"Water planet"</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">/&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-kr">const</span> <span class="pl-nx">svgEl</span> <span class="pl-o">=</span> <span class="pl-nx">container</span><span class="pl-p">.</span><span class="pl-nx">querySelector</span><span class="pl-p">(</span><span class="pl-s1">'svg'</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-kr">const</span> <span class="pl-nx">titleEl</span> <span class="pl-o">=</span> <span class="pl-nx">getByText</span><span class="pl-p">(</span><span class="pl-s1">'Water planet'</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-kr">const</span> <span class="pl-nx">descEl</span> <span class="pl-o">=</span> <span class="pl-nx">getByText</span><span class="pl-p">(</span><span class="pl-s1">'A blue circle'</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">expect</span><span class="pl-p">(</span><span class="pl-nx">svgEl</span><span class="pl-p">).</span><span class="pl-nx">toHaveAttribute</span><span class="pl-p">(</span><span class="pl-s1">'height'</span><span class="pl-p">,</span> <span class="pl-s1">'200'</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">expect</span><span class="pl-p">(</span><span class="pl-nx">svgEl</span><span class="pl-p">).</span><span class="pl-nx">toHaveAttribute</span><span class="pl-p">(</span><span class="pl-s1">'width'</span><span class="pl-p">,</span> <span class="pl-s1">'200'</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">expect</span><span class="pl-p">(</span><span class="pl-nx">titleEl</span><span class="pl-p">).</span><span class="pl-nx">toBeInTheDocument</span><span class="pl-p">()</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">expect</span><span class="pl-p">(</span><span class="pl-nx">descEl</span><span class="pl-p">).</span><span class="pl-nx">toBeInTheDocument</span><span class="pl-p">()</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">expect</span><span class="pl-p">(</span><span class="pl-nx">asFragment</span><span class="pl-p">()).</span><span class="pl-nx">toMatchSnapshot</span><span class="pl-p">()</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">})</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nx">test</span><span class="pl-p">(</span><span class="pl-s1">'with only title &amp; size'</span><span class="pl-p">,</span> <span class="pl-p">()</span> <span class="pl-o">=&gt;</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-kr">const</span> <span class="pl-p">{</span> <span class="pl-nx">asFragment</span><span class="pl-p">,</span> <span class="pl-nx">container</span><span class="pl-p">,</span> <span class="pl-nx">getByText</span> <span class="pl-p">}</span> <span class="pl-o">=</span> <span class="pl-nx">render</span><span class="pl-p">(</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">&lt;</span><span class="pl-nt">Circle</span> <span class="pl-na">title</span><span class="pl-o">=</span><span class="pl-s">"Water planet"</span> <span class="pl-na">size</span><span class="pl-o">=</span><span class="pl-p">{</span><span class="pl-mi">200</span><span class="pl-p">}</span> <span class="pl-p">/&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-kr">const</span> <span class="pl-nx">svgEl</span> <span class="pl-o">=</span> <span class="pl-nx">container</span><span class="pl-p">.</span><span class="pl-nx">querySelector</span><span class="pl-p">(</span><span class="pl-s1">'svg'</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-kr">const</span> <span class="pl-nx">titleEl</span> <span class="pl-o">=</span> <span class="pl-nx">getByText</span><span class="pl-p">(</span><span class="pl-s1">'Water planet'</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-kr">const</span> <span class="pl-nx">descEl</span> <span class="pl-o">=</span> <span class="pl-nx">container</span><span class="pl-p">.</span><span class="pl-nx">querySelector</span><span class="pl-p">(</span><span class="pl-s1">'desc'</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">expect</span><span class="pl-p">(</span><span class="pl-nx">svgEl</span><span class="pl-p">).</span><span class="pl-nx">toHaveAttribute</span><span class="pl-p">(</span><span class="pl-s1">'height'</span><span class="pl-p">,</span> <span class="pl-s1">'200'</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">expect</span><span class="pl-p">(</span><span class="pl-nx">svgEl</span><span class="pl-p">).</span><span class="pl-nx">toHaveAttribute</span><span class="pl-p">(</span><span class="pl-s1">'width'</span><span class="pl-p">,</span> <span class="pl-s1">'200'</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">expect</span><span class="pl-p">(</span><span class="pl-nx">titleEl</span><span class="pl-p">).</span><span class="pl-nx">toBeInTheDocument</span><span class="pl-p">()</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">expect</span><span class="pl-p">(</span><span class="pl-nx">descEl</span><span class="pl-p">).</span><span class="pl-nx">not</span><span class="pl-p">.</span><span class="pl-nx">toBeInTheDocument</span><span class="pl-p">()</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">expect</span><span class="pl-p">(</span><span class="pl-nx">asFragment</span><span class="pl-p">()).</span><span class="pl-nx">toMatchSnapshot</span><span class="pl-p">()</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">})</span></span></span></code></pre><p>These first tests provide different sets of props and test various aspects of our component based on given props’ inclusion.</p><p>Next, we can use the <code>axe-core</code> tool to try our hand at accessibility testing:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-kr">import</span> <span class="pl-nx">axe</span> <span class="pl-kr">from</span> <span class="pl-s1">'axe-core'</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nx">test</span><span class="pl-p">(</span><span class="pl-s1">'is accessible with title, desc, size'</span><span class="pl-p">,</span> <span class="pl-p">(</span><span class="pl-nx">done</span><span class="pl-p">)</span> <span class="pl-o">=&gt;</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-kr">const</span> <span class="pl-p">{</span> <span class="pl-nx">container</span> <span class="pl-p">}</span> <span class="pl-o">=</span> <span class="pl-nx">render</span><span class="pl-p">(</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">&lt;</span><span class="pl-nt">Circle</span> <span class="pl-na">desc</span><span class="pl-o">=</span><span class="pl-s">"A blue circle"</span> <span class="pl-na">size</span><span class="pl-o">=</span><span class="pl-p">{</span><span class="pl-mi">200</span><span class="pl-p">}</span> <span class="pl-na">title</span><span class="pl-o">=</span><span class="pl-s">"Water planet"</span> <span class="pl-p">/&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">axe</span><span class="pl-p">.</span><span class="pl-nx">run</span><span class="pl-p">(</span><span class="pl-nx">container</span><span class="pl-p">,</span> <span class="pl-p">{},</span> <span class="pl-p">(</span><span class="pl-nx">err</span><span class="pl-p">,</span> <span class="pl-nx">result</span><span class="pl-p">)</span> <span class="pl-o">=&gt;</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">expect</span><span class="pl-p">(</span><span class="pl-nx">err</span><span class="pl-p">).</span><span class="pl-nx">toEqual</span><span class="pl-p">(</span><span class="pl-kc">null</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">expect</span><span class="pl-p">(</span><span class="pl-nx">result</span><span class="pl-p">.</span><span class="pl-nx">violations</span><span class="pl-p">.</span><span class="pl-nx">length</span><span class="pl-p">).</span><span class="pl-nx">toEqual</span><span class="pl-p">(</span><span class="pl-mi">0</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">done</span><span class="pl-p">()</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">})</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">})</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nx">test</span><span class="pl-p">(</span><span class="pl-s1">'is inaccessible without title'</span><span class="pl-p">,</span> <span class="pl-p">(</span><span class="pl-nx">done</span><span class="pl-p">)</span> <span class="pl-o">=&gt;</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-kr">const</span> <span class="pl-p">{</span> <span class="pl-nx">container</span> <span class="pl-p">}</span> <span class="pl-o">=</span> <span class="pl-nx">render</span><span class="pl-p">(</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">&lt;</span><span class="pl-nt">Circle</span> <span class="pl-na">desc</span><span class="pl-o">=</span><span class="pl-s">"A blue circle"</span> <span class="pl-na">title</span><span class="pl-o">=</span><span class="pl-s">"Water circle"</span> <span class="pl-na">size</span><span class="pl-o">=</span><span class="pl-p">{</span><span class="pl-mi">200</span><span class="pl-p">}</span> <span class="pl-p">/&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// do something very wrong to prove a11y testing works
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>  <span class="pl-nx">container</span><span class="pl-p">.</span><span class="pl-nx">querySelector</span><span class="pl-p">(</span><span class="pl-s1">'title'</span><span class="pl-p">)</span><span class="pl-o">?</span><span class="pl-p">.</span><span class="pl-nx">remove</span><span class="pl-p">()</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">axe</span><span class="pl-p">.</span><span class="pl-nx">run</span><span class="pl-p">(</span><span class="pl-nx">container</span><span class="pl-p">,</span> <span class="pl-p">{},</span> <span class="pl-p">(</span><span class="pl-nx">err</span><span class="pl-p">,</span> <span class="pl-nx">result</span><span class="pl-p">)</span> <span class="pl-o">=&gt;</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">expect</span><span class="pl-p">(</span><span class="pl-nx">err</span><span class="pl-p">).</span><span class="pl-nx">toEqual</span><span class="pl-p">(</span><span class="pl-kc">null</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">expect</span><span class="pl-p">(</span><span class="pl-nx">result</span><span class="pl-p">.</span><span class="pl-nx">violations</span><span class="pl-p">[</span><span class="pl-mi">0</span><span class="pl-p">].</span><span class="pl-nx">id</span><span class="pl-p">).</span><span class="pl-nx">toEqual</span><span class="pl-p">(</span><span class="pl-s1">'svg-img-alt'</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">done</span><span class="pl-p">()</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">})</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">})</span></span></span></code></pre><p>While the first test should be clear, the second test almost seems pointless (hint: it is). I am including it here to demonstrate what a failing accessibility scenario might look like. In reality, the first test in this group pointed out the error in the second test, for I was originally <em>not</em> requiring <code>title</code>, but I was giving the SVG <code>role="img"</code>. This is a no-no if there is no <code>aria-label</code>, <code>aria-labelledby</code>, nor <code>&lt;title&gt;</code> to supply the SVG with any textual meaning.</p><p>Testing is easy if you keep things simple, and automated accessibility testing is even easier than that, for all you need to do is provide DOM elements.</p><h3 id="component-stories">Component Stories</h3><p>I find it very difficult to do test driven development when developing components, for it is an exploratory, creative experience for me. Instant feedback makes it easy to run through all my bad ideas (there are many!) and eventually land on some good ones. Storybook stories can help us do that, so let’s make our first story in <code>source/Circle/stories.tsx</code>.</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-kr">import</span> <span class="pl-nx">React</span> <span class="pl-kr">from</span> <span class="pl-s1">'react'</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">import</span> <span class="pl-p">{</span> <span class="pl-nx">storiesOf</span> <span class="pl-p">}</span> <span class="pl-kr">from</span> <span class="pl-s1">'@storybook/react'</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">import</span> <span class="pl-p">{</span> <span class="pl-nx">withA11y</span> <span class="pl-p">}</span> <span class="pl-kr">from</span> <span class="pl-s1">'@storybook/addon-a11y'</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">import</span> <span class="pl-p">{</span> <span class="pl-nx">color</span><span class="pl-p">,</span> <span class="pl-kt">number</span><span class="pl-p">,</span> <span class="pl-nx">text</span><span class="pl-p">,</span> <span class="pl-nx">withKnobs</span> <span class="pl-p">}</span> <span class="pl-kr">from</span> <span class="pl-s1">'@storybook/addon-knobs'</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// import our component and styles from
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// the distribution (build) output
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-kr">import</span> <span class="pl-p">{</span> <span class="pl-nx">Circle</span> <span class="pl-p">}</span> <span class="pl-kr">from</span> <span class="pl-s1">'../../dist/esm'</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">import</span> <span class="pl-s1">'../../dist/css/Circle/styles.css'</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// group our stories under "Circle"
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-kr">const</span> <span class="pl-nx">stories</span> <span class="pl-o">=</span> <span class="pl-nx">storiesOf</span><span class="pl-p">(</span><span class="pl-s1">'Circle'</span><span class="pl-p">,</span> <span class="pl-nx">module</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// enable the accessibility &amp; knobs addons
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-nx">stories</span><span class="pl-p">.</span><span class="pl-nx">addDecorator</span><span class="pl-p">(</span><span class="pl-nx">withA11y</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nx">stories</span><span class="pl-p">.</span><span class="pl-nx">addDecorator</span><span class="pl-p">(</span><span class="pl-nx">withKnobs</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// add a new story and use the
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// knobs tools to provide named
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// defaults that you can alter
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// in the Storybook interface
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-nx">stories</span><span class="pl-p">.</span><span class="pl-nx">add</span><span class="pl-p">(</span><span class="pl-s1">'default'</span><span class="pl-p">,</span> <span class="pl-p">()</span> <span class="pl-o">=&gt;</span> <span class="pl-p">(</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">&lt;</span><span class="pl-nt">Circle</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-na">desc</span><span class="pl-o">=</span><span class="pl-p">{</span><span class="pl-nx">text</span><span class="pl-p">(</span><span class="pl-s1">'desc'</span><span class="pl-p">,</span> <span class="pl-s1">'A blue circle'</span><span class="pl-p">)}</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-na">fill</span><span class="pl-o">=</span><span class="pl-p">{</span><span class="pl-nx">color</span><span class="pl-p">(</span><span class="pl-s1">'fill'</span><span class="pl-p">,</span> <span class="pl-s1">'#7ed6df'</span><span class="pl-p">)}</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-na">size</span><span class="pl-o">=</span><span class="pl-p">{</span><span class="pl-kt">number</span><span class="pl-p">(</span><span class="pl-s1">'size'</span><span class="pl-p">,</span> <span class="pl-mi">200</span><span class="pl-p">)}</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-na">title</span><span class="pl-o">=</span><span class="pl-p">{</span><span class="pl-nx">text</span><span class="pl-p">(</span><span class="pl-s1">'title'</span><span class="pl-p">,</span> <span class="pl-s1">'Abstract water planet'</span><span class="pl-p">)}</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">/&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">))</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nx">stories</span><span class="pl-p">.</span><span class="pl-nx">add</span><span class="pl-p">(</span><span class="pl-s1">'another scenario...'</span><span class="pl-p">,</span> <span class="pl-p">()</span> <span class="pl-o">=&gt;</span> <span class="pl-p">(</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">&lt;</span><span class="pl-nt">Circle</span> <span class="pl-p">{</span><span class="pl-err">/*</span> <span class="pl-na">other</span> <span class="pl-na">example</span> <span class="pl-na">props</span> <span class="pl-na">here</span> <span class="pl-err">*/</span><span class="pl-p">}</span> <span class="pl-p">/&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">))</span></span></span></code></pre><p>Each component gets its own <code>stories.tsx</code> file, so there’s no need to worry about them getting out of hand with all the different components in your library. Add as many different stories for your components as you like! Our Storybook config will collect them all for you into a single place.</p><h2 id="building-our-typescript">Building Our TypeScript</h2><p>We’ve already created a <code>tsconfig.base.json</code> and <code>tsconfig.json</code> file, and now it’s time to add ones for CommonJS (CJS), ESModules (ESM), and Universal Module Definitions (UMD). We will then add some NPM scripts to build out TypeScript for us.</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">$ touch tsconfig.cjs.json tsconfig.esm.json tsconfig.umd.json</span></span></code></pre><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// tsconfig.cjs.json
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"extends"</span><span class="pl-o">:</span> <span class="pl-s2">"./tsconfig.base.json"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"compilerOptions"</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s2">"module"</span><span class="pl-o">:</span> <span class="pl-s2">"commonjs"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s2">"outDir"</span><span class="pl-o">:</span> <span class="pl-s2">"dist/cjs/"</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">},</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"include"</span><span class="pl-o">:</span> <span class="pl-p">[</span><span class="pl-s2">"source/index.ts"</span><span class="pl-p">]</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">}</span></span></span></code></pre><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// tsconfig.esm.json
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"extends"</span><span class="pl-o">:</span> <span class="pl-s2">"./tsconfig.base.json"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"compilerOptions"</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s2">"module"</span><span class="pl-o">:</span> <span class="pl-s2">"esNext"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s2">"outDir"</span><span class="pl-o">:</span> <span class="pl-s2">"dist/esm/"</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">},</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"include"</span><span class="pl-o">:</span> <span class="pl-p">[</span><span class="pl-s2">"source/index.ts"</span><span class="pl-p">]</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">}</span></span></span></code></pre><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// tsconfig.umd.json
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"extends"</span><span class="pl-o">:</span> <span class="pl-s2">"./tsconfig.base.json"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"compilerOptions"</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s2">"module"</span><span class="pl-o">:</span> <span class="pl-s2">"umd"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s2">"outDir"</span><span class="pl-o">:</span> <span class="pl-s2">"dist/umd/"</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">},</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"include"</span><span class="pl-o">:</span> <span class="pl-p">[</span><span class="pl-s2">"source/index.ts"</span><span class="pl-p">]</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">}</span></span></span></code></pre><p>Each of these specify where to find the source, what type of module to output, and where to put the resulting compiled code. If you want your code to be compiled to the output, make sure it is either included in the <code>include</code> field or is <code>require</code>d by something that is.</p><p>In our <code>package.json</code>, let’s add some scripts that make use of these configs:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-s2">"scripts"</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"build:js:cjs"</span><span class="pl-o">:</span> <span class="pl-s2">"tsc -p tsconfig.cjs.json"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"build:js:esm"</span><span class="pl-o">:</span> <span class="pl-s2">"tsc -p tsconfig.esm.json"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"build:js:umd"</span><span class="pl-o">:</span> <span class="pl-s2">"tsc -p tsconfig.umd.json"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-p">},</span></span></span></code></pre><p>Easy! If you are guessing that we might want to run these all together in a <code>build:js</code> command, there are two ways to do that (one verbose and one less so).</p><p>Our first attempt:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-s2">"scripts"</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"build:js"</span><span class="pl-o">:</span> <span class="pl-s2">"npm run build:js:cjs &amp;&amp; npm run build:js:esm &amp;&amp; npm run build:js:umd"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-p">},</span></span></span></code></pre><p>Not bad, but we can use the <a href="https://www.npmjs.com/package/npm-run-all"><code>npm-run-all</code></a> tool to not only write a more succinct script but also run these in parallel!</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">$ npm install --save-dev --save-exact npm-run-all</span></span></code></pre><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-s2">"scripts"</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"build:js"</span><span class="pl-o">:</span> <span class="pl-s2">"run-p build:js:cjs build:js:esm build:js:umd"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-p">},</span></span></span></code></pre><p>The <code>npm-run-all</code> tool gives us <code>run-p</code> for running scripts in parallel and <code>run-s</code> for running them synchronously.</p><p>Watching for changes is also very simple:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-s2">"scripts"</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>  <span class="pl-s2">"build:js:esm:watch"</span><span class="pl-o">:</span> <span class="pl-s2">"tsc -p tsconfig.esm.json -w"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-p">},</span></span></span></code></pre><p>While we’re here, let’s go ahead and add a <code>clean</code>ing script for our <code>dist/</code> directory:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-s2">"scripts"</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>  <span class="pl-s2">"clean"</span><span class="pl-o">:</span> <span class="pl-s2">"clean:dist"</span><span class="pl-p">,</span> <span class="pl-c1">// we'll add more here shortly
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>  <span class="pl-s2">"clean:dist"</span><span class="pl-o">:</span> <span class="pl-s2">"rm -rf dist"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-p">},</span></span></span></code></pre><p>Now that we can do some <code>clean</code>ing and <code>build</code>ing, let’s create a single <code>build</code> script that we can continue adding build steps to as we go:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-s2">"scripts"</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"build"</span><span class="pl-o">:</span> <span class="pl-s2">"run-s clean build:js"</span><span class="pl-p">,</span> <span class="pl-c1">// we'll add more here shortly
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>  <span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-p">}</span></span></span></code></pre><p>Give it all whirl, if you like:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">$ npm run build</span></span></code></pre><p>You should see the following tree structure for your <code>dist/</code> folder:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">.
</span></span><span class="pl-line"><span class="pl-cl">└── dist
</span></span><span class="pl-line"><span class="pl-cl">    └── cjs
</span></span><span class="pl-line"><span class="pl-cl">        └── Circle
</span></span><span class="pl-line"><span class="pl-cl">            ├── index.d.js
</span></span><span class="pl-line"><span class="pl-cl">            └── index.js
</span></span><span class="pl-line"><span class="pl-cl">        ├── index.d.js
</span></span><span class="pl-line"><span class="pl-cl">        └── index.js
</span></span><span class="pl-line"><span class="pl-cl">    └── esm
</span></span><span class="pl-line"><span class="pl-cl">        └── Circle
</span></span><span class="pl-line"><span class="pl-cl">            ├── index.d.js
</span></span><span class="pl-line"><span class="pl-cl">            └── index.js
</span></span><span class="pl-line"><span class="pl-cl">        ├── index.d.js
</span></span><span class="pl-line"><span class="pl-cl">        └── index.js
</span></span><span class="pl-line"><span class="pl-cl">    └── umd
</span></span><span class="pl-line"><span class="pl-cl">        └── Circle
</span></span><span class="pl-line"><span class="pl-cl">            ├── index.d.js
</span></span><span class="pl-line"><span class="pl-cl">            └── index.js
</span></span><span class="pl-line"><span class="pl-cl">        ├── index.d.js
</span></span><span class="pl-line"><span class="pl-cl">        └── index.js</span></span></code></pre><p>We’re getting places! We have JS, and now we need our CSS.</p><h2 id="building-our-css">Building Our CSS</h2><p>For our styles, we have two goals: 1. output each component’s styles in a component CSS folder like <code>dist/css/Circle/styles.css</code> 1. output a combination of each component’s styles in a single file in <code>dist/css/styles.css</code></p><p>To achieve this, we’re going to write a short bash script, and we’re going to place it in <code>scripts/buildCSS</code>.</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">$ mkdir scripts
</span></span><span class="pl-line"><span class="pl-cl">$ touch scripts/buildCSS
</span></span><span class="pl-line"><span class="pl-cl">$ chmod +x scripts/buildCSS</span></span></code></pre><p>And in <code>scripts/buildCSS</code>:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-cp">#!/bin/bash
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-cp"></span><span class="pl-nb">set</span> -euo pipefail
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-k">function</span> copy_css <span class="pl-o">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nb">local</span> <span class="pl-nv">dir</span><span class="pl-o">=</span><span class="pl-k">$(</span>dirname <span class="pl-nv">$0</span><span class="pl-k">)</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nb">local</span> <span class="pl-nv">component</span><span class="pl-o">=</span><span class="pl-k">$(</span>basename <span class="pl-nv">$dir</span><span class="pl-k">)</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nb">local</span> <span class="pl-nv">dist_css</span><span class="pl-o">=</span><span class="pl-nv">$PWD</span>/dist/css
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1"># concatenate component CSS to main CSS file</span>
</span></span><span class="pl-line"><span class="pl-cl">  mkdir -p <span class="pl-nv">$dist_css</span>
</span></span><span class="pl-line"><span class="pl-cl">  cat <span class="pl-nv">$0</span> &gt;&gt; <span class="pl-nv">$dist_css</span>/styles.css
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1"># copy component CSS to component folder</span>
</span></span><span class="pl-line"><span class="pl-cl">  mkdir -p <span class="pl-nv">$dist_css</span>/<span class="pl-nv">$component</span>/
</span></span><span class="pl-line"><span class="pl-cl">  cp <span class="pl-nv">$0</span> <span class="pl-nv">$dist_css</span>/<span class="pl-nv">$component</span>/
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-o">}</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nb">export</span> -f copy_css
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-k">function</span> build <span class="pl-o">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  find <span class="pl-nv">$PWD</span>/source <span class="pl-se">\
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-se"></span>    -name <span class="pl-s1">'*.css'</span> <span class="pl-se">\
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-se"></span>    -exec /bin/bash -c <span class="pl-s1">'copy_css $0'</span> <span class="pl-o">{}</span> <span class="pl-se">\;</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-o">}</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">build</span></span></code></pre><p>We lean on some <code>coreutils</code> here to solve our problems for us. The last line of our script, <code>build</code>, calls the function of the same name that looks inside the <code>source</code> directory for all CSS files and tells the <code>bash</code> program to run <code>copy_css</code> with the path to the CSS file. There’s a catch, though: <code>bash</code> is going to run in a subshell, so we need to make sure our <code>copy_css</code> function is exported and available by <code>export -f copy_css</code>.</p><p>For the <code>copy_css</code> function, it’s much simpler than it looks! Here are the steps: 1. <code>mkdir -p $dist_css</code> creates our output directory, <code>dist/css</code>. 1. <code>cat $0 &gt;&gt; $dist_css/styles.css</code> concatenates all the lines of our source CSS file and appends them to <code>dist/css/styles.css</code>. 1. <code>mkdir -p $dist_css/$component/</code> creates a component CSS folder like <code>dist/css/Circle/</code>. We derive the <code>$component</code> variable by getting the <code>basename</code> of the <code>dirname</code> of our full CSS file path. For example, <code>/Users/myuser/projects/example-component-library/source/Circle/styles.css</code> has a <code>dirname</code> of <code>/Users/rpearce/projects/example-component-library/source/Circle</code>, and that has a <code>basename</code> of <code>Circle</code>! Using that deduction, we can derive what component we’re working with and create that output directory simply by finding a CSS file. 1. <code>cp $0 $dist_css/$component/</code> copies the source component CSS file to the output component directory; that’s it!</p><p>If you have a different CSS setup, you’ll need to adjust this build script accordingly.</p><p>Now that we have our <code>buildCSS</code> script, we can add an NPM <code>script</code> to handle building this for us and add that to our <code>build</code> script:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-s2">"scripts"</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"build"</span><span class="pl-o">:</span> <span class="pl-s2">"run-s clean build:js build:css"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"build:css"</span><span class="pl-o">:</span> <span class="pl-s2">"./scripts/buildCSS"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-p">},</span></span></span></code></pre><p>Similarly to our <code>build:js:esm:watch</code> command, how might we watch for CSS changes and run our script in a <code>build:css:watch</code> command? Luckily, there’s a tool that can help us with that: <a href="https://www.npmjs.com/package/chokidar"><code>chokidar</code></a>.</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">$ npm install --save-dev --save-exact chokidar</span></span></code></pre><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-s2">"scripts"</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>  <span class="pl-s2">"build:css:watch"</span><span class="pl-o">:</span> <span class="pl-s2">"chokidar \"source/**/*.css\" -c \"./scripts/buildCSS\""</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-p">},</span></span></span></code></pre><h2 id="building-our-stories">Building Our Stories</h2><p>To develop our components and get instant feedback in our Storybook examples, we’re going to need to run a few things at once to get it all to work together.</p><p>First, let’s add a line to our <code>package.json</code>’s <code>scripts</code> object called <code>storybook</code>:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-s2">"scripts"</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>  <span class="pl-s2">"storybook"</span><span class="pl-o">:</span> <span class="pl-s2">"start-storybook -p 6006"</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">},</span></span></span></code></pre><p>Next, let’s add a <code>start</code> command that, in this sequence, 1. cleans the <code>dist/</code> directory 1. builds only the ESModule JS output 1. builds the CSS</p><p>and then, in parallel, 1. watches the JS for changes and rebuilds the ESModule output 1. watches the CSS for changes and rebuilds the CSS 1. runs storybook, which watches for changes to the prior two items, for it will detect changes to its <code>import</code>s from the <code>dist/</code> folder</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-s2">"scripts"</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>  <span class="pl-s2">"start"</span><span class="pl-o">:</span> <span class="pl-s2">"run-s clean:dist build:js:esm build:css &amp;&amp; run-p build:js:esm:watch build:css:watch storybook"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-p">},</span></span></span></code></pre><p>If you want to break those up into different scripts to make it more legible, here’s a way to do that:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-s2">"scripts"</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>  <span class="pl-s2">"start"</span><span class="pl-o">:</span> <span class="pl-s2">"run-s start:init start:run"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"start:init"</span><span class="pl-o">:</span> <span class="pl-s2">"run-s clean:dist build:js:esm build:css"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"start:run"</span><span class="pl-o">:</span> <span class="pl-s2">"run-p build:js:esm:watch build:css:watch storybook"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-p">},</span></span></span></code></pre><p>You can then run this from the command line, and it should automatically open your web browser and take you to <a href="http://localhost:6006" class="uri">http://localhost:6006</a>.</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">$ npm run start</span></span></code></pre><p>Your Storybook library should have your component, and you can adjust the component knobs in one of the sidebars, and you can also see the accessibility audit located in the tab next to the knobs. <em>Note: no amount of automated testing can guarantee accessibility, but it can help you catch silly mistakes.</em></p><p>With all these pieces in place, you can now develop your components and get instante feedback in the browser using the same code that you would provide to a consumer of your package!</p><p>Did you know that you can also build static HTML, CSS, and JavaScript files and serve that up through something like GitHub Pages? We can update our <code>package.json</code> <code>scripts</code> to include scripts for building our Storybook output to the <code>docs/</code> folder and for cleaning the <code>docs/</code> folder, as well.</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-s2">"scripts"</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>  <span class="pl-s2">"build:docs"</span><span class="pl-o">:</span> <span class="pl-s2">"build-storybook -o docs"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"clean:docs"</span><span class="pl-o">:</span> <span class="pl-s2">"rm -rf docs"</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"storybook"</span><span class="pl-o">:</span> <span class="pl-s2">"start-storybook -p 6006"</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">},</span></span></span></code></pre><p>The <code>clean:docs</code> script, if ran first, will guarantee that we have fresh output in our <code>docs/</code> folder. Let’s give it a go:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">$ npm run clean:docs &amp;&amp; npm run build:docs</span></span></code></pre><p>Since we can now clean and build our Storybook folder, we can update our <code>build</code> and <code>clean</code> scripts accordingly:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-s2">"scripts"</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s2">"build"</span><span class="pl-o">:</span> <span class="pl-s2">"run-s clean build:js build:css build:docs"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>  <span class="pl-s2">"clean"</span><span class="pl-o">:</span> <span class="pl-s2">"run-p clean:dist clean:docs"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-p">},</span></span></span></code></pre><h2 id="continuous-integration-notes">Continuous Integration Notes</h2><p>When you set up a continuous integration (CI) tool for this project, it will be tempting to tell it to simply run <code>$ npm run build</code>; however, this will not include your linting and testing scripts, and you could potentially have a green light from CI when really you have problems!</p><p>While you could always run your linting and testing scripts inside of <code>build</code> ( this can get tedious) or multiple scripts from your CI configuration, let’s instead add another script named <code>ci</code> to handle this for us:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-s2">"scripts"</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>  <span class="pl-s2">"ci"</span><span class="pl-o">:</span> <span class="pl-s2">"run-p lint build test"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-p">},</span></span></span></code></pre><p>No worries! Now we can use <code>$ npm run ci</code> in our CI configuration.</p><h2 id="publishing-notes">Publishing Notes</h2><p>I recommend adding a <code>prepublishOnly</code> script that ensures your linter and tests pass before trying to build your component output:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-s2">"scripts"</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>  <span class="pl-s2">"prepublishOnly"</span><span class="pl-o">:</span> <span class="pl-s2">"run-p lint test &amp;&amp; run-p build:js build:css"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-p">},</span></span></span></code></pre><p>Also, if you want this to be a private repository, make sure you add <code>"private": true</code> to your <code>package.json</code> before publishing.</p><h2 id="wrapping-up">Wrapping Up</h2><p>Thank you for reading this, and I hope this helps you create an awesome, accessible component library.</p><p>Robert</p></section></main><footer><span aria-hidden="true" class="heart">♥</span><span aria-hidden="true">&rarr;</span><a href="https://github.com/sponsors/rpearce/">Sponsor my work</a><span aria-hidden="true">&larr;</span><span aria-hidden="true" class="heart">♥</span></footer><script async> (() => { const themeEl = document.querySelector('[data-select-theme]'); if (themeEl) { themeEl.querySelector('[value="'+window.site.prefTheme+'"]').selected = 'selected'; themeEl.addEventListener('change', e => { window.site.setTheme(e.target.value); }); } const fontEl = document.querySelector('[data-select-font]'); if (fontEl) { fontEl.querySelector('[value="'+window.site.prefFont+'"]').selected = 'selected'; fontEl.addEventListener('change', e => { window.site.setFont(e.target.value); }) } })(); </script></body></html>