<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Asynchronously Loading Scripts</title>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1">
    <meta name="google-site-verification" content="QX4bn65yOXBfgnwxlO09yIBc1H8blur-Erx3lmsDVhU">
    <meta name="description" content="Beginner-friendly introduction to loading scripts on to a web page.">

    <meta property="og:site_name" content="RobertWPearce.com">
    <meta property="og:url" content="http://robertwpearce.com//blog/asynchronously-loading-scripts.html">
    <meta property="og:description" content="Beginner-friendly introduction to loading scripts on to a web page.">
    <meta property="og:image" content="">
    <meta property="og:type" content="article">

    <link href="http://fonts.googleapis.com/css?family=Lato:400" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/css/app.css">
    <link rel="canonical" href="http://www.robertwpearce.com//blog/asynchronously-loading-scripts.html">
    <!--<link rel="alternate" type="application/rss+xml" title="Robert W. Pearce" href="http://robertwpearce.com/feed.xml">-->
  </head>
  <body>

  <nav>
    <div class="layout--constrained">
      <ul class="nav--main list--bare list--horz">
        <li><a href="/">Home</a></li>
        <li><a href="mailto:me@robertwpearce.com?subject=Work Inquiry">Hire Me</a></li>
      </ul>
    </div>
  </nav>

  <article class="article">
    <div class="article__background" style="background-image: url(http://s3.amazonaws.com/rpearce.github.io/loading-scripts/rock-creek-pk.jpg)">
      <div class="overlay"></div>
      <div class="article__backgroundHeader">
        <div class="layout--constrained">
          <h1 class="heading--trim">
            <a href="/blog/asynchronously-loading-scripts.html">Asynchronously Loading Scripts</a>
          </h1>
          <small><em>Oct 5, 2015</em></small>
        </div>
      </div>
    </div>
    <div class="layout--constrained">
      <header class="article__header heading--fatBottomBorder">
        <h1 class="heading--trim">
          <a href="/blog/asynchronously-loading-scripts.html">Asynchronously Loading Scripts</a>
        </h1>
        <small><em>Oct 5, 2015</em></small>
      </header>
<p><em>This article is intended for HTML &amp; JavaScript beginners.</em></p>
<hr>
<p>Where do you place your <code>&lt;script&gt;</code> tags to load your JavaScript for your
website? If you&#39;re doing this within the <code>&lt;head&gt;</code> element, you might
want to consider whether or not this is the best option for you.</p>
<h2 id="fetching-javascript-synchronously">Fetching JavaScript Synchronously</h2>
<p>So long as HTTP/1.1 is what your website is accessed via (which it will be
a long while), <code>&lt;script&gt;</code> tags will be used to fetch external JavaScript
files whose contents will be included on the page. These typically look
like <code>&lt;script src=&quot;app.js&quot;&gt;&lt;/script&gt;</code>. <code>&lt;script&gt;</code> tags are by default &quot;blocking,&quot; meaning that the web page has to pause its download &amp; render cycle, fetch and load the JavaScript and then continue on. Here is what this looks like:</p>
<pre><code class="lang-html"><span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;</span>html</span><span class="token punctuation" >></span></span>
  <span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;</span>head</span><span class="token punctuation" >></span></span>
    <span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;</span>script</span> <span class="token attr-name" >src</span><span class="token attr-value" ><span class="token punctuation" >=</span><span class="token punctuation" >"</span>app.js<span class="token punctuation" >"</span></span><span class="token punctuation" >></span></span><span class="token script language-javascript" ></span><span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;/</span>script</span><span class="token punctuation" >></span></span>
  <span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;/</span>head</span><span class="token punctuation" >></span></span>
  <span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;</span>body</span><span class="token punctuation" >></span></span>
    <span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;</span>div</span><span class="token punctuation" >></span></span>My Website<span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;/</span>div</span><span class="token punctuation" >></span></span>
  <span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;/</span>body</span><span class="token punctuation" >></span></span>
<span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;/</span>html</span><span class="token punctuation" >></span></span>
</code></pre>
<p>The worst thing you can do is load multiple scripts in this blocking
fashion:</p>
<pre><code class="lang-html"><span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;</span>html</span><span class="token punctuation" >></span></span>
  <span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;</span>head</span><span class="token punctuation" >></span></span>
    <span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;</span>script</span> <span class="token attr-name" >src</span><span class="token attr-value" ><span class="token punctuation" >=</span><span class="token punctuation" >"</span>jquery.js<span class="token punctuation" >"</span></span><span class="token punctuation" >></span></span><span class="token script language-javascript" ></span><span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;/</span>script</span><span class="token punctuation" >></span></span>
    <span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;</span>script</span> <span class="token attr-name" >src</span><span class="token attr-value" ><span class="token punctuation" >=</span><span class="token punctuation" >"</span>jquery.lightbox.js<span class="token punctuation" >"</span></span><span class="token punctuation" >></span></span><span class="token script language-javascript" ></span><span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;/</span>script</span><span class="token punctuation" >></span></span>
    <span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;</span>script</span> <span class="token attr-name" >src</span><span class="token attr-value" ><span class="token punctuation" >=</span><span class="token punctuation" >"</span>some_file.js<span class="token punctuation" >"</span></span><span class="token punctuation" >></span></span><span class="token script language-javascript" ></span><span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;/</span>script</span><span class="token punctuation" >></span></span>
    <span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;</span>script</span> <span class="token attr-name" >src</span><span class="token attr-value" ><span class="token punctuation" >=</span><span class="token punctuation" >"</span>app.js<span class="token punctuation" >"</span></span><span class="token punctuation" >></span></span><span class="token script language-javascript" ></span><span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;/</span>script</span><span class="token punctuation" >></span></span>
  <span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;/</span>head</span><span class="token punctuation" >></span></span>
  <span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;</span>body</span><span class="token punctuation" >></span></span>
    <span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;</span>div</span><span class="token punctuation" >></span></span>My Website<span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;/</span>div</span><span class="token punctuation" >></span></span>
  <span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;/</span>body</span><span class="token punctuation" >></span></span>
<span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;/</span>html</span><span class="token punctuation" >></span></span>
</code></pre>
<p>so make sure you combine (concatenate) all your JavaScript files in to
one file. But this is still not ideal, for you have a blocking script
that will have to download before anything else happens.</p>
<p>When we throw <code>&lt;script&gt;</code> tags at the end of the <code>&lt;body&gt;</code>, we allow for the page to paint and then go and fetch the JS synchronously (this lets the user see and utilize the page, but the scripts still haven&#39;t finished loading).</p>
<pre><code class="lang-html"><span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;</span>html</span><span class="token punctuation" >></span></span>
  <span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;</span>head</span><span class="token punctuation" >></span></span><span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;/</span>head</span><span class="token punctuation" >></span></span>
  <span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;</span>body</span><span class="token punctuation" >></span></span>
    <span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;</span>div</span><span class="token punctuation" >></span></span>My Website<span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;/</span>div</span><span class="token punctuation" >></span></span>
    <span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;</span>script</span> <span class="token attr-name" >src</span><span class="token attr-value" ><span class="token punctuation" >=</span><span class="token punctuation" >"</span>app.js<span class="token punctuation" >"</span></span><span class="token punctuation" >></span></span><span class="token script language-javascript" ></span><span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;/</span>script</span><span class="token punctuation" >></span></span>
  <span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;/</span>body</span><span class="token punctuation" >></span></span>
<span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;/</span>html</span><span class="token punctuation" >></span></span>
</code></pre>
<p>However, since the page is still loading, search engines might punish you for a
long(er) loading time. What we might need, instead, is the ability to
asynchronously fetch the JavaScript <em>after</em> the page is finished
loading.</p>
<h2 id="fetching-javascript-asynchronously">Fetching JavaScript Asynchronously</h2>
<p>There are two popular methods for fetch JavaScript in an asynchronous
manner.</p>
<p>The first is to simply include the HTML5 <code>async</code> property:</p>
<pre><code class="lang-html"><span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;</span>script</span> <span class="token attr-name" >src</span><span class="token attr-value" ><span class="token punctuation" >=</span><span class="token punctuation" >"</span>app.js<span class="token punctuation" >"</span></span> <span class="token attr-name" >async</span><span class="token punctuation" >></span></span><span class="token script language-javascript" ></span><span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;/</span>script</span><span class="token punctuation" >></span></span>
</code></pre>
<p>Or, if you need to support older browsers, add an event listener to the window&#39;s <code>load</code> function to dynamically build a script tag and append it to the page (note how I do not use <code>window.onload =</code>):</p>
<pre><code class="lang-html"><span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;</span>script</span><span class="token punctuation" >></span></span><span class="token script language-javascript" >
  window<span class="token punctuation" >.</span><span class="token function" >addEventListener</span><span class="token punctuation" >(</span><span class="token string" >'load'</span><span class="token punctuation" >,</span> buildScriptTag<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token keyword" >function</span> <span class="token function" >buildScriptTag</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >var</span> script <span class="token operator" >=</span> document<span class="token punctuation" >.</span><span class="token function" >createElement</span><span class="token punctuation" >(</span><span class="token string" >'script'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    script<span class="token punctuation" >.</span>src <span class="token operator" >=</span> <span class="token string" >'app.js'</span><span class="token punctuation" >;</span>
    document<span class="token punctuation" >.</span>body<span class="token punctuation" >.</span><span class="token function" >appendChild</span><span class="token punctuation" >(</span>script<span class="token punctuation" >)</span><span class="token punctuation" >;</span> <span class="token comment" spellcheck="true">// append it wherever you want</span>
  <span class="token punctuation" >}</span>
</span><span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;/</span>script</span><span class="token punctuation" >></span></span>
</code></pre>
<p>Why didn&#39;t I use <code>window.onload =</code> here? When you assign a browser callback trigger a value, it can only have one value! When you add an event listener, you allow the window&#39;s load functionality to have more values in the future.</p>
<h2 id="conclusion">Conclusion</h2>
<p>If your app/website is architected to rely on JavaScript before it
renders anything, then you can utilize this asynchronous
technique with a &quot;Loading...&quot; graphic that is removed when the
JavaScript loads. Ultimately, you want to decrease the amount of time it
takes for a web page to perform an initial load so that the user can get
started using your project as quickly as possible. With asynchronous
loading of JavaScript, you enable your users to get going ASAP and then
allow for them to have a fancier experience once things load in the
background.</p>
    </div>
  </article>

  </body>
</html>

