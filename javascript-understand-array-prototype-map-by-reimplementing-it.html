<!DOCTYPE html><html lang="en"><head><title>JavaScript: Understand Array.prototype.map by Reimplementing It</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Write your own implementation of JavaScript's Array.prototype.map method."><meta name="author" content="Robert Pearce"><meta name="keywords" content="javascript, map, Array.prototype.map, reimplement map, js, programming"><meta name="google-site-verification" content="QX4bn65yOXBfgnwxlO09yIBc1H8blur-Erx3lmsDVhU"><meta http-equiv="origin-trial" content="Am4BZ0c7GMyB72dgo/Ny2FfIFscXhYMoN+CVe4jduWh24FvsaCwf7kjZzHzfrJXtIilyZVAEKRxOItGLY7lvkAgAAABSeyJvcmlnaW4iOiJodHRwczovL3JvYmVydHdwZWFyY2UuY29tOjQ0MyIsImZlYXR1cmUiOiJQb3J0YWxzIiwiZXhwaXJ5IjoxNjAzNTQ2NDc3fQ=="><meta property="og:site_name" content="Robert Pearce"><meta property="og:title" content="JavaScript: Understand Array.prototype.map by Reimplementing It"><meta property="og:url" content="https://robertwpearce.com/javascript-understand-array-prototype-map-by-reimplementing-it.html"><meta property="og:description" content="Write your own implementation of JavaScript's Array.prototype.map method."><meta property="og:type" content="article"><meta property="twitter:site" content="Robert Pearce"><meta property="twitter:title" content="JavaScript: Understand Array.prototype.map by Reimplementing It"><meta property="twitter:description" content="Write your own implementation of JavaScript's Array.prototype.map method."><meta property="twitter:creator" content="@RobertWPearce"><link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ðŸ’¾</text></svg>"><link rel="canonical" href="https://robertwpearce.com/javascript-understand-array-prototype-map-by-reimplementing-it.html"><link rel="alternate" href="./atom.xml" title="Robert Pearce's blog" type="application/atom+xml"><link rel="alternate" href="./rss.xml" title="Robert Pearce's blog" type="application/rss+xml"><link rel="stylesheet" href="./css/base.css"><link rel="stylesheet" href="./css/t-clean.css"><link rel="stylesheet" href="./css/t-clean-note.css"><link rel="stylesheet" href="./css/t-code-dracula.css"><link rel="prefetch" href="./css/t-clean-note.css"></head><body data-theme="clean-night"><script> (() => { window.site = { prefFont: localStorage.getItem('prefFont') || 'monospace', setFont: (family) => { localStorage.setItem('prefFont', family); const rootStyle = document.querySelector(':root').style; rootStyle.setProperty('--type-family-body', family+',monospace'); /* Remove when https://github.com/googlefonts/spacemono/pull/2 is resolved */ if (family === 'Liga Space Mono') { rootStyle.setProperty('font-feature-settings', '"liga" 0'); } else { rootStyle.removeProperty('font-feature-settings'); } return window.site._fetchFont(family); }, prefTheme: localStorage.getItem('prefTheme') || (matchMedia('(prefers-color-scheme: dark)').matches ? 'clean-night' : 'clean-day'), setTheme: (name) => { const rootStyle = document.querySelector(':root').style; if (name === 'clean-night') { rootStyle.removeProperty('color-scheme'); } else { rootStyle.setProperty('color-scheme', 'light'); } document.body.setAttribute('data-theme', name); localStorage.setItem('prefTheme', name); }, _fetchFont: (family) => { if (family === 'monospace') { return Promise.resolve(); } const familyNoSpaces = family.replaceAll(' ', ''); const fontz = [ new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-Regular.woff2") format("woff2")', { display: 'swap', weight: 400 }), new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-Bold.woff2") format("woff2")', { display: 'swap', weight: 700 }), ]; if (family !== 'Fira Code') { fontz.push( new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-Italic.woff2") format("woff2")', { display: 'swap', style: 'italic', weight: 400 }), new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-BoldItalic.woff2") format("woff2")', { display: 'swap', style: 'italic', weight: 700 }) ); } for (const f of fontz) { document.fonts.add(f); } return Promise.allSettled(fontz).then(results => { results.forEach((res, i) => { if (res.status === 'rejected') { console.error('site failed to load font: ' + fontz[i]?.family ?? 'unknown'); } }); }); } }; window.site.setTheme(window.site.prefTheme); window.site.setFont(window.site.prefFont); })(); </script><header><nav><div class="nav-skip"><a href="#content">Skip to content</a></div><a aria-label="Home" class="nav-home" href="./">~</a><span>/</span></nav><div class="header-extra"><a href="./atom.xml">RSS</a><span aria-hidden="true">&compfn;</span><noscript>(requires JS &rarr;)</noscript><label for="select-theme">Theme</label><select data-select-theme id="select-theme"><option value="clean-day">Clean (Day)</option><option value="clean-night">Clean (Night)</option></select><span aria-hidden="true">&compfn;</span><label for="select-font">Font</label><select data-select-font id="select-font"><option value="monospace">monospace</option><option value="Liga Space Mono">Space Mono</option><option value="Victor Mono">Victor Mono</option><option value="Fira Code">Fira Code</option><option value="JetBrains Mono">JetBrains Mono</option></select></div></header><main id="content"><header data-area="heading"><h1>JavaScript: Understand Array.prototype.map by Reimplementing It</h1></header><section data-area="meta"><h2>Info</h2><table data-type="cols-y"><tbody><tr><th>Summary</th><td>Write your own implementation of JavaScript's Array.prototype.map method.</td></tr><tr><th>Shared</th><td>2020-01-27</td></tr></tbody></table></section><section data-area="note"><p>In this post, we will reimplement JavaScriptâ€™s <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map"><code>Array.prototype.map</code></a> function in order to not only understand <code>map</code> better but also to get an idea of how to implement instance methods on <code>Array.prototype</code>.</p><p>If youâ€™d prefer to see a ~5 minute recording of what weâ€™ll do in this post, you can watch the video below; otherwise, carry on!</p><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen frameborder="0" height="315" loading="lazy" src="https://www.youtube.com/embed/kaqu-e3Q7IY" style="margin-top:2rem;" title="JavaScript Implement Your Own map method, mappy, on Array prototype" width="560"></iframe><h2 id="initial-example-use-map-to-convert-film-data-to-html-strings">Initial Example: Use <code>map</code> to Convert Film Data to HTML Strings</h2><p>First, we will start with some code that will demonstrate <em>one</em> way to take an array of films and output certain HTML strings.</p><p>Here is the <code>films</code> array:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// films :: [Film]
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-kr">const</span> <span class="pl-nx">films</span> <span class="pl-o">=</span> <span class="pl-p">[</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">{</span> <span class="pl-nx">title</span><span class="pl-o">:</span> <span class="pl-sb">`Pulp Fiction`</span><span class="pl-p">,</span> <span class="pl-nx">score</span><span class="pl-o">:</span> <span class="pl-mf">8.9</span> <span class="pl-p">},</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">{</span> <span class="pl-nx">title</span><span class="pl-o">:</span> <span class="pl-sb">`Forrest Gump`</span><span class="pl-p">,</span> <span class="pl-nx">score</span><span class="pl-o">:</span> <span class="pl-mf">8.8</span> <span class="pl-p">},</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">{</span> <span class="pl-nx">title</span><span class="pl-o">:</span> <span class="pl-sb">`Interstellar`</span><span class="pl-p">,</span> <span class="pl-nx">score</span><span class="pl-o">:</span> <span class="pl-mf">8.6</span> <span class="pl-p">},</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">{</span> <span class="pl-nx">title</span><span class="pl-o">:</span> <span class="pl-sb">`The Prestige`</span><span class="pl-p">,</span> <span class="pl-nx">score</span><span class="pl-o">:</span> <span class="pl-mf">8.5</span> <span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">]</span></span></span></code></pre><p>and here is the output we are going for:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-p">[</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s1">'&lt;li class="film"&gt;#1 Pulp Fiction: &lt;b&gt;8.9&lt;/b&gt;&lt;/li&gt;'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s1">'&lt;li class="film"&gt;#2 Forrest Gump: &lt;b&gt;8.8&lt;/b&gt;&lt;/li&gt;'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s1">'&lt;li class="film"&gt;#3 Interstellar: &lt;b&gt;8.6&lt;/b&gt;&lt;/li&gt;'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s1">'&lt;li class="film film--last"&gt;#4 The Prestige: &lt;b&gt;8.5&lt;/b&gt;&lt;/li&gt;'</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">]</span></span></span></code></pre><p>Letâ€™s take a closer look at that output. We can see that the following data needs to be included for each item: * position in the list (<code>#3</code>) * <code>title</code> (<code>Interstellar</code>) * <code>score</code> (<code>8.6</code>) * CSS class of <code>film</code>, unless it is the last item, in which case it gets <code>film</code> and <code>film--last</code></p><p>Here is the (somewhat unusual) implementation we will use today in order to later test that we successfully reimplemented <code>Array.prototype.map</code>:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// filmToHtml :: (Film, Index, Films) -&gt; HtmlString
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-kd">function</span> <span class="pl-nx">filmToHtml</span><span class="pl-p">(</span><span class="pl-nx">film</span><span class="pl-p">,</span> <span class="pl-nx">i</span><span class="pl-p">,</span> <span class="pl-nx">films</span><span class="pl-p">)</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-k">return</span> <span class="pl-k">this</span><span class="pl-p">.</span><span class="pl-nx">format</span><span class="pl-p">({</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">index</span><span class="pl-o">:</span> <span class="pl-nx">i</span> <span class="pl-o">+</span> <span class="pl-mi">1</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">isLast</span><span class="pl-o">:</span> <span class="pl-nx">i</span> <span class="pl-o">===</span> <span class="pl-nx">films</span><span class="pl-p">.</span><span class="pl-nx">length</span> <span class="pl-o">-</span> <span class="pl-mi">1</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">score</span><span class="pl-o">:</span> <span class="pl-nx">film</span><span class="pl-p">.</span><span class="pl-nx">score</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">title</span><span class="pl-o">:</span> <span class="pl-nx">film</span><span class="pl-p">.</span><span class="pl-nx">title</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">})</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kd">function</span> <span class="pl-nx">format</span><span class="pl-p">({</span> <span class="pl-nx">index</span><span class="pl-p">,</span> <span class="pl-nx">isLast</span><span class="pl-p">,</span> <span class="pl-nx">score</span><span class="pl-p">,</span> <span class="pl-nx">title</span> <span class="pl-p">})</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-kr">const</span> <span class="pl-nx">cn</span> <span class="pl-o">=</span> <span class="pl-nx">isLast</span> <span class="pl-o">?</span> <span class="pl-sb">`film film--last`</span> <span class="pl-o">:</span> <span class="pl-sb">`film`</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-k">return</span> <span class="pl-sb">`&lt;li class="</span><span class="pl-si">${</span><span class="pl-nx">cn</span><span class="pl-si">}</span><span class="pl-sb">"&gt;#</span><span class="pl-si">${</span><span class="pl-nx">index</span><span class="pl-si">}</span><span class="pl-sb"> </span><span class="pl-si">${</span><span class="pl-nx">title</span><span class="pl-si">}</span><span class="pl-sb">: &lt;b&gt;</span><span class="pl-si">${</span><span class="pl-nx">score</span><span class="pl-si">}</span><span class="pl-sb">&lt;/b&gt;&lt;/li&gt;`</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nx">console</span><span class="pl-p">.</span><span class="pl-nx">log</span><span class="pl-p">(</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">films</span><span class="pl-p">.</span><span class="pl-nx">map</span><span class="pl-p">(</span><span class="pl-nx">filmToHtml</span><span class="pl-p">,</span> <span class="pl-p">{</span> <span class="pl-nx">format</span> <span class="pl-p">})</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// [
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">//   '&lt;li class="film"&gt;#1 Pulp Fiction: &lt;b&gt;8.9&lt;/b&gt;&lt;/li&gt;',
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">//   '&lt;li class="film"&gt;#2 Forrest Gump: &lt;b&gt;8.8&lt;/b&gt;&lt;/li&gt;',
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">//   '&lt;li class="film"&gt;#3 Interstellar: &lt;b&gt;8.6&lt;/b&gt;&lt;/li&gt;',
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">//   '&lt;li class="film film--last"&gt;#4 The Prestige: &lt;b&gt;8.5&lt;/b&gt;&lt;/li&gt;'
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// ]
</span></span></span></code></pre><p>This is probably two-to-three times more complicated than it needs to be, but it is a sufficient example for today, for we make use of <em>all</em> of <code>Array.prototype.map</code>â€™s features.</p><p><em>Note: itâ€™s rare to use the second argument to <code>map</code>, but we are doing so today in order to test our implementation.</em></p><p>So what is going on here?</p><p>The <code>map</code> method iterates over each film and calls <code>filmToHtml</code> with a few arguments:</p><ol><li>the film object</li><li>the filmâ€™s index in the array</li><li>the <code>films</code> array</li></ol><p>It also calls the <code>filmToHtml</code> function with an optional <code>this</code> scope. To demonstrate how this works, we pass an object with the method <code>format</code> that <code>filmToHtml</code> then accesses via <code>this.format</code>. The <code>format</code> function then receives some data points and ultimately returns to us the <code>&lt;li&gt;...&lt;/li&gt;</code> HTML for each film.</p><h2 id="defining-our-own-map-method-mappy">Defining Our Own <code>map</code> Method, <code>mappy</code></h2><p>If we want to write a new method that can be called on our <code>films</code> <code>Array</code> instance, we add it to the <code>Array.prototype</code> like this:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nb">Array</span><span class="pl-p">.</span><span class="pl-nx">prototype</span><span class="pl-p">.</span><span class="pl-nx">mappy</span> <span class="pl-o">=</span> <span class="pl-kd">function</span> <span class="pl-nx">mappy</span><span class="pl-p">(</span><span class="pl-cm">/* ??? */</span><span class="pl-p">)</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// our implementation will go here
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-p">}</span></span></span></code></pre><p>Since a <em>method</em> is a <em>function</em> defined on an object, we know we are working with a function, but what arguments does our function accept?</p><h2 id="what-is-maps-syntax">What Is <code>map</code>â€™s Syntax?</h2><p>As hinted at in a prior section, if we look at <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map#Syntax">MDNâ€™s <code>Array.prototype.map</code> syntax documentation</a>, we can see that we need:</p><ol><li>a <code>callback</code> that gets called with an optional scope and 3 arguments: <ol><li>the currently iterated item</li><li>the current itemâ€™s array index (an integer)</li><li>the source array that <code>map</code> is called upon</li></ol></li><li>an optional value to use as <code>this</code> when calling the callback</li></ol><h2 id="filling-in-the-argument-blanks">Filling In The Argument Blanks</h2><p>Letâ€™s give our <code>mappy</code> method a <code>callback</code> parameter, as well as an optional <code>thisArg</code>, which weâ€™ll simply name <code>_this</code>.</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nb">Array</span><span class="pl-p">.</span><span class="pl-nx">prototype</span><span class="pl-p">.</span><span class="pl-nx">mappy</span> <span class="pl-o">=</span> <span class="pl-kd">function</span> <span class="pl-nx">mappy</span><span class="pl-p">(</span><span class="pl-nx">callback</span><span class="pl-p">,</span> <span class="pl-nx">_this</span><span class="pl-p">)</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// Let's then have it return our array instance
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>  <span class="pl-c1">// by returning the special `this` keyword.
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>  <span class="pl-k">return</span> <span class="pl-k">this</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nx">console</span><span class="pl-p">.</span><span class="pl-nx">log</span><span class="pl-p">(</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">films</span><span class="pl-p">.</span><span class="pl-nx">map</span><span class="pl-p">(</span><span class="pl-nx">filmToHtml</span><span class="pl-p">,</span> <span class="pl-p">{</span> <span class="pl-nx">format</span> <span class="pl-p">})</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// [
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">//  { title: `Pulp Fiction`, score: 8.9 },
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">//  { title: `Forrest Gump`, score: 8.8 },
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">//  { title: `Interstellar`, score: 8.6 },
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">//  { title: `The Prestige`, score: 8.5 }
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// ]
</span></span></span></code></pre><p>Since our <code>mappy</code> method, like <code>map</code>, will not alter the original array, we know weâ€™ll need to return a new array, so letâ€™s do that and return the empty array:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nb">Array</span><span class="pl-p">.</span><span class="pl-nx">prototype</span><span class="pl-p">.</span><span class="pl-nx">mappy</span> <span class="pl-o">=</span> <span class="pl-kd">function</span> <span class="pl-nx">mappy</span><span class="pl-p">(</span><span class="pl-nx">callback</span><span class="pl-p">,</span> <span class="pl-nx">_this</span><span class="pl-p">)</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-kr">const</span> <span class="pl-nx">newArray</span> <span class="pl-o">=</span> <span class="pl-p">[]</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-k">return</span> <span class="pl-nx">newArray</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nx">console</span><span class="pl-p">.</span><span class="pl-nx">log</span><span class="pl-p">(</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">films</span><span class="pl-p">.</span><span class="pl-nx">map</span><span class="pl-p">(</span><span class="pl-nx">filmToHtml</span><span class="pl-p">,</span> <span class="pl-p">{</span> <span class="pl-nx">format</span> <span class="pl-p">})</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// []
</span></span></span></code></pre><h2 id="the-implementation">The Implementation</h2><p>Now that we have a <code>newArray</code>, know we can work with <code>this</code>, have a <code>callback</code> to call and a <code>_this</code> scope to call the <code>callback</code> with, we can populate the <code>newArray</code> with the result of calling the <code>callback</code> function with each item in our array (and with the appropriate arguments, of course):</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nb">Array</span><span class="pl-p">.</span><span class="pl-nx">prototype</span><span class="pl-p">.</span><span class="pl-nx">mappy</span> <span class="pl-o">=</span> <span class="pl-kd">function</span> <span class="pl-nx">mappy</span><span class="pl-p">(</span><span class="pl-nx">callback</span><span class="pl-p">,</span> <span class="pl-nx">_this</span><span class="pl-p">)</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-kr">const</span> <span class="pl-nx">newArray</span> <span class="pl-o">=</span> <span class="pl-p">[]</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// We'll use a for loop to iterate over
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>  <span class="pl-c1">// each item in our list,
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>  <span class="pl-k">for</span> <span class="pl-p">(</span><span class="pl-kd">let</span> <span class="pl-nx">i</span> <span class="pl-o">=</span> <span class="pl-mi">0</span><span class="pl-p">;</span> <span class="pl-nx">i</span> <span class="pl-o">&lt;</span> <span class="pl-k">this</span><span class="pl-p">.</span><span class="pl-nx">length</span><span class="pl-p">;</span> <span class="pl-nx">i</span><span class="pl-o">++</span><span class="pl-p">)</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-c1">// and then at the end of our `newArray`
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>    <span class="pl-c1">// we'll append the result of calling
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>    <span class="pl-c1">// the callback function with the optional
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>    <span class="pl-c1">// scope and its 3 arguments:
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>    <span class="pl-c1">//   1. the item,
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>    <span class="pl-c1">//   2. the current item's index in the array,
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>    <span class="pl-c1">//   3. and lastly the original list, itself.
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>    <span class="pl-nx">newArray</span><span class="pl-p">.</span><span class="pl-nx">push</span><span class="pl-p">(</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-nx">callback</span><span class="pl-p">.</span><span class="pl-nx">call</span><span class="pl-p">(</span><span class="pl-nx">_this</span><span class="pl-p">,</span> <span class="pl-k">this</span><span class="pl-p">[</span><span class="pl-nx">i</span><span class="pl-p">],</span> <span class="pl-nx">i</span><span class="pl-p">,</span> <span class="pl-k">this</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-c1">// Ultimately, we return the `newArray`
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>  <span class="pl-c1">// containing our transformed items.
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>  <span class="pl-k">return</span> <span class="pl-nx">newArray</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// And when we log out the result,
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// we can see our `filmToHtml` function
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// works as expected.
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-nx">console</span><span class="pl-p">.</span><span class="pl-nx">log</span><span class="pl-p">(</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">films</span><span class="pl-p">.</span><span class="pl-nx">map</span><span class="pl-p">(</span><span class="pl-nx">filmToHtml</span><span class="pl-p">,</span> <span class="pl-p">{</span> <span class="pl-nx">format</span> <span class="pl-p">})</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// [
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">//   '&lt;li class="film"&gt;#1 Pulp Fiction: &lt;b&gt;8.9&lt;/b&gt;&lt;/li&gt;',
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">//   '&lt;li class="film"&gt;#2 Forrest Gump: &lt;b&gt;8.8&lt;/b&gt;&lt;/li&gt;',
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">//   '&lt;li class="film"&gt;#3 Interstellar: &lt;b&gt;8.6&lt;/b&gt;&lt;/li&gt;',
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">//   '&lt;li class="film film--last"&gt;#4 The Prestige: &lt;b&gt;8.5&lt;/b&gt;&lt;/li&gt;'
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// ]
</span></span></span></code></pre><h2 id="providing-useful-error-messaging">Providing Useful Error Messaging</h2><p>What happens if someone tries to use our <code>mappy</code> method but doesnâ€™t provide a callback function? For example:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nx">films</span><span class="pl-p">.</span><span class="pl-nx">mappy</span><span class="pl-p">(</span><span class="pl-mi">123</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// TypeError: callback.call is not a function
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nx">films</span><span class="pl-p">.</span><span class="pl-nx">map</span><span class="pl-p">(</span><span class="pl-mi">123</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// TypeError: 123 is not a function
</span></span></span></code></pre><p>Unfortunately, our <code>mappy</code> method doesnâ€™t take this scenario into account! But the <code>map</code> methodâ€™s error messaging isnâ€™t totally clear at a glance, either, so letâ€™s try a different approach:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nb">Array</span><span class="pl-p">.</span><span class="pl-nx">prototype</span><span class="pl-p">.</span><span class="pl-nx">mappy</span> <span class="pl-o">=</span> <span class="pl-kd">function</span> <span class="pl-nx">mappy</span><span class="pl-p">(</span><span class="pl-nx">callback</span><span class="pl-p">,</span> <span class="pl-nx">_this</span><span class="pl-p">)</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-k">if</span> <span class="pl-p">(</span><span class="pl-k">typeof</span> <span class="pl-nx">callback</span> <span class="pl-o">!==</span> <span class="pl-s1">'function'</span><span class="pl-p">)</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-nx">TypeError</span><span class="pl-p">(</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-s1">'Array.prototype.mappy: '</span> <span class="pl-o">+</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-s1">'A callback function was expected '</span> <span class="pl-o">+</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-s1">'as the first argument, but we received '</span> <span class="pl-o">+</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-s1">'`'</span> <span class="pl-o">+</span> <span class="pl-nx">JSON</span><span class="pl-p">.</span><span class="pl-nx">stringify</span><span class="pl-p">(</span><span class="pl-nx">callback</span><span class="pl-p">)</span> <span class="pl-o">+</span> <span class="pl-s1">'`'</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-kr">const</span> <span class="pl-nx">newArray</span> <span class="pl-o">=</span> <span class="pl-p">[]</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-k">for</span> <span class="pl-p">(</span><span class="pl-kd">let</span> <span class="pl-nx">i</span> <span class="pl-o">=</span> <span class="pl-mi">0</span><span class="pl-p">;</span> <span class="pl-nx">i</span> <span class="pl-o">&lt;</span> <span class="pl-k">this</span><span class="pl-p">.</span><span class="pl-nx">length</span><span class="pl-p">;</span> <span class="pl-nx">i</span><span class="pl-o">++</span><span class="pl-p">)</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">newArray</span><span class="pl-p">.</span><span class="pl-nx">push</span><span class="pl-p">(</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-nx">callback</span><span class="pl-p">.</span><span class="pl-nx">call</span><span class="pl-p">(</span><span class="pl-nx">_this</span><span class="pl-p">,</span> <span class="pl-k">this</span><span class="pl-p">[</span><span class="pl-nx">i</span><span class="pl-p">],</span> <span class="pl-nx">i</span><span class="pl-p">,</span> <span class="pl-k">this</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-k">return</span> <span class="pl-nx">newArray</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nx">films</span><span class="pl-p">.</span><span class="pl-nx">mappy</span><span class="pl-p">(</span><span class="pl-mi">123</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// TypeError:
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">//   Array.prototype.mappy: A callback function was
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">//   expected as the first argument, but we received `123`
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nx">films</span><span class="pl-p">.</span><span class="pl-nx">mappy</span><span class="pl-p">({</span> <span class="pl-nx">foo</span><span class="pl-o">:</span> <span class="pl-s1">'bar'</span> <span class="pl-p">})</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// TypeError:
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">//   Array.prototype.mappy: A callback function was
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">//   expected as the first argument, but we received `{"foo":"bar"}`
</span></span></span></code></pre><h2 id="wrapping-up">Wrapping Up</h2><p>I hope this post has helped de-mystify how <code>Array.prototype.map</code> conceptually works under the hood! Next time, weâ€™ll look at how to implement <code>map</code> without polluting the <code>Array.prototype</code>, and we might even be able to use <code>map</code> on more data structures than just <code>Array</code>! Stay tuned.</p><hr /><p>Thank you for reading! <br /> Robert</p></section></main><footer><span aria-hidden="true" class="heart">â™¥</span><span aria-hidden="true">&rarr;</span><a href="https://github.com/sponsors/rpearce/">Sponsor my work</a><span aria-hidden="true">&larr;</span><span aria-hidden="true" class="heart">â™¥</span></footer><script async> (() => { const themeEl = document.querySelector('[data-select-theme]'); if (themeEl) { themeEl.querySelector('[value="'+window.site.prefTheme+'"]').selected = 'selected'; themeEl.addEventListener('change', e => { window.site.setTheme(e.target.value); }); } const fontEl = document.querySelector('[data-select-font]'); if (fontEl) { fontEl.querySelector('[value="'+window.site.prefFont+'"]').selected = 'selected'; fontEl.addEventListener('change', e => { window.site.setFont(e.target.value); }) } })(); </script></body></html>