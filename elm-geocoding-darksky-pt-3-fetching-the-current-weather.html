<!DOCTYPE html><html lang="en"><head><title>Elm, Geocoding & DarkSky: Pt. 3 â€“ Fetching the Current Weather</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="In Part 3 we query the DarkSky API with our geocoded address"><meta name="author" content="Robert Pearce"><meta name="keywords" content="elm, elm tutorial, elmlang, elm geocoding, elm darksky, elm weather, elm functional programming"><meta name="google-site-verification" content="QX4bn65yOXBfgnwxlO09yIBc1H8blur-Erx3lmsDVhU"><meta http-equiv="origin-trial" content="Am4BZ0c7GMyB72dgo/Ny2FfIFscXhYMoN+CVe4jduWh24FvsaCwf7kjZzHzfrJXtIilyZVAEKRxOItGLY7lvkAgAAABSeyJvcmlnaW4iOiJodHRwczovL3JvYmVydHdwZWFyY2UuY29tOjQ0MyIsImZlYXR1cmUiOiJQb3J0YWxzIiwiZXhwaXJ5IjoxNjAzNTQ2NDc3fQ=="><meta property="og:site_name" content="Robert Pearce"><meta property="og:title" content="Elm, Geocoding & DarkSky: Pt. 3 â€“ Fetching the Current Weather"><meta property="og:url" content="https://robertwpearce.com/elm-geocoding-darksky-pt-3-fetching-the-current-weather.html"><meta property="og:description" content="In Part 3 we query the DarkSky API with our geocoded address"><meta property="og:type" content="article"><meta property="twitter:site" content="Robert Pearce"><meta property="twitter:title" content="Elm, Geocoding & DarkSky: Pt. 3 â€“ Fetching the Current Weather"><meta property="twitter:description" content="In Part 3 we query the DarkSky API with our geocoded address"><meta property="twitter:creator" content="@RobertWPearce"><link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ðŸ’¾</text></svg>"><link rel="canonical" href="https://robertwpearce.com/elm-geocoding-darksky-pt-3-fetching-the-current-weather.html"><link rel="alternate" href="./atom.xml" title="Robert Pearce's blog" type="application/atom+xml"><link rel="alternate" href="./rss.xml" title="Robert Pearce's blog" type="application/rss+xml"><link rel="stylesheet" href="./css/base.css"><link rel="stylesheet" href="./css/t-clean.css"><link rel="stylesheet" href="./css/t-clean-note.css"><link rel="stylesheet" href="./css/t-code-dracula.css"><link rel="prefetch" href="./css/t-clean-note.css"></head><body data-theme="clean-night"><script> (() => { window.site = { prefFont: localStorage.getItem('prefFont') || 'monospace', setFont: (family) => { localStorage.setItem('prefFont', family); const rootStyle = document.querySelector(':root').style; rootStyle.setProperty('--type-family-body', family+',monospace'); /* Remove when https://github.com/googlefonts/spacemono/pull/2 is resolved */ if (family === 'Liga Space Mono') { rootStyle.setProperty('font-feature-settings', '"liga" 0'); } else { rootStyle.removeProperty('font-feature-settings'); } return window.site._fetchFont(family); }, prefTheme: localStorage.getItem('prefTheme') || (matchMedia('(prefers-color-scheme: dark)').matches ? 'clean-night' : 'clean-day'), setTheme: (name) => { const rootStyle = document.querySelector(':root').style; if (name === 'clean-night') { rootStyle.removeProperty('color-scheme'); } else { rootStyle.setProperty('color-scheme', 'light'); } document.body.setAttribute('data-theme', name); localStorage.setItem('prefTheme', name); }, _fetchFont: (family) => { if (family === 'monospace') { return Promise.resolve(); } const familyNoSpaces = family.replaceAll(' ', ''); const fontz = [ new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-Regular.woff2") format("woff2")', { display: 'swap', weight: 400 }), new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-Bold.woff2") format("woff2")', { display: 'swap', weight: 700 }), ]; if (family !== 'Fira Code') { fontz.push( new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-Italic.woff2") format("woff2")', { display: 'swap', style: 'italic', weight: 400 }), new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-BoldItalic.woff2") format("woff2")', { display: 'swap', style: 'italic', weight: 700 }) ); } for (const f of fontz) { document.fonts.add(f); } return Promise.allSettled(fontz).then(results => { results.forEach((res, i) => { if (res.status === 'rejected') { console.error('site failed to load font: ' + fontz[i]?.family ?? 'unknown'); } }); }); } }; window.site.setTheme(window.site.prefTheme); window.site.setFont(window.site.prefFont); })(); </script><header><nav><div class="nav-skip"><a href="#content">Skip to content</a></div><a aria-label="Home" class="nav-home" href="./">~</a><span>/</span></nav><div class="header-extra"><a href="./atom.xml">RSS</a><span aria-hidden="true">&compfn;</span><noscript>(requires JS &rarr;)</noscript><label for="select-theme">Theme</label><select data-select-theme id="select-theme"><option value="clean-day">Clean (Day)</option><option value="clean-night">Clean (Night)</option></select><span aria-hidden="true">&compfn;</span><label for="select-font">Font</label><select data-select-font id="select-font"><option value="monospace">monospace</option><option value="Liga Space Mono">Space Mono</option><option value="Victor Mono">Victor Mono</option><option value="Fira Code">Fira Code</option><option value="JetBrains Mono">JetBrains Mono</option></select></div></header><main id="content"><header data-area="heading"><h1>Elm, Geocoding & DarkSky: Pt. 3 â€“ Fetching the Current Weather</h1></header><section data-area="meta"><h2>Info</h2><table data-type="cols-y"><tbody><tr><th>Summary</th><td>In Part 3 we query the DarkSky API with our geocoded address</td></tr><tr><th>Shared</th><td>2017-08-18</td></tr></tbody></table></section><section data-area="note"><p>This is part 3 of a multipart series where we will be building a small weather forecast app using <a href="http://elm-lang.org/">Elm</a>, <a href="https://developers.google.com/maps/documentation/geocoding/start">Googleâ€™s Geocoding API</a> and the <a href="https://darksky.net/dev/">DarkSky API</a>. Instead of doing everything in one massive post, Iâ€™ve broken the steps down into parts of a series. Here is the series plan:</p><ul><li><a href="/elm-geocoding-and-darksky-pt-1-setup-elm-and-proxy-servers.html">Pt. 1 â€“ Setup Elm &amp; Proxy Servers</a></li><li><a href="/elm-geocoding-and-darksky-pt-2-geocoding-an-address.html">Pt. 2 â€“ Geocoding an Address</a></li><li>Pt. 3 â€“ Fetching the Current Weather</li><li><a href="/elm-geocoding-and-darksky-pt-4-extracting-our-elm-code.html">Pt. 4 â€“ Extracting Our Elm Code</a></li></ul><p>If youâ€™d like to code along with this tutorial, check out <a href="/elm-geocoding-and-darksky-pt-1-setup-elm-and-proxy-servers.html">part 1</a> and <a href="/elm-geocoding-and-darksky-pt-2-fetching-the-current-weather.html">part 2</a> first to get set up.</p><p><em>Note: to learn more about the Elm language and syntax, check out the <a href="https://www.elm-tutorial.org/en/">Elm Tutorial</a>, the <a href="https://egghead.io/courses/start-using-elm-to-build-web-applications">EggHead.io Elm course</a>, subscribe to <a href="https://www.dailydrip.com/topics/elm">DailyDripâ€™s Elm Topic</a>, <a href="http://courses.knowthen.com">James Mooreâ€™s Elm Courses</a> or check out <a href="http://exercism.io/languages/elm/about">Elm on exercism.io</a>.</em></p><h2 id="overview">Overview</h2><p>In this post we will use Elm to fetch and display the current weather based on the geocode data we receive from an input field.</p><h2 id="project-source-code">Project Source Code</h2><p>The project weâ€™re making will be broken into parts here (branches will be named for each part): <a href="https://github.com/rpearce/elm-geocoding-darksky/">https://github.com/rpearce/elm-geocoding-darksky/</a>. Be sure to check out the other branches to see the other parts as they become available.</p><p>The code for this part is located in the <code>pt-3</code> branch: <a href="https://github.com/rpearce/elm-geocoding-darksky/tree/pt-3">https://github.com/rpearce/elm-geocoding-darksky/tree/pt-3</a>.</p><h2 id="steps-for-today">Steps for Today</h2><ol><li>Understanding DarkSkyâ€™s response data</li><li>Modeling the DarkSky response data</li><li>Creating DarkSky JSON decoders</li><li>Writing our fetchWeather HTTP function</li><li>Calling fetchWeather and handling the response</li><li>Displaying the current weather in our view</li></ol><h2 id="1-understanding-darkskys-response-data">1. Understanding DarkSkyâ€™s response data</h2><p>Letâ€™s get the weather data for Auckland, NZ (-36.8484597,174.7633315). If we start up our <a href="https://github.com/rpearce/DarkSky-proxy">DarkSky proxy</a> and run</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">Î» curl localhost:5051/forecast/-36.8484597,174.7633315</span></span></code></pre><p>then we will see response data like this:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nt">"timezone"</span><span class="pl-p">:</span> <span class="pl-s2">"Pacific\/Auckland"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nt">"currently"</span><span class="pl-p">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nt">"summary"</span><span class="pl-p">:</span> <span class="pl-s2">"Overcast"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nt">"icon"</span><span class="pl-p">:</span> <span class="pl-s2">"cloudy"</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nt">"temperature"</span><span class="pl-p">:</span> <span class="pl-mf">61.42</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-err">...</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">},</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nt">"hourly"</span><span class="pl-p">:</span> <span class="pl-p">{</span> <span class="pl-err">...</span> <span class="pl-p">},</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nt">"daily"</span><span class="pl-p">:</span> <span class="pl-p">{</span> <span class="pl-err">...</span> <span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">}</span></span></span></code></pre><p>While all we care about are the <code>summary</code>, <code>icon</code> and <code>temperature</code> properties within the top-level <code>currently</code> property, we will only use <code>temperature</code> in this part.</p><p>Disclaimer: DarkSky units are in <code>us</code> by default. You can specify other unit types by appending a <code>units</code> query parameter to the end like this:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">Î» curl localhost:5051/forecast/-36.8484597,174.7633315?units=si</span></span></code></pre><p>Read more about <a href="https://darksky.net/dev/docs/forecast">DarkSky request parameters in the DarkSky docs</a> to customize your response data.</p><p>Now that weâ€™ve got our data in the correct units, letâ€™s model this data in Elm!</p><h2 id="2-modeling-the-darksky-response-data">2. Modeling the DarkSky response data</h2><p>Based on our DarkSky response, letâ€™s list out what weâ€™re looking at:</p><ul><li>an object, <code>currently</code>, which has 3 notable properties: <ul><li>a string, <code>summary</code></li><li>a string, <code>icon</code></li><li>a float, <code>temperature</code></li></ul></li></ul><p>Since we have two levels of data, <code>currently</code> and its child properties, letâ€™s create two type aliases to represent this data.</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-kr">type</span> <span class="pl-kr">alias</span> <span class="pl-kt">Weather</span> <span class="pl-nf">=</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">{</span> <span class="pl-nv">currently</span> <span class="pl-nf">:</span> <span class="pl-kt">WeatherCurrently</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">type</span> <span class="pl-kr">alias</span> <span class="pl-kt">WeatherCurrently</span> <span class="pl-nf">=</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">{</span> <span class="pl-nv">icon</span> <span class="pl-nf">:</span> <span class="pl-kt">String</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">,</span> <span class="pl-nv">summary</span> <span class="pl-nf">:</span> <span class="pl-kt">String</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">,</span> <span class="pl-nv">temperature</span> <span class="pl-nf">:</span> <span class="pl-kt">Float</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">}</span></span></span></code></pre><p>And now we can add a property to our <code>Model</code> type alias that can be of our <code>Weather</code> type:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-kr">type</span> <span class="pl-kr">alias</span> <span class="pl-kt">Model</span> <span class="pl-nf">=</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">{</span> <span class="pl-nv">address</span> <span class="pl-nf">:</span> <span class="pl-kt">String</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">,</span> <span class="pl-nv">coords</span> <span class="pl-nf">:</span> <span class="pl-kt">Coords</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">,</span> <span class="pl-nv">weather</span> <span class="pl-nf">:</span> <span class="pl-kt">Weather</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">}</span></span></span></code></pre><p>Uh oh! Our <code>Model</code> has a defaults function called <code>initialModel</code>, and now that weâ€™ve added <code>weather</code> into the mix, weâ€™ll need to give that default values, as well:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nv">initialModel</span> <span class="pl-nf">:</span> <span class="pl-kt">Model</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nv">initialModel</span> <span class="pl-nf">=</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">{</span> <span class="pl-nv">address</span> <span class="pl-nf">=</span> <span class="pl-s">""</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">,</span> <span class="pl-nv">coords</span> <span class="pl-nf">=</span> <span class="pl-p">(</span> <span class="pl-mi">0</span><span class="pl-p">,</span> <span class="pl-mi">0</span> <span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">,</span> <span class="pl-nv">weather</span> <span class="pl-nf">=</span> <span class="pl-nv">initialWeather</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nv">initialWeather</span> <span class="pl-nf">:</span> <span class="pl-kt">Weather</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nv">initialWeather</span> <span class="pl-nf">=</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">{</span> <span class="pl-nv">currently</span> <span class="pl-nf">=</span> <span class="pl-nv">initialWeatherCurrently</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nv">initialWeatherCurrently</span> <span class="pl-nf">:</span> <span class="pl-kt">WeatherCurrently</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nv">initialWeatherCurrently</span> <span class="pl-nf">=</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">{</span> <span class="pl-nv">icon</span> <span class="pl-nf">=</span> <span class="pl-s">"â€“"</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">,</span> <span class="pl-nv">summary</span> <span class="pl-nf">=</span> <span class="pl-s">"â€“"</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">,</span> <span class="pl-nv">temperature</span> <span class="pl-nf">=</span> <span class="pl-mi">0</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">}</span></span></span></code></pre><p>These are defaults that we provide in the event that we have no data to work with (initially or if something goes wrong).</p><h2 id="3-creating-darksky-json-decoders">3. Creating DarkSky JSON decoders</h2><p>Just as we did in the <a href="/elm-geocoding-and-darksky-pt-2-geocoding-an-address.html#4-creating-json-decoders">geocoding post section on JSON decoding</a>, we want to leverage <a href="https://github.com/NoRedInk/elm-decode-pipeline">NoRedInkâ€™s elm-decode-pipeline</a> to define how our JSON response should be structured and thus parsed.</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nv">decodeWeather</span> <span class="pl-nf">:</span> <span class="pl-kt">Decoder</span> <span class="pl-kt">Weather</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nv">decodeWeather</span> <span class="pl-nf">=</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nv">decode</span> <span class="pl-kt">Weather</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-nf">|&gt;</span> <span class="pl-nv">required</span> <span class="pl-s">"currently"</span> <span class="pl-nv">decodeWeatherCurrently</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nv">decodeWeatherCurrently</span> <span class="pl-nf">:</span> <span class="pl-kt">Decoder</span> <span class="pl-kt">WeatherCurrently</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nv">decodeWeatherCurrently</span> <span class="pl-nf">=</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nv">decode</span> <span class="pl-kt">WeatherCurrently</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-nf">|&gt;</span> <span class="pl-nv">required</span> <span class="pl-s">"icon"</span> <span class="pl-nv">string</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-nf">|&gt;</span> <span class="pl-nv">required</span> <span class="pl-s">"summary"</span> <span class="pl-nv">string</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-nf">|&gt;</span> <span class="pl-nv">required</span> <span class="pl-s">"temperature"</span> <span class="pl-nv">float</span></span></span></code></pre><p>While we could use <a href="http://package.elm-lang.org/packages/elm-lang/core/5.1.1/Json-Decode#at">Json.Decode.at</a> to potentially have less code, there is absolutely nothing wrong with being verbose if it leads to clarity.</p><h2 id="4-writing-our-fetchweather-http-function">4. Writing our fetchWeather HTTP function</h2><p>We know that weâ€™re going to have to send latitude and longitude <code>Coords</code> to our <a href="https://github.com/rpearce/DarkSky-proxy">DarkSky proxy server</a>, as well as any additional options, so letâ€™s define the URL for that and the fetching function <a href="/elm-geocoding-and-darksky-pt-2-geocoding-an-address.html#8-making-our-request">just like we did for geocoding</a>.</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nv">weatherUrl</span> <span class="pl-nf">:</span> <span class="pl-kt">Coords</span> <span class="pl-nf">-&gt;</span> <span class="pl-kt">String</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nv">weatherUrl</span> <span class="pl-p">(</span> <span class="pl-nv">lat</span><span class="pl-p">,</span> <span class="pl-nv">lng</span> <span class="pl-p">)</span> <span class="pl-nf">=</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-s">"http://localhost:5051/forecast/"</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-nf">++</span> <span class="pl-p">(</span><span class="pl-nv">toString</span> <span class="pl-nv">lat</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-nf">++</span> <span class="pl-s">","</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-nf">++</span> <span class="pl-p">(</span><span class="pl-nv">toString</span> <span class="pl-nv">lng</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-c1">-- this is where you can add your query params</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nv">fetchWeather</span> <span class="pl-nf">:</span> <span class="pl-kt">Coords</span> <span class="pl-nf">-&gt;</span> <span class="pl-kt">Cmd</span> <span class="pl-kt">Msg</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nv">fetchWeather</span> <span class="pl-nv">coords</span> <span class="pl-nf">=</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-kt">Http</span><span class="pl-nf">.</span><span class="pl-nv">get</span> <span class="pl-p">(</span><span class="pl-nv">weatherUrl</span> <span class="pl-nv">coords</span><span class="pl-p">)</span> <span class="pl-nv">decodeWeather</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-nf">|&gt;</span> <span class="pl-kt">Http</span><span class="pl-nf">.</span><span class="pl-nv">send</span> <span class="pl-kt">ReceiveWeather</span></span></span></code></pre><p>To define an HTTP request in Elm, we need * âœ… a URL to point to * âœ… a package like Http to help us build the request * âœ… a decoder to handle parsing the response data * ðŸ¤· a <code>Msg</code> type that our <code>update</code> function can pattern match on</p><p>Right! We canâ€™t forget to add <code>ReceiveWeather</code> as a <code>Msg</code> type. It should be almost the same as <code>ReceiveGeocoding</code>:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-kr">type</span> <span class="pl-kt">Msg</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nf">=</span> <span class="pl-kt">UpdateAddress</span> <span class="pl-kt">String</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nf">|</span> <span class="pl-kt">SendAddress</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nf">|</span> <span class="pl-kt">ReceiveGeocoding</span> <span class="pl-p">(</span><span class="pl-kt">Result</span> <span class="pl-kt">Http</span><span class="pl-nf">.</span><span class="pl-kt">Error</span> <span class="pl-kt">GeoModel</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nf">|</span> <span class="pl-kt">ReceiveWeather</span> <span class="pl-p">(</span><span class="pl-kt">Result</span> <span class="pl-kt">Http</span><span class="pl-nf">.</span><span class="pl-kt">Error</span> <span class="pl-kt">Weather</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nf">|</span> <span class="pl-kt">NoOp</span></span></span></code></pre><h2 id="5-calling-fetchweather-and-handling-the-response">5. Calling fetchWeather and handling the response</h2><p>When we <a href="/elm-geocoding-and-darksky-pt-2-geocoding-an-address.html#9-handling-the-geocode-response">handled our geocode response in the prior post</a>, inside of <code>ReceiveGeocoding</code> we returned <code>( newModel, Cmd.none )</code>, for we had no further actions to take. Instead of our action in this tuple being <code>Cmd.none</code>, letâ€™s instead call our <code>fetchWeather</code> function and pass it our geocoded coordinates:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nv">update</span> <span class="pl-nf">:</span> <span class="pl-kt">Msg</span> <span class="pl-nf">-&gt;</span> <span class="pl-kt">Model</span> <span class="pl-nf">-&gt;</span> <span class="pl-p">(</span> <span class="pl-kt">Model</span><span class="pl-p">,</span> <span class="pl-kt">Cmd</span> <span class="pl-kt">Msg</span> <span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nv">update</span> <span class="pl-nv">msg</span> <span class="pl-nv">model</span> <span class="pl-nf">=</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-kr">case</span> <span class="pl-nv">msg</span> <span class="pl-kr">of</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-c1">-- ...removed for brevity</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-kt">ReceiveGeocoding</span> <span class="pl-p">(</span><span class="pl-kt">Ok</span> <span class="pl-p">{</span> <span class="pl-nv">results</span><span class="pl-p">,</span> <span class="pl-nv">status</span> <span class="pl-p">})</span> <span class="pl-nf">-&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-kr">let</span>
</span></span><span class="pl-line"><span class="pl-cl">                <span class="pl-c1">-- ...</span>
</span></span><span class="pl-line"><span class="pl-cl">                <span class="pl-nv">newModel</span> <span class="pl-nf">=</span>
</span></span><span class="pl-line"><span class="pl-cl">                    <span class="pl-c1">-- ...</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-kr">in</span>
</span></span><span class="pl-line"><span class="pl-cl">                <span class="pl-p">(</span> <span class="pl-nv">newModel</span><span class="pl-p">,</span> <span class="pl-nv">fetchWeather</span> <span class="pl-nv">newModel</span><span class="pl-nf">.</span><span class="pl-nv">coords</span> <span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-c1">-- ...</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-kt">ReceiveWeather</span> <span class="pl-p">(</span><span class="pl-kt">Ok</span> <span class="pl-nv">resp</span><span class="pl-p">)</span> <span class="pl-nf">-&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-p">(</span> <span class="pl-p">{</span> <span class="pl-nv">model</span> <span class="pl-nf">|</span> <span class="pl-nv">weather</span> <span class="pl-nf">=</span> <span class="pl-p">{</span> <span class="pl-nv">currently</span> <span class="pl-nf">=</span> <span class="pl-nv">resp</span><span class="pl-nf">.</span><span class="pl-nv">currently</span> <span class="pl-p">}</span> <span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-p">,</span> <span class="pl-kt">Cmd</span><span class="pl-nf">.</span><span class="pl-nv">none</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-kt">ReceiveWeather</span> <span class="pl-p">(</span><span class="pl-kt">Err</span> <span class="pl-nv">_</span><span class="pl-p">)</span> <span class="pl-nf">-&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-p">(</span> <span class="pl-nv">model</span><span class="pl-p">,</span> <span class="pl-kt">Cmd</span><span class="pl-nf">.</span><span class="pl-nv">none</span> <span class="pl-p">)</span></span></span></code></pre><p>Again, at the end of <code>ReceiveGeocoding</code>, we return our <code>newModel</code> as well as the command to go and fetch the weather with the coordinates weâ€™re storing on our <code>newModel</code>.</p><p>Whenever the HTTP request and decoding gives us back a result with the <code>Msg</code> type of <code>ReceiveWeather</code>, we then update the weather property on our model record to have the <code>currently</code> data parsed from the decoder.</p><h2 id="6-displaying-the-current-weather-in-our-view">6. Displaying the current weather in our view</h2><p>Finally, to make sure weâ€™re doing each step correctly, letâ€™s add the temperature to our view:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nv">view</span> <span class="pl-nf">:</span> <span class="pl-kt">Model</span> <span class="pl-nf">-&gt;</span> <span class="pl-kt">Html</span> <span class="pl-kt">Msg</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nv">view</span> <span class="pl-nv">model</span> <span class="pl-nf">=</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nv">div</span> <span class="pl-p">[]</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-p">[</span> <span class="pl-nv">form</span> <span class="pl-p">[</span> <span class="pl-nv">onSubmit</span> <span class="pl-kt">SendAddress</span> <span class="pl-p">]</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-p">[</span> <span class="pl-nv">input</span>
</span></span><span class="pl-line"><span class="pl-cl">                <span class="pl-p">[</span> <span class="pl-nv">type_</span> <span class="pl-s">"text"</span>
</span></span><span class="pl-line"><span class="pl-cl">                <span class="pl-p">,</span> <span class="pl-nv">placeholder</span> <span class="pl-s">"City"</span>
</span></span><span class="pl-line"><span class="pl-cl">                <span class="pl-p">,</span> <span class="pl-nv">value</span> <span class="pl-nv">model</span><span class="pl-nf">.</span><span class="pl-nv">address</span>
</span></span><span class="pl-line"><span class="pl-cl">                <span class="pl-p">,</span> <span class="pl-nv">onInput</span> <span class="pl-kt">UpdateAddress</span>
</span></span><span class="pl-line"><span class="pl-cl">                <span class="pl-p">]</span>
</span></span><span class="pl-line"><span class="pl-cl">                <span class="pl-p">[]</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-p">]</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-p">,</span> <span class="pl-nv">p</span> <span class="pl-p">[]</span> <span class="pl-p">[</span> <span class="pl-nv">text</span> <span class="pl-p">(</span><span class="pl-s">"Coords: "</span> <span class="pl-nf">++</span> <span class="pl-p">(</span><span class="pl-nv">toString</span> <span class="pl-nv">model</span><span class="pl-nf">.</span><span class="pl-nv">coords</span><span class="pl-p">))</span> <span class="pl-p">]</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-p">,</span> <span class="pl-nv">p</span> <span class="pl-p">[]</span> <span class="pl-p">[</span> <span class="pl-nv">text</span> <span class="pl-p">(</span><span class="pl-s">"Weather: "</span> <span class="pl-nf">++</span> <span class="pl-p">(</span><span class="pl-nv">toString</span> <span class="pl-p">(</span><span class="pl-nv">round</span> <span class="pl-nv">model</span><span class="pl-nf">.</span><span class="pl-nv">weather</span><span class="pl-nf">.</span><span class="pl-nv">currently</span><span class="pl-nf">.</span><span class="pl-nv">temperature</span><span class="pl-p">)))</span> <span class="pl-p">]</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-p">]</span></span></span></code></pre><p>Here we use <a href="http://package.elm-lang.org/packages/elm-lang/core/latest/Basics#round">Basics.round</a> because an approximation is alright for weather.</p><p>Now, when you rebuild your code with <code>./build</code>, open <code>index.html</code> and submit a city/address name, youâ€™ll first see the <code>Coords</code> update on the page and then see the <code>Weather</code> result once itâ€™s done.</p><h2 id="wrapping-up">Wrapping Up</h2><p>Hooray! We can geocode an address and fetch the weather via two different proxy servers and display a result! Thatâ€™s great, but our <code>Main.elm</code> file is getting quite large, so stay tuned for the next part where we pull our code into smaller chunks without losing clarity.</p><p>If youâ€™d like to check out the code from this part, it is located here: <a href="https://github.com/rpearce/elm-geocoding-darksky/tree/pt-3">https://github.com/rpearce/elm-geocoding-darksky/tree/pt-3</a>.</p><p>Until next time, <br> Robert</p></section></main><footer><span aria-hidden="true" class="heart">â™¥</span><span aria-hidden="true">&rarr;</span><a href="https://github.com/sponsors/rpearce/">Sponsor my work</a><span aria-hidden="true">&larr;</span><span aria-hidden="true" class="heart">â™¥</span></footer><script async> (() => { const themeEl = document.querySelector('[data-select-theme]'); if (themeEl) { themeEl.querySelector('[value="'+window.site.prefTheme+'"]').selected = 'selected'; themeEl.addEventListener('change', e => { window.site.setTheme(e.target.value); }); } const fontEl = document.querySelector('[data-select-font]'); if (fontEl) { fontEl.querySelector('[value="'+window.site.prefFont+'"]').selected = 'selected'; fontEl.addEventListener('change', e => { window.site.setFont(e.target.value); }) } })(); </script></body></html>