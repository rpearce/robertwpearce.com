<!DOCTYPE html><html lang="en"><head><title>Hakyll Pt. 4 â€“ Copying Static Files For Your Build</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="This short hakyll tutorial will show you a simple way to copy static files over to your build folder."><meta name="author" content="Robert Pearce"><meta name="keywords" content="hakyll, copyFileCompiler, copying files, hakyll tutorial, hakyll blog, hakyll blog tutorial, hakyll static site, static site generator"><meta name="google-site-verification" content="QX4bn65yOXBfgnwxlO09yIBc1H8blur-Erx3lmsDVhU"><meta http-equiv="origin-trial" content="Am4BZ0c7GMyB72dgo/Ny2FfIFscXhYMoN+CVe4jduWh24FvsaCwf7kjZzHzfrJXtIilyZVAEKRxOItGLY7lvkAgAAABSeyJvcmlnaW4iOiJodHRwczovL3JvYmVydHdwZWFyY2UuY29tOjQ0MyIsImZlYXR1cmUiOiJQb3J0YWxzIiwiZXhwaXJ5IjoxNjAzNTQ2NDc3fQ=="><meta property="og:site_name" content="Robert Pearce"><meta property="og:title" content="Hakyll Pt. 4 â€“ Copying Static Files For Your Build"><meta property="og:url" content="https://robertwpearce.com/hakyll-pt-4-copying-static-files-for-your-build.html"><meta property="og:description" content="This short hakyll tutorial will show you a simple way to copy static files over to your build folder."><meta property="og:type" content="article"><meta property="twitter:site" content="Robert Pearce"><meta property="twitter:title" content="Hakyll Pt. 4 â€“ Copying Static Files For Your Build"><meta property="twitter:description" content="This short hakyll tutorial will show you a simple way to copy static files over to your build folder."><meta property="twitter:creator" content="@RobertWPearce"><link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ðŸ’¾</text></svg>"><link rel="canonical" href="https://robertwpearce.com/hakyll-pt-4-copying-static-files-for-your-build.html"><link rel="alternate" href="./atom.xml" title="Robert Pearce's blog" type="application/atom+xml"><link rel="alternate" href="./rss.xml" title="Robert Pearce's blog" type="application/rss+xml"><link rel="stylesheet" href="./css/base.css"><link rel="stylesheet" href="./css/t-clean.css"><link rel="stylesheet" href="./css/t-clean-note.css"><link rel="stylesheet" href="./css/t-code-dracula.css"><link rel="prefetch" href="./css/t-clean-note.css"></head><body data-theme="clean-night"><script> (() => { window.site = { prefFont: localStorage.getItem('prefFont') || 'monospace', setFont: (family) => { localStorage.setItem('prefFont', family); const rootStyle = document.querySelector(':root').style; rootStyle.setProperty('--type-family-body', family+',monospace'); /* Remove when https://github.com/googlefonts/spacemono/pull/2 is resolved */ if (family === 'Liga Space Mono') { rootStyle.setProperty('font-feature-settings', '"liga" 0'); } else { rootStyle.removeProperty('font-feature-settings'); } return window.site._fetchFont(family); }, prefTheme: localStorage.getItem('prefTheme') || (matchMedia('(prefers-color-scheme: dark)').matches ? 'clean-night' : 'clean-day'), setTheme: (name) => { const rootStyle = document.querySelector(':root').style; if (name === 'clean-night') { rootStyle.removeProperty('color-scheme'); } else { rootStyle.setProperty('color-scheme', 'light'); } document.body.setAttribute('data-theme', name); localStorage.setItem('prefTheme', name); }, _fetchFont: (family) => { if (family === 'monospace') { return Promise.resolve(); } const familyNoSpaces = family.replaceAll(' ', ''); const fontz = [ new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-Regular.woff2") format("woff2")', { display: 'swap', weight: 400 }), new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-Bold.woff2") format("woff2")', { display: 'swap', weight: 700 }), ]; if (family !== 'Fira Code') { fontz.push( new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-Italic.woff2") format("woff2")', { display: 'swap', style: 'italic', weight: 400 }), new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-BoldItalic.woff2") format("woff2")', { display: 'swap', style: 'italic', weight: 700 }) ); } for (const f of fontz) { document.fonts.add(f); } return Promise.allSettled(fontz).then(results => { results.forEach((res, i) => { if (res.status === 'rejected') { console.error('site failed to load font: ' + fontz[i]?.family ?? 'unknown'); } }); }); } }; window.site.setTheme(window.site.prefTheme); window.site.setFont(window.site.prefFont); })(); </script><header><nav><div class="nav-skip"><a href="#content">Skip to content</a></div><a aria-label="Home" class="nav-home" href="./">~</a><span>/</span></nav><div class="header-extra"><a href="./atom.xml">RSS</a><span aria-hidden="true">&compfn;</span><noscript>(requires JS &rarr;)</noscript><label for="select-theme">Theme</label><select data-select-theme id="select-theme"><option value="clean-day">Clean (Day)</option><option value="clean-night">Clean (Night)</option></select><span aria-hidden="true">&compfn;</span><label for="select-font">Font</label><select data-select-font id="select-font"><option value="monospace">monospace</option><option value="Liga Space Mono">Space Mono</option><option value="Victor Mono">Victor Mono</option><option value="Fira Code">Fira Code</option><option value="JetBrains Mono">JetBrains Mono</option></select></div></header><main id="content"><header data-area="heading"><h1>Hakyll Pt. 4 â€“ Copying Static Files For Your Build</h1></header><section data-area="meta"><h2>Info</h2><table data-type="cols-y"><tbody><tr><th>Summary</th><td>This short hakyll tutorial will show you a simple way to copy static files over to your build folder.</td></tr><tr><th>Shared</th><td>2019-01-27</td></tr><tr><th>Revised</th><td>2023-02-11 @ 16:00 UTC</td></tr></tbody></table></section><section data-area="note"><p>This is part 4 of a multipart series where we will look at getting a website / blog set up with <a href="https://jaspervdj.be/hakyll">hakyll</a> and customized a fair bit.</p><ul><li><a href="/hakyll-pt-1-setup-initial-customization.html">Pt. 1 â€“ Setup &amp; Initial Customization</a></li><li><a href="/hakyll-pt-2-generating-a-sitemap-xml-file.html">Pt. 2 â€“ Generating a Sitemap XML File</a></li><li><a href="/hakyll-pt-3-generating-rss-and-atom-xml-feeds.html">Pt. 3 â€“ Generating RSS and Atom XML Feeds</a></li><li>Pt. 4 â€“ Copying Static Files For Your Build</li><li><a href="/hakyll-pt-5-generating-custom-post-filenames-from-a-title-slug.html">Pt. 5 â€“ Generating Custom Post Filenames From a Title Slug</a></li><li><a href="/hakyll-pt-6-pure-builds-with-nix.html">Pt. 6 â€“ Pure Builds With Nix</a></li><li><a href="/the-hakyll-nix-template-tutorial.html">The hakyll-nix-template Tutorial</a></li></ul><h2 id="overview">Overview</h2><p>You will inevitably need to copy static files over to your build folder at some point in a hakyll project, and this short tutorial will show you a simple way to do so.</p><ol><li><a href="#copying-files-the-long-way">Copying Files the Long Way</a></li><li><a href="#simplify-file-copying-with-a-list">Simplify File Copying With a List</a></li><li><a href="#simplify-file-copying-with-pattern-composition-operators">Simplify File Copying With Pattern Composition Operators</a></li><li><a href="#github-pages-tip-for-dotfiles-and-dotfolders">GitHub Pages Tip for Dotfiles and Dotfolders</a></li></ol><h2 id="copying-files-the-long-way">Copying Files the Long Way</h2><p>As of the time of this writing, the <a href="https://github.com/jaspervdj/hakyll/blob/a983c8cbc917ffa3ce81d2540b50bdb321588b92/data/example/site.hs#L10-L12">default hakyll example for copying files</a> looks like this:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nf">match</span> <span class="pl-s">"images/*"</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">route</span>   <span class="pl-n">idRoute</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">compile</span> <span class="pl-n">copyFileCompiler</span></span></span></code></pre><p>This is great and gets the job done! When I first looked at copying more files, I went down this path:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nf">match</span> <span class="pl-s">"CNAME"</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">route</span>   <span class="pl-n">idRoute</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">compile</span> <span class="pl-n">copyFileCompiler</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nf">match</span> <span class="pl-s">"robots.txt"</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">route</span>   <span class="pl-n">idRoute</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">compile</span> <span class="pl-n">copyFileCompiler</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nf">match</span> <span class="pl-s">"images/*"</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">route</span>   <span class="pl-n">idRoute</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">compile</span> <span class="pl-n">copyFileCompiler</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nf">match</span> <span class="pl-s">"fonts/*"</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">route</span>   <span class="pl-n">idRoute</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">compile</span> <span class="pl-n">copyFileCompiler</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">-- ...and so on</span></span></span></code></pre><p>Obviously, there is some code duplication here; there must be a better way!</p><h2 id="simplify-file-copying-with-a-list">Simplify File Copying With a List</h2><p>Here are all the items I need copied over:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">CNAME
</span></span><span class="pl-line"><span class="pl-cl">robots.txt
</span></span><span class="pl-line"><span class="pl-cl">_config.yml
</span></span><span class="pl-line"><span class="pl-cl">images/*
</span></span><span class="pl-line"><span class="pl-cl">fonts/*
</span></span><span class="pl-line"><span class="pl-cl">.well-known/*</span></span></code></pre><p>As it turns out, this <em>list</em> of file identifiers to copy can be used in conjunction with <a href="https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Foldable.html#v:forM_"><code>forM_</code></a> to take some foldable structure (for us, a list), map each element to a monadic action that uses hakyllâ€™s <code>match</code> function, ignore the results and ultimately simplify our code.</p><p>The type signature for <code>forM_</code> is as follows:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nf">forM_</span> <span class="pl-ow">::</span> <span class="pl-p">(</span><span class="pl-kt">Foldable</span> <span class="pl-n">t</span><span class="pl-p">,</span> <span class="pl-kt">Monad</span> <span class="pl-n">m</span><span class="pl-p">)</span> <span class="pl-ow">=&gt;</span> <span class="pl-n">t</span> <span class="pl-n">a</span> <span class="pl-ow">-&gt;</span> <span class="pl-p">(</span><span class="pl-n">a</span> <span class="pl-ow">-&gt;</span> <span class="pl-n">m</span> <span class="pl-n">b</span><span class="pl-p">)</span> <span class="pl-ow">-&gt;</span> <span class="pl-n">m</span> <span class="pl-nb">()</span></span></span></code></pre><p>And here is the implementation:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nf">forM_</span> <span class="pl-p">[</span> <span class="pl-s">"CNAME"</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-p">,</span> <span class="pl-s">"robots.txt"</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-p">,</span> <span class="pl-s">"_config.yml"</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-p">,</span> <span class="pl-s">"images/*"</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-p">,</span> <span class="pl-s">"fonts/*"</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-p">,</span> <span class="pl-s">".well-known/*"</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-p">]</span> <span class="pl-o">$</span> <span class="pl-nf">\</span><span class="pl-n">f</span> <span class="pl-ow">-&gt;</span> <span class="pl-n">match</span> <span class="pl-n">f</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">route</span>   <span class="pl-n">idRoute</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">compile</span> <span class="pl-n">copyFileCompiler</span></span></span></code></pre><p>Nice! While this technique is not mentioned in the documentation, it is present in the <a href="https://github.com/jaspervdj/hakyll/blob/1abdeee743d65d96c6f469213ca6e7ea823340a7/web/site.hs#L27-L29">hakyll websiteâ€™s <code>site.hs</code> file</a>, so we know weâ€™re in good company if <a href="https://github.com/jaspervdj">jaspervdj</a> is already using it.</p><p>If you want to read more about the possible patterns that can be matched, check out the commentary in the source here: <a href="https://github.com/jaspervdj/hakyll/blob/1abdeee743d65d96c6f469213ca6e7ea823340a7/lib/Hakyll/Core/Identifier/Pattern.hs" class="uri">https://github.com/jaspervdj/hakyll/blob/1abdeee743d65d96c6f469213ca6e7ea823340a7/lib/Hakyll/Core/Identifier/Pattern.hs</a>.</p><h2 id="simplify-file-copying-with-pattern-composition-operators">Simplify File Copying With Pattern Composition Operators</h2><p><a href="https://www.reddit.com/r/haskell/comments/ak9700/hakyll_pt_4_copying_static_files_for_your_build/ef3lv73/">In this /r/haskell reddit thread</a> by <a href="https://www.reddit.com/user/GAumala">GAumala</a>, they point out that <a href="https://jaspervdj.be/hakyll/reference/Hakyll-Core-Identifier-Pattern.html#g:3">hakyllâ€™s pattern composition operators</a> can also be used to accomplish the same goal. Here is how we would could convert our <code>forM_</code> above to instead use <a href="https://jaspervdj.be/hakyll/reference/Hakyll-Core-Identifier-Pattern.html#v:.-124--124-."><code>.||.</code></a>:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nf">match</span> <span class="pl-p">(</span><span class="pl-s">"CNAME"</span>
</span></span><span class="pl-line"><span class="pl-cl">       <span class="pl-o">.||.</span> <span class="pl-s">"favicon.ico"</span>
</span></span><span class="pl-line"><span class="pl-cl">       <span class="pl-o">.||.</span> <span class="pl-s">"robots.txt"</span>
</span></span><span class="pl-line"><span class="pl-cl">       <span class="pl-o">.||.</span> <span class="pl-s">"_config.yml"</span>
</span></span><span class="pl-line"><span class="pl-cl">       <span class="pl-o">.||.</span> <span class="pl-s">"images/*"</span>
</span></span><span class="pl-line"><span class="pl-cl">       <span class="pl-o">.||.</span> <span class="pl-s">"fonts/*"</span>
</span></span><span class="pl-line"><span class="pl-cl">       <span class="pl-o">.||.</span> <span class="pl-s">".well-known/*"</span><span class="pl-p">)</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">route</span>   <span class="pl-n">idRoute</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">compile</span> <span class="pl-n">copyFileCompiler</span></span></span></code></pre><p>While I understand the <code>forM_</code> better, this does seem to be more attractive!</p><h2 id="github-pages-tip-for-dotfiles-and-dotfolders">GitHub Pages Tip for Dotfiles and Dotfolders</h2><p>If youâ€™re using GitHub pages and have any dotfiles or dotfolders to copy over, make sure you pay attention here.</p><p>Letâ€™s say you have signed up for <a href="https://publishers.basicattentiontoken.org">Brave Payments</a> and need to verify your site by placing a file at:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">https://mysite.com/.well-known/brave-payments-verification.txt</span></span></code></pre><p>Unfortunately, <a href="https://pages.github.com">GitHub Pages</a>, which uses <a href="https://jekyllrb.com">jekyll</a> under the hood, will ignore your dotfiles and dotfolders by default and will therefore not deploy them.</p><p>We can fix this by adding a <code>_config.yml</code> file to our project (you can see it included in the list in the previous section) and telling it to include what it is ignoring:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-c"># _config.yml</span><span class="pl-w">
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-w">
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-w"></span><span class="pl-nt">include</span><span class="pl-p">:</span><span class="pl-w"> </span><span class="pl-p">[</span><span class="pl-s2">".well-known"</span><span class="pl-p">]</span></span></span></code></pre><p>Once youâ€™ve done this, you can commit this file, push it up to GitHub and view it on your published site.</p><p>You can read more about jekyllâ€™s configuration options here: <a href="https://jekyllrb.com/docs/configuration/options/" class="uri">https://jekyllrb.com/docs/configuration/options/</a>.</p><h2 id="wrapping-up">Wrapping Up</h2><p>Today we learned a simple way to list what files we want to be copied over in our hakyll projects, got exposed to <code>forM_</code> and uncovered a potential issue with dotfiles and dotfolders not getting published on GitHub Pages.</p><p>Next up:</p><ul><li><a href="/hakyll-pt-5-generating-custom-post-filenames-from-a-title-slug.html">Pt. 5 â€“ Generating Custom Post Filenames From a Title Slug</a></li><li><em>(wip) Pt. 6 â€“ Customizing Markdown Compiler Options</em></li></ul><hr /><p>Thank you for reading! <br /> Robert</p></section></main><footer><span aria-hidden="true" class="heart">â™¥</span><span aria-hidden="true">&rarr;</span><a href="https://github.com/sponsors/rpearce/">Sponsor my work</a><span aria-hidden="true">&larr;</span><span aria-hidden="true" class="heart">â™¥</span></footer><script async> (() => { const themeEl = document.querySelector('[data-select-theme]'); if (themeEl) { themeEl.querySelector('[value="'+window.site.prefTheme+'"]').selected = 'selected'; themeEl.addEventListener('change', e => { window.site.setTheme(e.target.value); }); } const fontEl = document.querySelector('[data-select-font]'); if (fontEl) { fontEl.querySelector('[value="'+window.site.prefFont+'"]').selected = 'selected'; fontEl.addEventListener('change', e => { window.site.setFont(e.target.value); }) } })(); </script></body></html>