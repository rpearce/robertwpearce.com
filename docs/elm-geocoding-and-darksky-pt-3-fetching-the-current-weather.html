<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Elm, Geocoding & DarkSky: Pt. 3 – Fetching the Current Weather</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="In Part 3 we query the DarkSky API with our geocoded address">
    <meta name="author" content="Robert Pearce">
    <meta name="keywords" content="elm, elm tutorial, elmlang, elm geocoding, elm darksky, elm weather, elm functional programming">
    <meta name="google-site-verification" content="QX4bn65yOXBfgnwxlO09yIBc1H8blur-Erx3lmsDVhU">

    <meta property="og:site_name" content="Robert Pearce | Freelance Software Developer">
    <meta property="og:title" content="Elm, Geocoding & DarkSky: Pt. 3 – Fetching the Current Weather">
    <meta property="og:url" content="https://robertwpearce.com/elm-geocoding-and-darksky-pt-3-fetching-the-current-weather.html">
    <meta property="og:description" content="In Part 3 we query the DarkSky API with our geocoded address">
    <meta property="og:image" content="https://robertwpearce.com/images/london-rain.jpg">
    
      <meta property="og:type" content="article">
    

    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:site" content="Robert Pearce | Freelance Software Developer">
    <meta property="twitter:title" content="Elm, Geocoding & DarkSky: Pt. 3 – Fetching the Current Weather">
    <meta property="twitter:description" content="In Part 3 we query the DarkSky API with our geocoded address">
    <meta property="twitter:image" content="https://robertwpearce.com/images/london-rain.jpg">
    <meta property="twitter:creator" content="@RobertWPearce">

    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="canonical" href="https://robertwpearce.com/elm-geocoding-and-darksky-pt-3-fetching-the-current-weather.html">
    <link rel="stylesheet" href="/css/default.css" />
    
      <link rel="stylesheet" href="/css/article.css" />
    
  </head>
  <body class="light">
    <nav class="nav">
  <div class="layout--constrained">
    <a class="nav__link nav__skip" href="#content">Skip to content</a>
    <a class="nav__link" href="/">Home</a>
    <a class="nav__link" href="mailto:me@robertwpearce.com?subject=Work Inquiry">Hire Me</a>
    <a class="nav__link" href="/atom.xml">atom</a>
    <a class="nav__link" href="/rss.xml">rss</a>
  </div>
</nav>


<main id="content" tabindex="-1">
  <article class="article">
    <header class="article__bg" style="background-image: url('/images/london-rain.jpg')">
      <div class="article__bgHeader">
        <div class="layout--constrained">
          <div class="article__bgTitleWrap">
            <h1 class="article__bgTitle">
              <a href="/elm-geocoding-and-darksky-pt-3-fetching-the-current-weather.html">Elm, Geocoding & DarkSky: Pt. 3 – Fetching the Current Weather</a>
            </h1>
            <div class="article__bgSubHeader">
              <small class="italic">2017-08-18</small>
              
              
              <small class="article__bgPhotoCred italic">
                [ photo credit <a href="https://unsplash.com/@anjimenon">Anjana Menon</a> ]
              </small>
              
            </div>
          </div>
        </div>
      </div>
    </header>
    <section class="layout--constrained">
      <header class="article__header">
        <h1 class="article__title">
          <a href="/elm-geocoding-and-darksky-pt-3-fetching-the-current-weather.html">Elm, Geocoding & DarkSky: Pt. 3 – Fetching the Current Weather</a>
        </h1>
        <small class="italic">2017-08-18</small>
        
      </header>
      <p>This is part 3 of a multipart series where we will be building a small weather forecast app using <a href="http://elm-lang.org/">Elm</a>, <a href="https://developers.google.com/maps/documentation/geocoding/start">Google’s Geocoding API</a> and the <a href="https://darksky.net/dev/">DarkSky API</a>. Instead of doing everything in one massive post, I’ve broken the steps down into parts of a series. Here is the series plan:</p>
<ul>
<li><a href="/elm-geocoding-and-darksky-pt-1-setup-elm-and-proxy-servers.html">Pt. 1 – Setup Elm &amp; Proxy Servers</a></li>
<li><a href="/elm-geocoding-and-darksky-pt-2-geocoding-an-address.html">Pt. 2 – Geocoding an Address</a></li>
<li>Pt. 3 – Fetching the Current Weather</li>
<li><a href="/elm-geocoding-and-darksky-pt-4-extracting-our-elm-code.html">Pt. 4 – Extracting Our Elm Code</a></li>
</ul>
<p>If you’d like to code along with this tutorial, check out <a href="/elm-geocoding-and-darksky-pt-1-setup-elm-and-proxy-servers.html">part 1</a> and <a href="/elm-geocoding-and-darksky-pt-2-fetching-the-current-weather.html">part 2</a> first to get set up.</p>
<p><em>Note: to learn more about the Elm language and syntax, check out the <a href="https://www.elm-tutorial.org/en/">Elm Tutorial</a>, the <a href="https://egghead.io/courses/start-using-elm-to-build-web-applications">EggHead.io Elm course</a>, subscribe to <a href="https://www.dailydrip.com/topics/elm">DailyDrip’s Elm Topic</a>, <a href="http://courses.knowthen.com">James Moore’s Elm Courses</a> or check out <a href="http://exercism.io/languages/elm/about">Elm on exercism.io</a>.</em></p>
<h2 id="overview">Overview</h2>
<p>In this post we will use Elm to fetch and display the current weather based on the geocode data we receive from an input field.</p>
<h2 id="project-source-code">Project Source Code</h2>
<p>The project we’re making will be broken into parts here (branches will be named for each part): <a href="https://github.com/rpearce/elm-geocoding-darksky/">https://github.com/rpearce/elm-geocoding-darksky/</a>. Be sure to check out the other branches to see the other parts as they become available.</p>
<p>The code for this part is located in the <code>pt-3</code> branch: <a href="https://github.com/rpearce/elm-geocoding-darksky/tree/pt-3">https://github.com/rpearce/elm-geocoding-darksky/tree/pt-3</a>.</p>
<h2 id="steps-for-today">Steps for Today</h2>
<ol>
<li>Understanding DarkSky’s response data</li>
<li>Modeling the DarkSky response data</li>
<li>Creating DarkSky JSON decoders</li>
<li>Writing our fetchWeather HTTP function</li>
<li>Calling fetchWeather and handling the response</li>
<li>Displaying the current weather in our view</li>
</ol>
<h2 id="1-understanding-darkskys-response-data">1. Understanding DarkSky’s response data</h2>
<p>Let’s get the weather data for Auckland, NZ (-36.8484597,174.7633315). If we start up our <a href="https://github.com/rpearce/DarkSky-proxy">DarkSky proxy</a> and run</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"></a>λ <span class="ex">curl</span> localhost:5051/forecast/-36.8484597,174.7633315</span></code></pre></div>
<p>then we will see response data like this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="dt">&quot;timezone&quot;</span><span class="fu">:</span> <span class="st">&quot;Pacific</span><span class="ch">\/</span><span class="st">Auckland&quot;</span><span class="fu">,</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="dt">&quot;currently&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>    <span class="dt">&quot;summary&quot;</span><span class="fu">:</span> <span class="st">&quot;Overcast&quot;</span><span class="fu">,</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>    <span class="dt">&quot;icon&quot;</span><span class="fu">:</span> <span class="st">&quot;cloudy&quot;</span><span class="fu">,</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>    <span class="dt">&quot;temperature&quot;</span><span class="fu">:</span> <span class="fl">61.42</span><span class="fu">,</span></span>
<span id="cb2-7"><a href="#cb2-7"></a>    <span class="er">...</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>  <span class="fu">},</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>  <span class="dt">&quot;hourly&quot;</span><span class="fu">:</span> <span class="fu">{</span> <span class="er">...</span> <span class="fu">},</span></span>
<span id="cb2-10"><a href="#cb2-10"></a>  <span class="dt">&quot;daily&quot;</span><span class="fu">:</span> <span class="fu">{</span> <span class="er">...</span> <span class="fu">}</span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="fu">}</span></span></code></pre></div>
<p>While all we care about are the <code>summary</code>, <code>icon</code> and <code>temperature</code> properties within the top-level <code>currently</code> property, we will only use <code>temperature</code> in this part.</p>
<p>Disclaimer: DarkSky units are in <code>us</code> by default. You can specify other unit types by appending a <code>units</code> query parameter to the end like this:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1"></a>λ <span class="ex">curl</span> localhost:5051/forecast/-36.8484597,174.7633315?units=si</span></code></pre></div>
<p>Read more about <a href="https://darksky.net/dev/docs/forecast">DarkSky request parameters in the DarkSky docs</a> to customize your response data.</p>
<p>Now that we’ve got our data in the correct units, let’s model this data in Elm!</p>
<h2 id="2-modeling-the-darksky-response-data">2. Modeling the DarkSky response data</h2>
<p>Based on our DarkSky response, let’s list out what we’re looking at:</p>
<ul>
<li>an object, <code>currently</code>, which has 3 notable properties:
<ul>
<li>a string, <code>summary</code></li>
<li>a string, <code>icon</code></li>
<li>a float, <code>temperature</code></li>
</ul></li>
</ul>
<p>Since we have two levels of data, <code>currently</code> and its child properties, let’s create two type aliases to represent this data.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">type</span> <span class="kw">alias</span> <span class="dt">Weather</span> <span class="op">=</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>    { <span class="fu">currently</span> : <span class="dt">WeatherCurrently</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>    }</span>
<span id="cb4-4"><a href="#cb4-4"></a></span>
<span id="cb4-5"><a href="#cb4-5"></a></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="kw">type</span> <span class="kw">alias</span> <span class="dt">WeatherCurrently</span> <span class="op">=</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>    { <span class="fu">icon</span> : <span class="dt">String</span></span>
<span id="cb4-8"><a href="#cb4-8"></a>    <span class="op">,</span> <span class="fu">summary</span> : <span class="dt">String</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>    <span class="op">,</span> <span class="fu">temperature</span> : <span class="dt">Float</span></span>
<span id="cb4-10"><a href="#cb4-10"></a>    }</span></code></pre></div>
<p>And now we can add a property to our <code>Model</code> type alias that can be of our <code>Weather</code> type:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">type</span> <span class="kw">alias</span> <span class="dt">Model</span> <span class="op">=</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>    { <span class="fu">address</span> : <span class="dt">String</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>    <span class="op">,</span> <span class="fu">coords</span> : <span class="dt">Coords</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>    <span class="op">,</span> <span class="fu">weather</span> : <span class="dt">Weather</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>    }</span></code></pre></div>
<p>Uh oh! Our <code>Model</code> has a defaults function called <code>initialModel</code>, and now that we’ve added <code>weather</code> into the mix, we’ll need to give that default values, as well:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">initialModel</span> : <span class="dt">Model</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="fu">initialModel</span> <span class="op">=</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>    { <span class="fu">address</span> <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>    <span class="op">,</span> <span class="fu">coords</span> <span class="op">=</span> ( <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span> )</span>
<span id="cb6-5"><a href="#cb6-5"></a>    <span class="op">,</span> <span class="fu">weather</span> <span class="op">=</span> <span class="fu">initialWeather</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>    }</span>
<span id="cb6-7"><a href="#cb6-7"></a></span>
<span id="cb6-8"><a href="#cb6-8"></a></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="fu">initialWeather</span> : <span class="dt">Weather</span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="fu">initialWeather</span> <span class="op">=</span></span>
<span id="cb6-11"><a href="#cb6-11"></a>    { <span class="fu">currently</span> <span class="op">=</span> <span class="fu">initialWeatherCurrently</span></span>
<span id="cb6-12"><a href="#cb6-12"></a>    }</span>
<span id="cb6-13"><a href="#cb6-13"></a></span>
<span id="cb6-14"><a href="#cb6-14"></a></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="fu">initialWeatherCurrently</span> : <span class="dt">WeatherCurrently</span></span>
<span id="cb6-16"><a href="#cb6-16"></a><span class="fu">initialWeatherCurrently</span> <span class="op">=</span></span>
<span id="cb6-17"><a href="#cb6-17"></a>    { <span class="fu">icon</span> <span class="op">=</span> <span class="st">&quot;–&quot;</span></span>
<span id="cb6-18"><a href="#cb6-18"></a>    <span class="op">,</span> <span class="fu">summary</span> <span class="op">=</span> <span class="st">&quot;–&quot;</span></span>
<span id="cb6-19"><a href="#cb6-19"></a>    <span class="op">,</span> <span class="fu">temperature</span> <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb6-20"><a href="#cb6-20"></a>    }</span></code></pre></div>
<p>These are defaults that we provide in the event that we have no data to work with (initially or if something goes wrong).</p>
<h2 id="3-creating-darksky-json-decoders">3. Creating DarkSky JSON decoders</h2>
<p>Just as we did in the <a href="/elm-geocoding-and-darksky-pt-2-geocoding-an-address.html#4-creating-json-decoders">geocoding post section on JSON decoding</a>, we want to leverage <a href="https://github.com/NoRedInk/elm-decode-pipeline">NoRedInk’s elm-decode-pipeline</a> to define how our JSON response should be structured and thus parsed.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">decodeWeather</span> : <span class="dt">Decoder</span> <span class="dt">Weather</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="fu">decodeWeather</span> <span class="op">=</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>    <span class="fu">decode</span> <span class="dt">Weather</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>        <span class="op">|&gt;</span> <span class="fu">required</span> <span class="st">&quot;currently&quot;</span> <span class="fu">decodeWeatherCurrently</span></span>
<span id="cb7-5"><a href="#cb7-5"></a></span>
<span id="cb7-6"><a href="#cb7-6"></a></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="fu">decodeWeatherCurrently</span> : <span class="dt">Decoder</span> <span class="dt">WeatherCurrently</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="fu">decodeWeatherCurrently</span> <span class="op">=</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>    <span class="fu">decode</span> <span class="dt">WeatherCurrently</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>        <span class="op">|&gt;</span> <span class="fu">required</span> <span class="st">&quot;icon&quot;</span> <span class="fu">string</span></span>
<span id="cb7-11"><a href="#cb7-11"></a>        <span class="op">|&gt;</span> <span class="fu">required</span> <span class="st">&quot;summary&quot;</span> <span class="fu">string</span></span>
<span id="cb7-12"><a href="#cb7-12"></a>        <span class="op">|&gt;</span> <span class="fu">required</span> <span class="st">&quot;temperature&quot;</span> <span class="fu">float</span></span></code></pre></div>
<p>While we could use <a href="http://package.elm-lang.org/packages/elm-lang/core/5.1.1/Json-Decode#at">Json.Decode.at</a> to potentially have less code, there is absolutely nothing wrong with being verbose if it leads to clarity.</p>
<h2 id="4-writing-our-fetchweather-http-function">4. Writing our fetchWeather HTTP function</h2>
<p>We know that we’re going to have to send latitude and longitude <code>Coords</code> to our <a href="https://github.com/rpearce/DarkSky-proxy">DarkSky proxy server</a>, as well as any additional options, so let’s define the URL for that and the fetching function <a href="/elm-geocoding-and-darksky-pt-2-geocoding-an-address.html#8-making-our-request">just like we did for geocoding</a>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">weatherUrl</span> : <span class="dt">Coords</span> <span class="op">-&gt;</span> <span class="dt">String</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="fu">weatherUrl</span> ( <span class="fu">lat</span><span class="op">,</span> <span class="fu">lng</span> ) <span class="op">=</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>    <span class="st">&quot;http://localhost:5051/forecast/&quot;</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>        <span class="op">++</span> (<span class="fu">toString</span> <span class="fu">lat</span>)</span>
<span id="cb8-5"><a href="#cb8-5"></a>        <span class="op">++</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>        <span class="op">++</span> (<span class="fu">toString</span> <span class="fu">lng</span>)</span>
<span id="cb8-7"><a href="#cb8-7"></a>        <span class="co">-- this is where you can add your query params</span></span>
<span id="cb8-8"><a href="#cb8-8"></a></span>
<span id="cb8-9"><a href="#cb8-9"></a></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="fu">fetchWeather</span> : <span class="dt">Coords</span> <span class="op">-&gt;</span> <span class="dt">Cmd</span> <span class="dt">Msg</span></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="fu">fetchWeather</span> <span class="fu">coords</span> <span class="op">=</span></span>
<span id="cb8-12"><a href="#cb8-12"></a>    <span class="dt">Http</span><span class="op">.</span><span class="fu">get</span> (<span class="fu">weatherUrl</span> <span class="fu">coords</span>) <span class="fu">decodeWeather</span></span>
<span id="cb8-13"><a href="#cb8-13"></a>        <span class="op">|&gt;</span> <span class="dt">Http</span><span class="op">.</span><span class="fu">send</span> <span class="dt">ReceiveWeather</span></span></code></pre></div>
<p>To define an HTTP request in Elm, we need</p>
<ul>
<li>✅ a URL to point to</li>
<li>✅ a package like Http to help us build the request</li>
<li>✅ a decoder to handle parsing the response data</li>
<li>🤷 a <code>Msg</code> type that our <code>update</code> function can pattern match on</li>
</ul>
<p>Right! We can’t forget to add <code>ReceiveWeather</code> as a <code>Msg</code> type. It should be almost the same as <code>ReceiveGeocoding</code>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">type</span> <span class="dt">Msg</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>    <span class="op">=</span> <span class="dt">UpdateAddress</span> <span class="dt">String</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>    <span class="op">|</span> <span class="dt">SendAddress</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>    <span class="op">|</span> <span class="dt">ReceiveGeocoding</span> (<span class="dt">Result</span> <span class="dt">Http</span><span class="op">.</span><span class="dt">Error</span> <span class="dt">GeoModel</span>)</span>
<span id="cb9-5"><a href="#cb9-5"></a>    <span class="op">|</span> <span class="dt">ReceiveWeather</span> (<span class="dt">Result</span> <span class="dt">Http</span><span class="op">.</span><span class="dt">Error</span> <span class="dt">Weather</span>)</span>
<span id="cb9-6"><a href="#cb9-6"></a>    <span class="op">|</span> <span class="dt">NoOp</span></span></code></pre></div>
<h2 id="5-calling-fetchweather-and-handling-the-response">5. Calling fetchWeather and handling the response</h2>
<p>When we <a href="/elm-geocoding-and-darksky-pt-2-geocoding-an-address.html#9-handling-the-geocode-response">handled our geocode response in the prior post</a>, inside of <code>ReceiveGeocoding</code> we returned <code>( newModel, Cmd.none )</code>, for we had no further actions to take. Instead of our action in this tuple being <code>Cmd.none</code>, let’s instead call our <code>fetchWeather</code> function and pass it our geocoded coordinates:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">update</span> : <span class="dt">Msg</span> <span class="op">-&gt;</span> <span class="dt">Model</span> <span class="op">-&gt;</span> ( <span class="dt">Model</span><span class="op">,</span> <span class="dt">Cmd</span> <span class="dt">Msg</span> )</span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="fu">update</span> <span class="fu">msg</span> <span class="fu">model</span> <span class="op">=</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>    <span class="cf">case</span> <span class="fu">msg</span> <span class="cf">of</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>        <span class="co">-- ...removed for brevity</span></span>
<span id="cb10-5"><a href="#cb10-5"></a></span>
<span id="cb10-6"><a href="#cb10-6"></a>        <span class="dt">ReceiveGeocoding</span> (<span class="dt">Ok</span> { <span class="fu">results</span><span class="op">,</span> <span class="fu">status</span> }) <span class="op">-&gt;</span></span>
<span id="cb10-7"><a href="#cb10-7"></a>            <span class="kw">let</span></span>
<span id="cb10-8"><a href="#cb10-8"></a>                <span class="co">-- ...</span></span>
<span id="cb10-9"><a href="#cb10-9"></a>                <span class="fu">newModel</span> <span class="op">=</span></span>
<span id="cb10-10"><a href="#cb10-10"></a>                    <span class="co">-- ...</span></span>
<span id="cb10-11"><a href="#cb10-11"></a>            <span class="kw">in</span></span>
<span id="cb10-12"><a href="#cb10-12"></a>                ( <span class="fu">newModel</span><span class="op">,</span> <span class="fu">fetchWeather</span> <span class="fu">newModel</span><span class="op">.</span><span class="fu">coords</span> )</span>
<span id="cb10-13"><a href="#cb10-13"></a></span>
<span id="cb10-14"><a href="#cb10-14"></a>        <span class="co">-- ...</span></span>
<span id="cb10-15"><a href="#cb10-15"></a></span>
<span id="cb10-16"><a href="#cb10-16"></a>        <span class="dt">ReceiveWeather</span> (<span class="dt">Ok</span> <span class="fu">resp</span>) <span class="op">-&gt;</span></span>
<span id="cb10-17"><a href="#cb10-17"></a>            ( { <span class="fu">model</span> <span class="op">|</span> <span class="fu">weather</span> <span class="op">=</span> { <span class="fu">currently</span> <span class="op">=</span> <span class="fu">resp</span><span class="op">.</span><span class="fu">currently</span> } }</span>
<span id="cb10-18"><a href="#cb10-18"></a>            <span class="op">,</span> <span class="dt">Cmd</span><span class="op">.</span><span class="fu">none</span></span>
<span id="cb10-19"><a href="#cb10-19"></a>            )</span>
<span id="cb10-20"><a href="#cb10-20"></a></span>
<span id="cb10-21"><a href="#cb10-21"></a>        <span class="dt">ReceiveWeather</span> (<span class="dt">Err</span> <span class="fu">_</span>) <span class="op">-&gt;</span></span>
<span id="cb10-22"><a href="#cb10-22"></a>            ( <span class="fu">model</span><span class="op">,</span> <span class="dt">Cmd</span><span class="op">.</span><span class="fu">none</span> )</span></code></pre></div>
<p>Again, at the end of <code>ReceiveGeocoding</code>, we return our <code>newModel</code> as well as the command to go and fetch the weather with the coordinates we’re storing on our <code>newModel</code>.</p>
<p>Whenever the HTTP request and decoding gives us back a result with the <code>Msg</code> type of <code>ReceiveWeather</code>, we then update the weather property on our model record to have the <code>currently</code> data parsed from the decoder.</p>
<h2 id="6-displaying-the-current-weather-in-our-view">6. Displaying the current weather in our view</h2>
<p>Finally, to make sure we’re doing each step correctly, let’s add the temperature to our view:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">view</span> : <span class="dt">Model</span> <span class="op">-&gt;</span> <span class="dt">Html</span> <span class="dt">Msg</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="fu">view</span> <span class="fu">model</span> <span class="op">=</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>    <span class="fu">div</span> []</span>
<span id="cb11-4"><a href="#cb11-4"></a>        [ <span class="fu">form</span> [ <span class="fu">onSubmit</span> <span class="dt">SendAddress</span> ]</span>
<span id="cb11-5"><a href="#cb11-5"></a>            [ <span class="fu">input</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>                [ <span class="fu">type_</span> <span class="st">&quot;text&quot;</span></span>
<span id="cb11-7"><a href="#cb11-7"></a>                <span class="op">,</span> <span class="fu">placeholder</span> <span class="st">&quot;City&quot;</span></span>
<span id="cb11-8"><a href="#cb11-8"></a>                <span class="op">,</span> <span class="fu">value</span> <span class="fu">model</span><span class="op">.</span><span class="fu">address</span></span>
<span id="cb11-9"><a href="#cb11-9"></a>                <span class="op">,</span> <span class="fu">onInput</span> <span class="dt">UpdateAddress</span></span>
<span id="cb11-10"><a href="#cb11-10"></a>                ]</span>
<span id="cb11-11"><a href="#cb11-11"></a>                []</span>
<span id="cb11-12"><a href="#cb11-12"></a>            ]</span>
<span id="cb11-13"><a href="#cb11-13"></a>        <span class="op">,</span> <span class="fu">p</span> [] [ <span class="fu">text</span> (<span class="st">&quot;Coords: &quot;</span> <span class="op">++</span> (<span class="fu">toString</span> <span class="fu">model</span><span class="op">.</span><span class="fu">coords</span>)) ]</span>
<span id="cb11-14"><a href="#cb11-14"></a>        <span class="op">,</span> <span class="fu">p</span> [] [ <span class="fu">text</span> (<span class="st">&quot;Weather: &quot;</span> <span class="op">++</span> (<span class="fu">toString</span> (<span class="fu">round</span> <span class="fu">model</span><span class="op">.</span><span class="fu">weather</span><span class="op">.</span><span class="fu">currently</span><span class="op">.</span><span class="fu">temperature</span>))) ]</span>
<span id="cb11-15"><a href="#cb11-15"></a>        ]</span></code></pre></div>
<p>Here we use <a href="http://package.elm-lang.org/packages/elm-lang/core/latest/Basics#round">Basics.round</a> because an approximation is alright for weather.</p>
<p>Now, when you rebuild your code with <code>./build</code>, open <code>index.html</code> and submit a city/address name, you’ll first see the <code>Coords</code> update on the page and then see the <code>Weather</code> result once it’s done.</p>
<h2 id="wrapping-up">Wrapping Up</h2>
<p>Hooray! We can geocode an address and fetch the weather via two different proxy servers and display a result! That’s great, but our <code>Main.elm</code> file is getting quite large, so stay tuned for the next part where we pull our code into smaller chunks without losing clarity.</p>
<p>If you’d like to check out the code from this part, it is located here: <a href="https://github.com/rpearce/elm-geocoding-darksky/tree/pt-3">https://github.com/rpearce/elm-geocoding-darksky/tree/pt-3</a>.</p>
<p>Until next time, <br> Robert</p>
    </section>
  </article>
</main>

<footer>
  <section class="subscribe section--padded">
  <div class="layout--constrained">
    <h2 class="subscribe__header">Get notified of new posts</h2>

    <form action="//robertwpearce.us13.list-manage.com/subscribe/post?u=2df44e8960266388bff165fa6&amp;id=ee2f2a3737" method="post" name="mc-embedded-subscribe-form" target="_blank" novalidate class="subscribe__form">
      <div id="mce-responses">
        <div class="response" id="mce-error-response" style="display:none"></div>
        <div class="response" id="mce-success-response" style="display:none"></div>
      </div>
      <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_2df44e8960266388bff165fa6_ee2f2a3737" tabindex="-1" value=""></div>
      <div class="subscribe__section">
        <input type="email" value="" id="mce-EMAIL" class="subscribe__input" name="EMAIL" placeholder="you@greatemail.com" aria-label="Email Address">
        <input type="submit" value="Subscribe" name="subscribe" class="subscribe__submit">
      </div>
      <small>Note: I will <em>never</em> give out your email nor spam you. Unsubscribe at any time.</small>
    </form>

    <p>
      <small>(or subscribe to the <a href="/atom.xml" class="subscribe__link">atom</a> or <a class="subscribe__link" href="/rss.xml">rss</a> feeds)</small>
    </p>
  </div>
</section>

</footer>

  </body>
</html>
