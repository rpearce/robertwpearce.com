<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Elm, Geocoding & DarkSky: Pt. 1 – Setup Elm & Proxy Servers</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="In Part 1 we will begin building a small weather forecast app using Elm, Google's Geocoding API and the DarkSky API.">
    <meta name="author" content="Robert Pearce">
    <meta name="keywords" content="elm, elm tutorial, elmlang, elm geocoding, elm darksky, elm weather, elm functional programming">
    <meta name="google-site-verification" content="QX4bn65yOXBfgnwxlO09yIBc1H8blur-Erx3lmsDVhU">

    <meta property="og:site_name" content="Robert Pearce | Freelance Software Developer">
    <meta property="og:title" content="Elm, Geocoding & DarkSky: Pt. 1 – Setup Elm & Proxy Servers">
    <meta property="og:url" content="https://robertwpearce.com/elm-geocoding-and-darksky-pt-1-setup-elm-and-proxy-servers.html">
    <meta property="og:description" content="In Part 1 we will begin building a small weather forecast app using Elm, Google's Geocoding API and the DarkSky API.">
    <meta property="og:image" content="https://robertwpearce.com/images/snow-dogs.jpg">
    
      <meta property="og:type" content="article">
    

    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:site" content="Robert Pearce | Freelance Software Developer">
    <meta property="twitter:title" content="Elm, Geocoding & DarkSky: Pt. 1 – Setup Elm & Proxy Servers">
    <meta property="twitter:description" content="In Part 1 we will begin building a small weather forecast app using Elm, Google's Geocoding API and the DarkSky API.">
    <meta property="twitter:image" content="https://robertwpearce.com/images/snow-dogs.jpg">
    <meta property="twitter:creator" content="@RobertWPearce">

    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="canonical" href="https://robertwpearce.com/elm-geocoding-and-darksky-pt-1-setup-elm-and-proxy-servers.html">
    <link rel="stylesheet" href="/css/default.css" />
    
      <link rel="stylesheet" href="/css/article.css" />
    
  </head>
  <body class="light">
    <nav class="nav">
  <div class="layout--constrained">
    <a class="nav__link nav__skip" href="#content">Skip to content</a>
    <a class="nav__link" href="/">Home</a>
    <a class="nav__link" href="mailto:me@robertwpearce.com?subject=Work Inquiry">Hire Me</a>
    <a class="nav__link" href="/atom.xml">atom</a>
    <a class="nav__link" href="/rss.xml">rss</a>
  </div>
</nav>


<main id="content" tabindex="-1">
  <article class="article">
    <header class="article__bg" style="background-image: url('/images/snow-dogs.jpg')">
      <div class="article__bgHeader">
        <div class="layout--constrained">
          <div class="article__bgTitleWrap">
            <h1 class="article__bgTitle">
              <a href="/elm-geocoding-and-darksky-pt-1-setup-elm-and-proxy-servers.html">Elm, Geocoding & DarkSky: Pt. 1 – Setup Elm & Proxy Servers</a>
            </h1>
            <div class="article__bgSubHeader">
              <small class="italic">2017-07-22</small>
              
              
              <small class="article__bgPhotoCred italic">
                [ photo credit <a href="https://unsplash.com/@padolsey">James Padolsey</a> ]
              </small>
              
            </div>
          </div>
        </div>
      </div>
    </header>
    <section class="layout--constrained">
      <header class="article__header">
        <h1 class="article__title">
          <a href="/elm-geocoding-and-darksky-pt-1-setup-elm-and-proxy-servers.html">Elm, Geocoding & DarkSky: Pt. 1 – Setup Elm & Proxy Servers</a>
        </h1>
        <small class="italic">2017-07-22</small>
        
      </header>
      <p>This is part 1 of a multipart series where we will be building a small weather forecast app using <a href="http://elm-lang.org/">Elm</a>, <a href="https://developers.google.com/maps/documentation/geocoding/start">Google’s Geocoding API</a> and the <a href="https://darksky.net/dev/">DarkSky API</a>. Instead of doing everything in one massive post, I’ve broken the steps down into parts of a series. Here is the series plan:</p>
<ul>
<li>Pt. 1 – Setup Elm &amp; Proxy Servers</li>
<li><a href="/elm-geocoding-and-darksky-pt-2-geocoding-an-address.html">Pt. 2 – Geocoding an Address</a></li>
<li><a href="/elm-geocoding-and-darksky-pt-3-fetching-the-current-weather.html">Pt. 3 – Fetching the Current Weather</a></li>
<li><a href="/elm-geocoding-and-darksky-pt-4-extracting-our-elm-code.html">Pt. 4 – Extracting Our Elm Code</a></li>
</ul>
<h2 id="overview">Overview</h2>
<p>This post will cover setting up <a href="http://elm-lang.org/">Elm</a>, a <a href="/node-js-geocoding-proxy-with-paperplane.html">geocoding proxy</a> and a <a href="https://github.com/rpearce/DarkSky-proxy/">DarkSky proxy</a>. We’ll need all of these things set up in order to get our weather app to work and not sacrifice our API keys.</p>
<p>By the end of this post, you will have a “Hello, world!” Elm app with a simple <code>./build</code> command, and you should be able to <code>cURL</code> both your geocoding and DarkSky proxies to receive response data that we will use in the coming lessons.</p>
<h2 id="project-source-code">Project Source Code</h2>
<p>The project we’re making will be broken into parts here (branches will be named for each part): <a href="https://github.com/rpearce/elm-geocoding-darksky/">https://github.com/rpearce/elm-geocoding-darksky/</a>. Be sure to check out the other branches to see the other parts as they become available.</p>
<p>The code for this part is located in the <code>pt-1</code> branch: <a href="https://github.com/rpearce/elm-geocoding-darksky/tree/pt-1">https://github.com/rpearce/elm-geocoding-darksky/tree/pt-1</a>.</p>
<h2 id="pre-requisites">Pre-requisites</h2>
<p>This tutorial assumes that you already have installed Node.js (I use <a href="https://github.com/creationix/nvm">NVM</a> for managing Node versions and am using <code>v8.3</code>).</p>
<p>Once you’ve got Node installed, we can begin.</p>
<h2 id="project-setup">Project Setup</h2>
<p>From your favorite project folder, let’s create a new project folder named <code>elm-geocoding-darksky</code> and change the current working directory to be the new folder:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"></a>λ <span class="fu">mkdir</span> elm-geocoding-darksky</span>
<span id="cb1-2"><a href="#cb1-2"></a>λ <span class="bu">cd</span> elm-geocoding-darksky</span></code></pre></div>
<h2 id="elm">Elm</h2>
<h3 id="installing-elm">Installing Elm</h3>
<p>You can install elm via any of the methods on the <a href="https://guide.elm-lang.org/install.html">elm install page</a> or by one of these methods:</p>
<ul>
<li>Homebrew: <code>brew install elm</code></li>
<li>Node.js: <code>npm i elm -g</code> for a global binary or <code>npm init -y &amp;&amp; npm i elm</code> to create a <code>package.json</code> file and install <code>elm</code> to it; you’ll have to run this latter method via <code>npx elm</code>, as it’ll be looking for the binary in your <code>./node_modules/.bin/</code> directory)</li>
</ul>
<h3 id="elm-format">elm-format</h3>
<p>I’ve found that having a tool re-format my Elm code to an agreed-upon format makes me more efficient and makes it easier for others to read my code. Check out these projects for more on how to do this:</p>
<ul>
<li><a href="https://github.com/avh4/elm-format">https://github.com/avh4/elm-format</a></li>
<li><a href="https://github.com/ElmCast/elm-vim">elm-vim</a></li>
</ul>
<h3 id="adding-elm-to-a-webpage">Adding Elm to a Webpage</h3>
<p>Our goal here is to compile our elm project to an <code>elm.js</code> file and include that on a webpage (which we’ll make in a minute).</p>
<p>First, let’s create a <code>src/</code> directory to house our source code and a <code>Main.elm</code> file within it:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"></a>λ <span class="fu">mkdir</span> src</span>
<span id="cb2-2"><a href="#cb2-2"></a>λ <span class="fu">touch</span> src/Main.elm</span></code></pre></div>
<p>Next, we want to install Elm’s HTML package so that so that we can access its HTML-related functions:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1"></a>λ <span class="ex">elm</span> package install elm-lang/html</span></code></pre></div>
<p>Within the <code>Main.elm</code> file, add the following:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode elm"><code class="sourceCode elm"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">module</span> <span class="dt">Main</span> <span class="kw">exposing</span> (<span class="op">..</span>)</span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="kw">import</span> <span class="dt">Html</span> <span class="kw">exposing</span> (<span class="fu">text</span>)</span>
<span id="cb4-4"><a href="#cb4-4"></a></span>
<span id="cb4-5"><a href="#cb4-5"></a></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="fu">main</span> <span class="op">=</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>    <span class="fu">text</span> <span class="st">&quot;Hello, world!&quot;</span></span></code></pre></div>
<p>Here, we import the <code>Html</code> package that we installed, specifically expose the <code>text</code> function from it and then use that function to tell Elm that we want some HTML-friendly text.</p>
<p><em>Note: to learn more about the Elm language and syntax, check out the <a href="https://www.elm-tutorial.org/en/">Elm Tutorial</a>, the <a href="https://egghead.io/courses/start-using-elm-to-build-web-applications">EggHead.io Elm course</a>, subscribe to <a href="https://www.dailydrip.com/topics/elm">DailyDrip’s Elm Topic</a>, <a href="http://courses.knowthen.com">James Moore’s Elm Courses</a> or check out <a href="http://exercism.io/languages/elm/about">Elm on exercism.io</a>.</em></p>
<p>We can then compile this and output it to <code>elm.js</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1"></a>λ <span class="ex">elm</span> make src/Main.elm --output=elm.js</span></code></pre></div>
<p>You should now have a (quite large) file, <code>elm.js</code>, in your project’s root. We’re almost done!</p>
<p>Finally, create a new file, <code>index.html</code>, and add the following to it:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb6-1"><a href="#cb6-1"></a><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw">&lt;html</span><span class="ot"> lang=</span><span class="st">&quot;en&quot;</span><span class="kw">&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="kw">&lt;head&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>    <span class="kw">&lt;title&gt;</span>Weather<span class="kw">&lt;/title&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>    <span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">&quot;utf-8&quot;</span><span class="kw">&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>    <span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">&quot;viewport&quot;</span><span class="ot"> content=</span><span class="st">&quot;width=device-width, initial-scale=1&quot;</span><span class="kw">&gt;</span></span>
<span id="cb6-7"><a href="#cb6-7"></a>  <span class="kw">&lt;/head&gt;</span></span>
<span id="cb6-8"><a href="#cb6-8"></a>  <span class="kw">&lt;body&gt;</span></span>
<span id="cb6-9"><a href="#cb6-9"></a>    <span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="ot"> src=</span><span class="st">&quot;elm.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb6-10"><a href="#cb6-10"></a>    <span class="kw">&lt;script&gt;</span></span>
<span id="cb6-11"><a href="#cb6-11"></a>      (<span class="kw">function</span>(global) <span class="op">{</span></span>
<span id="cb6-12"><a href="#cb6-12"></a>        <span class="kw">var</span> node <span class="op">=</span> <span class="va">document</span>.<span class="at">createElement</span>(<span class="st">&#39;div&#39;</span>)</span>
<span id="cb6-13"><a href="#cb6-13"></a>        <span class="va">document</span>.<span class="va">body</span>.<span class="at">appendChild</span>(node)</span>
<span id="cb6-14"><a href="#cb6-14"></a>        <span class="kw">var</span> app <span class="op">=</span> <span class="va">Elm</span>.<span class="va">Main</span>.<span class="at">embed</span>(node)</span>
<span id="cb6-15"><a href="#cb6-15"></a>        <span class="va">global</span>.<span class="at">app</span> <span class="op">=</span> app</span>
<span id="cb6-16"><a href="#cb6-16"></a>      <span class="op">}</span>)(window)</span>
<span id="cb6-17"><a href="#cb6-17"></a>    <span class="kw">&lt;/script&gt;</span></span>
<span id="cb6-18"><a href="#cb6-18"></a>  <span class="kw">&lt;/body&gt;</span></span>
<span id="cb6-19"><a href="#cb6-19"></a><span class="kw">&lt;/html&gt;</span></span></code></pre></div>
<p>If you run <code>λ open index.html</code>, you should be able to view the file in the browser and see <code>Hello, world!</code>. Congrats! You’re primed and ready to start building.</p>
<h3 id="creating-a-build-file">Creating a Build File</h3>
<p>If you’re lazy like me, you can create an executable file, <code>build</code>, that will perform our <code>elm make ...</code> command for us:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1"></a>λ <span class="fu">touch</span> build</span>
<span id="cb7-2"><a href="#cb7-2"></a>λ <span class="fu">chmod</span> +x build</span>
<span id="cb7-3"><a href="#cb7-3"></a>λ <span class="fu">cat</span> <span class="op">&lt;&lt;EOF</span> <span class="op">&gt;</span> <span class="ex">./build</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>#!/bin/bash</span>
<span id="cb7-5"><a href="#cb7-5"></a></span>
<span id="cb7-6"><a href="#cb7-6"></a>elm-make src/Main.elm --output ./elm.js</span>
<span id="cb7-7"><a href="#cb7-7"></a>EOF</span></code></pre></div>
<p>This executable can now handle whatever build options and processes we’ll add for the future (such as JavaScript minification &amp; uglifying):</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1"></a>λ <span class="ex">./build</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="ex">Success</span>! Compiled 1 module.</span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="ex">Successfully</span> generated ./elm.js</span></code></pre></div>
<h2 id="proxies">Proxies</h2>
<p>In order to not expose our API keys for geocoding and weather forecasts, we’ll be using a separate proxy server for each service. I wrote recently wrote a post entitled <a href="/node-js-geocoding-proxy-with-paperplane.html">Node.js Geocoding Proxy with Paperplane</a> where you can see a full explanation of what we’re doing and how to do it. If you don’t care about the how and why about setting up these little servers, then just continue on!</p>
<h3 id="setting-up-your-geocoding-proxy">Setting Up Your Geocoding Proxy</h3>
<p>First, you’ll need to get a Google Maps API Key from here: <a href="https://developers.google.com/maps/documentation/geocoding/start#get-a-key">https://developers.google.com/maps/documentation/geocoding/start#get-a-key</a>.</p>
<p>Once you’ve done that, go ahead and clone or download <a href="https://github.com/rpearce/geocoding-proxy">the geocoding-proxy project on GitHub</a> and follow the directions to get set up. Given you’ve got Node installed, you’ve copied over the <code>.env</code> file and set your API key in there, then running <code>λ node index.js</code> should start the server. From another command-line tab, run this and see if you get a similar result:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1"></a>λ <span class="ex">curl</span> localhost:5050/geocode/Auckland</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="dt">{&quot;results&quot;:[...]}</span></span></code></pre></div>
<p>If so, congrats! If you get stuck, create an issue on the <a href="https://github.com/rpearce/geocoding-proxy/issues">geocoding-proxy issues page</a>, and I’ll see if I can help.</p>
<h3 id="setting-up-your-darksky-proxy">Setting Up Your DarkSky Proxy</h3>
<p>(This is almost exactly like the geocoding proxy setup.)</p>
<p>First, you’ll need to get a DarkSky API Key from here: <a href="https://darksky.net/dev/">https://darksky.net/dev/</a>.</p>
<p>Once you’ve done that, go ahead and clone or download <a href="https://github.com/rpearce/DarkSky-proxy">the DarkSky-proxy project on GitHub</a> and follow the directions to get set up. Given you’ve got Node installed, you’ve copied over the <code>.env</code> file and set your API key in there, then running <code>λ node index.js</code> should start the server. From another command-line tab, run this and see if you get a similar result:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1"></a>λ <span class="ex">curl</span> http://localhost:5051/forecast/37.8267,-122.4233</span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="dt">{&quot;latitude&quot;:37.8267,&quot;longitude&quot;:-122.4233,...}</span></span></code></pre></div>
<p>If so, congrats! If you get stuck, create an issue on the <a href="https://github.com/rpearce/DarkSky-proxy/issues">DarkSky-proxy issues page</a>, and I’ll see if I can help.</p>
<h2 id="wrapping-up">Wrapping Up</h2>
<p>Thank you for reading this far! Now that we’ve got our Elm app build process set up and your proxy servers ready to work, we can start constructing our application piece-by-piece in the next article in the series.</p>
<p>If you’d like to be notified of when articles are published, subscribe!</p>
<p>Until next time, <br> Robert</p>
    </section>
  </article>
</main>

<footer>
  <section class="subscribe section--padded">
  <div class="layout--constrained">
    <h2 class="subscribe__header">Get notified of new posts</h2>

    <form action="//robertwpearce.us13.list-manage.com/subscribe/post?u=2df44e8960266388bff165fa6&amp;id=ee2f2a3737" method="post" name="mc-embedded-subscribe-form" target="_blank" novalidate class="subscribe__form">
      <div id="mce-responses">
        <div class="response" id="mce-error-response" style="display:none"></div>
        <div class="response" id="mce-success-response" style="display:none"></div>
      </div>
      <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_2df44e8960266388bff165fa6_ee2f2a3737" tabindex="-1" value=""></div>
      <div class="subscribe__section">
        <input type="email" value="" id="mce-EMAIL" class="subscribe__input" name="EMAIL" placeholder="you@greatemail.com" aria-label="Email Address">
        <input type="submit" value="Subscribe" name="subscribe" class="subscribe__submit">
      </div>
      <small>Note: I will <em>never</em> give out your email nor spam you. Unsubscribe at any time.</small>
    </form>

    <p>
      <small>(or subscribe to the <a href="/atom.xml" class="subscribe__link">atom</a> or <a class="subscribe__link" href="/rss.xml">rss</a> feeds)</small>
    </p>
  </div>
</section>

</footer>

  </body>
</html>
