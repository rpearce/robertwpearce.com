<!DOCTYPE html><html lang="en"><head><title>Elm, Geocoding & DarkSky: Pt. 1 – Setup Elm & Proxy Servers</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta name="description" content="In Part 1 we will begin building a small weather forecast app using Elm, Google's Geocoding API and the DarkSky API."><meta property="og:site_name" content="Robert Pearce | Freelance Software Developer"><meta property="og:title" content="Elm, Geocoding & DarkSky: Pt. 1 – Setup Elm & Proxy Servers"><meta property="og:url" content="https://robertwpearce.com/blog/elm-geocoding-and-darksky-pt-1-setup-elm-and-proxy-servers.html"><meta property="og:description" content="In Part 1 we will begin building a small weather forecast app using Elm, Google's Geocoding API and the DarkSky API."><meta property="og:image" content="https://robertwpearce.com/images/snow-dogs.jpg"><meta property="og:type" content="article"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://robertwpearce.com/blog/elm-geocoding-and-darksky-pt-1-setup-elm-and-proxy-servers.html"><link rel="stylesheet" href="/styles.css"><meta name="google-site-verification" content="QX4bn65yOXBfgnwxlO09yIBc1H8blur-Erx3lmsDVhU"><link href="//fonts.googleapis.com/css?family=Lato:400" rel="stylesheet" type="text/css"></head><body><main><nav><div class="layout--constrained"><ul class="nav--main list--bare list--horz"><li><a href="/">Home</a></li><li><a href="mailto:me@robertwpearce.com?subject=Work Inquiry">Hire Me</a></li></ul></div></nav><article class="article"><div class="article__background" style="background-image: url('https://robertwpearce.com/images/snow-dogs.jpg')"><header class="article__bgHeader"><div class="layout--constrained"><div class="article__bgTitleContainer"><h1 class="heading--trim"><a href="/blog/elm-geocoding-and-darksky-pt-1-setup-elm-and-proxy-servers.html">Elm, Geocoding & DarkSky: Pt. 1 – Setup Elm & Proxy Servers</a></h1><div class="article__subHeader"><small>July 22, 2017</small> <small class="photoCred">[photo credit <a href="https://unsplash.com/@padolsey">James Padolsey</a>]</small></div></div></div></header></div><div class="layout--constrained"><header class="article__header heading--fatBottomBorder"><h1 class="heading--trim"><a href="/blog/elm-geocoding-and-darksky-pt-1-setup-elm-and-proxy-servers.html">Elm, Geocoding & DarkSky: Pt. 1 – Setup Elm & Proxy Servers</a></h1><small>July 22, 2017</small></header><p>This is part 1 of a multipart series where we will be building a small weather forecast app using <a href="http://elm-lang.org/">Elm</a>, <a href="https://developers.google.com/maps/documentation/geocoding/start">Google&#39;s Geocoding API</a> and the <a href="https://darksky.net/dev/">DarkSky API</a>. Instead of doing everything in one massive post, I&#39;ve broken the steps down into parts of a series. Here is the series plan:</p><ul><li>Pt. 1 – Setup Elm &amp; Proxy Servers</li><li><span class="faded">(wip) Pt. 2 – Geocoding an Address</span></li><li><span class="faded">(wip) Pt. 3 – Fetching the Current Weather</span></li><li><span class="faded">(wip) Pt. 4 – Fetching the Weather Forecast</span></li><li><span class="faded">(wip) Pt. 5 – Extracting our Elm Code</span></li><li><span class="faded">(wip) Pt. 6 – Building for Semi-Production</span></li></ul><h2 id="overview">Overview</h2><p>This post will cover setting up <a href="http://elm-lang.org/">Elm</a>, a <a href="http://localhost:3000/blog/node-js-geocoding-proxy-with-paperplane.html">geocoding proxy</a> and a <a href="https://github.com/rpearce/DarkSky-proxy/">DarkSky proxy</a>. We&#39;ll need all of these things set up in order to get our weather app to work and not sacrifice our API keys.</p><p>By the end of this post, you will have a &quot;Hello, world!&quot; Elm app with a simple <code>./build</code> command, and you should be able to <code>cURL</code> both your geocoding and DarkSky proxies to receive response data that we will use in the coming lessons.</p><h2 id="project-source-code">Project Source Code</h2><p>The project we&#39;re making will be broken into parts here (branches will be named for each part): <a href="https://github.com/rpearce/elm-geocoding-darksky/">https://github.com/rpearce/elm-geocoding-darksky/</a>. Be sure to check out the other branches to see the other parts as they become available.</p><p>The project code for this part is located in the <code>pt-1</code> branch: <a href="https://github.com/rpearce/elm-geocoding-darksky/tree/pt-1">https://github.com/rpearce/elm-geocoding-darksky/tree/pt-1</a>.</p><h2 id="pre-requisites">Pre-requisites</h2><p>This tutorial assumes that you already have installed Node.js (I use <a href="https://github.com/creationix/nvm">NVM</a> for managing Node versions and am using <code>v8.3</code>).</p><p>Once you&#39;ve got Node installed, we can begin.</p><h2 id="project-setup">Project Setup</h2><p>From your favorite project folder, let&#39;s create a new project folder named <code>elm-geocoding-darksky</code> and change the current working directory to be the new folder:</p><pre><code>λ mkdir elm-geocoding-darksky
λ cd elm-geocoding-darksky
</code></pre><h2 id="elm">Elm</h2><h3 id="installing-elm">Installing Elm</h3><p>You can install elm via any of the methods on the <a href="https://guide.elm-lang.org/install.html">elm install page</a> or by one of these methods:</p><ul><li>Homebrew: <code>brew install elm</code></li><li>Node.js: <code>npm i elm -g</code> for a global binary or <code>npm init -y &amp;&amp; npm i elm</code> to create a <code>package.json</code> file and install <code>elm</code> to it; you&#39;ll have to run this latter method via <code>npx elm</code>, as it&#39;ll be looking for the binary in your <code>./node_modules/.bin/</code> directory)</li></ul><h3 id="elm-format">elm-format</h3><p>I&#39;ve found that having a tool re-format my Elm code to an agreed-upon format makes me more efficient and makes it easier for others to read my code. Check out these projects for more on how to do this:</p><ul><li><a href="https://github.com/avh4/elm-format">https://github.com/avh4/elm-format</a></li><li><a href="https://github.com/ElmCast/elm-vim">elm-vim</a></li></ul><h3 id="adding-elm-to-a-webpage">Adding Elm to a Webpage</h3><p>Our goal here is to compile our elm project to an <code>elm.js</code> file and include that on a webpage (which we&#39;ll make in a minute).</p><p>First, let&#39;s create a <code>src/</code> directory to house our source code and a <code>Main.elm</code> file within it:</p><pre><code>λ mkdir src
λ touch src/Main.elm
</code></pre><p>Next, we want to install Elm&#39;s HTML package so that so that we can access its HTML-related functions:</p><pre><code>λ elm package install elm-lang/html
</code></pre><p>Within the <code>Main.elm</code> file, add the following:</p><pre><code class="lang-haskell"><span class="token keyword">module</span> <span class="token constant">Main</span> <span class="token hvariable">exposing</span> <span class="token punctuation">(</span><span class="token operator">..</span><span class="token punctuation">)</span><span class="token import_statement">

<span class="token keyword">import</span> Html</span> <span class="token hvariable">exposing</span> <span class="token punctuation">(</span><span class="token hvariable">text</span><span class="token punctuation">)</span>


<span class="token hvariable">main</span> <span class="token operator">=</span>
    <span class="token hvariable">text</span> <span class="token string">"Hello, world!"</span>
</code></pre><p>Here, we import the <code>Html</code> package that we installed, specifically expose the <code>text</code> function from it and then use that function to tell Elm that we want some HTML-friendly text.</p><p><em>Note: to learn more about the Elm language and syntax, check out the <a href="https://www.elm-tutorial.org/en/">Elm Tutorial</a>, the <a href="https://egghead.io/courses/start-using-elm-to-build-web-applications">EggHead.io Elm Course</a> or subscribe to <a href="https://www.dailydrip.com/topics/elm">DailyDrip&#39;s Elm Topic</a>.</em></p><p>We can then compile this and output it to <code>elm.js</code>:</p><pre><code>λ elm make src/Main.elm --output=elm.js
</code></pre><p>You should now have a (quite large) file, <code>elm.js</code>, in your project&#39;s root. We&#39;re almost done!</p><p>Finally, create a new file, <code>index.html</code>, and add the following to it:</p><pre><code class="lang-html"><span class="token doctype">&lt;!DOCTYPE html></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Weather<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width, initial-scale<span class="token punctuation">=</span>1, maximum-scale<span class="token punctuation">=</span>1, minimum-scale<span class="token punctuation">=</span>1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>elm.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">
      <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>global<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> node <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
        <span class="token keyword">var</span> app <span class="token operator">=</span> Elm<span class="token punctuation">.</span>Main<span class="token punctuation">.</span><span class="token function">embed</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
        global<span class="token punctuation">.</span>app <span class="token operator">=</span> app
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span>
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>
</code></pre><p>If you run <code>λ open index.html</code>, you should be able to view the file in the browser and see <code>Hello, world!</code>. Congrats! You&#39;re primed and ready to start building.</p><h3 id="creating-a-build-file">Creating a Build File</h3><p>If you&#39;re lazy like me, you can create an executable file, <code>build</code>, that will perform our <code>elm make ...</code> command for us:</p><pre><code>λ touch build
λ chmod +x build
λ cat &lt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EOF</span> <span class="token punctuation">></span></span> ./build
#!/bin/bash

elm-make src/Main.elm --output ./elm.js
EOF
</code></pre><p>This executable can now handle whatever build options and processes we&#39;ll add for the future (such as JavaScript minification &amp; uglifying):</p><pre><code>λ ./build
Success! Compiled 1 module.
Successfully generated ./elm.js
</code></pre><h2 id="proxies">Proxies</h2><p>In order to not expose our API keys for geocoding and weather forecasts, we&#39;ll be using a separate proxy server for each service. I wrote recently wrote a post entitled <a href="/blog/node-js-geocoding-proxy-with-paperplane.html">Node.js Geocoding Proxy with Paperplane</a> where you can see a full explanation of what we&#39;re doing and how to do it. If you don&#39;t care about the how and why about setting up these little servers, then just continue on!</p><h3 id="setting-up-your-geocoding-proxy">Setting Up Your Geocoding Proxy</h3><p>First, you&#39;ll need to get a Google Maps API Key from here: <a href="https://developers.google.com/maps/documentation/geocoding/start#get-a-key">https://developers.google.com/maps/documentation/geocoding/start#get-a-key</a>.</p><p>Once you&#39;ve done that, go ahead and clone or download <a href="https://github.com/rpearce/geocoding-proxy">the geocoding-proxy project on GitHub</a> and follow the directions to get set up. Given you&#39;ve got Node installed, you&#39;ve copied over the <code>.env</code> file and set your API key in there, then running <code>λ node index.js</code> should start the server. From another command-line tab, run this and see if you get a similar result:</p><pre><code class="lang-js">λ curl localhost<span class="token punctuation">:</span><span class="token number">5050</span><span class="token operator">/</span>geocode<span class="token operator">/</span>Auckland
<span class="token punctuation">{</span><span class="token string">"results"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre><p>If so, congrats! If you get stuck, create an issue on the <a href="https://github.com/rpearce/geocoding-proxy/issues">geocoding-proxy issues page</a>, and I&#39;ll see if I can help.</p><h3 id="setting-up-your-darksky-proxy">Setting Up Your DarkSky Proxy</h3><p>(This is almost exactly like the geocoding proxy setup.)</p><p>First, you&#39;ll need to get a DarkSky API Key from here: <a href="https://darksky.net/dev/">https://darksky.net/dev/</a>.</p><p>Once you&#39;ve done that, go ahead and clone or download <a href="https://github.com/rpearce/DarkSky-proxy">the DarkSky-proxy project on GitHub</a> and follow the directions to get set up. Given you&#39;ve got Node installed, you&#39;ve copied over the <code>.env</code> file and set your API key in there, then running <code>λ node index.js</code> should start the server. From another command-line tab, run this and see if you get a similar result:</p><pre><code class="lang-js">λ curl http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token punctuation">:</span><span class="token number">5051</span><span class="token operator">/</span>forecast<span class="token operator">/</span><span class="token number">37.8267</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">122.4233</span>
<span class="token punctuation">{</span><span class="token string">"latitude"</span><span class="token punctuation">:</span><span class="token number">37.8267</span><span class="token punctuation">,</span><span class="token string">"longitude"</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">122.4233</span><span class="token punctuation">,</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre><p>If so, congrats! If you get stuck, create an issue on the <a href="https://github.com/rpearce/DarkSky-proxy/issues">DarkSky-proxy issues page</a>, and I&#39;ll see if I can help.</p><h2 id="wrapping-up">Wrapping Up</h2><p>Thank you for reading this far! Now that we&#39;ve got our Elm app build process set up and your proxy servers ready to work, we can start constructing our application piece-by-piece in the next article in the series.</p><p>If you&#39;d like to be notified of when articles are published, subscribe!</p><p>Until next time,<br>Robert</p></div></article><section class="section--padded bg--gray"><div class="layout--constrained"><h2>Get Updates</h2><!-- Begin MailChimp Signup Form --><form action="//robertwpearce.us13.list-manage.com/subscribe/post?u=2df44e8960266388bff165fa6&amp;id=ee2f2a3737" method="post" name="mc-embedded-subscribe-form" target="_blank" novalidate class="form"><div id="mce-responses"><div class="response" id="mce-error-response" style="display:none"></div><div class="response" id="mce-success-response" style="display:none"></div></div><div style="position: absolute; left: -5000px" aria-hidden="true"><input type="text" name="b_2df44e8960266388bff165fa6_ee2f2a3737" tabindex="-1" value=""></div><div class="form__container"><label for="mce-EMAIL" class="form__label">Email Address</label><input type="email" value="" id="mce-EMAIL" class="form__input" name="EMAIL" placeholder="you@greatemail.com"> <input type="submit" value="Subscribe" name="subscribe" class="form__submit"></div><small>Note: I will <em>never</em> give out your email nor spam you. Unsubscribe at any time.</small></form><!--End mc_embed_signup--></div></section></main></body></html>