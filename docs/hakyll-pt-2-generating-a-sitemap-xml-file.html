<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Hakyll Pt. 2 – Generating a Sitemap XML File</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Generate a sitemap.xml file for your hakyll site.">
    <meta name="author" content="Robert Pearce">
    <meta name="keywords" content="hakyll, hakyll sitemap, hakyll tutorial, hakyll blog, hakyll blog tutorial, hakyll static site, static site generator">
    <meta name="google-site-verification" content="QX4bn65yOXBfgnwxlO09yIBc1H8blur-Erx3lmsDVhU">

    <meta property="og:site_name" content="Robert Pearce | Freelance Software Developer">
    <meta property="og:title" content="Hakyll Pt. 2 – Generating a Sitemap XML File">
    <meta property="og:url" content="https://robertwpearce.com/hakyll-pt-2-generating-a-sitemap-xml-file.html">
    <meta property="og:description" content="Generate a sitemap.xml file for your hakyll site.">
    <meta property="og:image" content="https://robertwpearce.com/images/lake-wanaka.jpg">
    
      <meta property="og:type" content="article">
    

    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:site" content="Robert Pearce | Freelance Software Developer">
    <meta property="twitter:title" content="Hakyll Pt. 2 – Generating a Sitemap XML File">
    <meta property="twitter:description" content="Generate a sitemap.xml file for your hakyll site.">
    <meta property="twitter:image" content="https://robertwpearce.com/images/lake-wanaka.jpg">
    <meta property="twitter:creator" content="@RobertWPearce">

    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="canonical" href="https://robertwpearce.com/hakyll-pt-2-generating-a-sitemap-xml-file.html">
    <link href="//fonts.googleapis.com/css?family=Lato:400" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/css/default.css" />
    
      <link rel="stylesheet" href="/css/article.css" />
    
  </head>
  <body>
    <nav class="nav">
  <div class="layout--constrained">
    <a class="nav__link nav__skip" href="#content">Skip to content</a>
    <a class="nav__link" href="/">Home</a>
    <a class="nav__link" href="mailto:me@robertwpearce.com?subject=Work Inquiry">Hire Me</a>
    <a class="nav__link" href="/atom.xml">atom</a>
    <a class="nav__link" href="/rss.xml">rss</a>
  </div>
</nav>


<main id="content" tabindex="-1">
  <article class="article">
    <header class="article__bg" style="background-image: url('/images/lake-wanaka.jpg')">
      <div class="article__bgHeader">
        <div class="layout--constrained">
          <div class="article__bgTitleWrap">
            <h1 class="article__bgTitle">
              <a href="/hakyll-pt-2-generating-a-sitemap-xml-file.html">Hakyll Pt. 2 – Generating a Sitemap XML File</a>
            </h1>
            <div class="article__bgSubHeader">
              <small class="italic">2018-11-17</small>
              
                <small class="article__bgPhotoCred italic">
                  [ photo credit <a href="https://www.instagram.com/theworldwithabackpack/">theworldwithabackpack</a> ]
                </small>
              
            </div>
          </div>
        </div>
      </div>
    </header>
    <section class="layout--constrained">
      <header class="article__header">
        <h1 class="article__title">
          <a href="/hakyll-pt-2-generating-a-sitemap-xml-file.html">Hakyll Pt. 2 – Generating a Sitemap XML File</a>
        </h1>
        <small class="italic">2018-11-17</small>
      </header>
      <p>This is part 2 of a multipart series where we will look at getting a website / blog set up with <a href="https://jaspervdj.be/hakyll">hakyll</a> and customized a fair bit.</p>
<ul>
<li><a href="/hakyll-pt-1-setup-and-initial-customization.html">Pt. 1 – Setup &amp; Initial Customization</a></li>
<li>Pt. 2 – Generating a Sitemap XML File</li>
<li><em>(wip) Pt. 3 – Generating RSS and Atom XML Feeds</em></li>
<li><em>(wip) Pt. 4 – Customizing Markdown Compiler Options</em></li>
<li><em>(wip) Pt. 5 – Generating Custom Post Filenames From a Title Slug</em></li>
</ul>
<h2 id="overview">Overview</h2>
<ol>
<li><a href="#adding-a-sitemap-template">Adding a Sitemap Template</a></li>
<li><a href="#generating-the-sitemap-xml-file">Generating the Sitemap XML File</a></li>
<li><a href="#adding-other-pages-and-directories">Adding Other Pages and Directories</a></li>
</ol>
<h2 id="adding-a-sitemap-template">Adding a Sitemap Template</h2>
<p>A sitemap.xml template, just like <a href="/hakyll-pt-1-setup-and-initial-customization.html#working-with-templates">the templates in the last post</a>, receives context fields to work with (variables, essentially), and outputs the result of applying said context to the template. Here is what our sitemap template will look like today in our project’s <code>templates/sitemap.xml</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode xml"><code class="sourceCode xml"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">&lt;?xml</span> version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;<span class="kw">?&gt;</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">&lt;urlset</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="ot">  xmlns=</span><span class="st">&quot;http://www.sitemaps.org/schemas/sitemap/0.9&quot;</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="ot">  xmlns:news=</span><span class="st">&quot;http://www.google.com/schemas/sitemap-news/0.9&quot;</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="ot">  xmlns:xhtml=</span><span class="st">&quot;http://www.w3.org/1999/xhtml&quot;</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="ot">  xmlns:mobile=</span><span class="st">&quot;http://www.google.com/schemas/sitemap-mobile/1.0&quot;</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="ot">  xmlns:image=</span><span class="st">&quot;http://www.google.com/schemas/sitemap-image/1.1&quot;</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="ot">  xmlns:video=</span><span class="st">&quot;http://www.google.com/schemas/sitemap-video/1.1&quot;</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb1-10" title="10">  <span class="kw">&lt;url&gt;</span></a>
<a class="sourceLine" id="cb1-11" title="11">    <span class="kw">&lt;loc&gt;</span>$root$<span class="kw">&lt;/loc&gt;</span></a>
<a class="sourceLine" id="cb1-12" title="12">    <span class="kw">&lt;changefreq&gt;</span>daily<span class="kw">&lt;/changefreq&gt;</span></a>
<a class="sourceLine" id="cb1-13" title="13">    <span class="kw">&lt;priority&gt;</span>1.0<span class="kw">&lt;/priority&gt;</span></a>
<a class="sourceLine" id="cb1-14" title="14">  <span class="kw">&lt;/url&gt;</span></a>
<a class="sourceLine" id="cb1-15" title="15">$for(pages)$</a>
<a class="sourceLine" id="cb1-16" title="16">  <span class="kw">&lt;url&gt;</span></a>
<a class="sourceLine" id="cb1-17" title="17">    <span class="kw">&lt;loc&gt;</span>$root$$url$<span class="kw">&lt;/loc&gt;</span></a>
<a class="sourceLine" id="cb1-18" title="18">    <span class="kw">&lt;lastmod&gt;</span>$if(updated)$$updated$$else$$if(date)$$date$$endif$$endif$<span class="kw">&lt;/lastmod&gt;</span></a>
<a class="sourceLine" id="cb1-19" title="19">    <span class="kw">&lt;changefreq&gt;</span>weekly<span class="kw">&lt;/changefreq&gt;</span></a>
<a class="sourceLine" id="cb1-20" title="20">    <span class="kw">&lt;priority&gt;</span>0.8<span class="kw">&lt;/priority&gt;</span></a>
<a class="sourceLine" id="cb1-21" title="21">  <span class="kw">&lt;/url&gt;</span></a>
<a class="sourceLine" id="cb1-22" title="22">$endfor$</a>
<a class="sourceLine" id="cb1-23" title="23"><span class="kw">&lt;/urlset&gt;</span></a></code></pre></div>
<p>Apart from the normal sitemap boilerplate, you can see <code>root</code>, <code>pages</code>, <code>url</code>, <code>date</code> and <code>updated</code> context fields. While <code>date</code> and <code>updated</code> would come from your metadata fields defined for a post, and the <code>url</code> is built from hakyll’s <a href="https://github.com/jaspervdj/hakyll/blob/c85198d8cb6ce055c788e287c7f2470eac0aad36/lib/Hakyll/Web/Template/Context.hs#L192"><code>defaultContext</code></a>, the <code>root</code> and <code>pages</code> fields are custom defined in what will be our very own <code>sitemapCtx</code> context. In the next section, we’ll use this template to generate our sitemap.xml file.</p>
<h2 id="generating-the-sitemap-xml-file">Generating the Sitemap XML File</h2>
<p>If you <a href="http://localhost:8000/hakyll-pt-1-setup-and-initial-customization.html#installation-setup">create a hakyll project from scratch</a>, you will start out with a few files that we can add to our sitemap:</p>
<ul>
<li><code>index.html</code></li>
<li><code>about.rst</code></li>
<li><code>contact.markdown</code></li>
<li><code>posts/2015-08-12-spqr.html</code></li>
<li><code>posts/2015-10-07-rosa-rosa-rosam.html</code></li>
<li><code>posts/2015-11-28-carpe-diem.html</code></li>
<li><code>posts/2015-12-07-tu-quoque.html</code></li>
</ul>
<p>You should note that your <code>site.hs</code> file also has the following:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb2-1" title="1"><span class="ot">main ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb2-2" title="2">main <span class="fu">=</span> hakyllWith config <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb2-3" title="3">    <span class="co">-- ...</span></a>
<a class="sourceLine" id="cb2-4" title="4"></a>
<a class="sourceLine" id="cb2-5" title="5">    match (fromList [<span class="st">&quot;about.rst&quot;</span>, <span class="st">&quot;contact.markdown&quot;</span>]) <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb2-6" title="6">        route   <span class="fu">$</span> setExtension <span class="st">&quot;html&quot;</span></a>
<a class="sourceLine" id="cb2-7" title="7">        compile <span class="fu">$</span> pandocCompiler</a>
<a class="sourceLine" id="cb2-8" title="8">            <span class="fu">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/default.html&quot;</span> defaultContext</a>
<a class="sourceLine" id="cb2-9" title="9"></a>
<a class="sourceLine" id="cb2-10" title="10"></a>
<a class="sourceLine" id="cb2-11" title="11">    match <span class="st">&quot;posts/*&quot;</span> <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb2-12" title="12">        route <span class="fu">$</span> setExtension <span class="st">&quot;html&quot;</span></a>
<a class="sourceLine" id="cb2-13" title="13">        compile <span class="fu">$</span> pandocCompiler</a>
<a class="sourceLine" id="cb2-14" title="14">            <span class="fu">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/post.html&quot;</span>    postCtx</a>
<a class="sourceLine" id="cb2-15" title="15">            <span class="fu">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/default.html&quot;</span> postCtx</a></code></pre></div>
<p>It’s important that you understand that any files you want to be loaded and sent to <code>templates/sitemap.xml</code> must first be <code>match</code>ed and <code>compile</code>d <em>before</em> the sitemap can be built. If you don’t do this, you’ll pull your hair out wondering why the file (or folder) you’re trying to include in the sitemap never shows up.</p>
<p>Now, there is something that we are going to emulate to make this sitemap a reality (this should already be in <code>site.hs</code>):</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb3-1" title="1"><span class="ot">main ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb3-2" title="2">main <span class="fu">=</span> hakyllWith config <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb3-3" title="3">    <span class="co">-- ...</span></a>
<a class="sourceLine" id="cb3-4" title="4"></a>
<a class="sourceLine" id="cb3-5" title="5">    create [<span class="st">&quot;archive.html&quot;</span>] <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb3-6" title="6">        route idRoute</a>
<a class="sourceLine" id="cb3-7" title="7">        compile <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb3-8" title="8">            posts <span class="ot">&lt;-</span> recentFirst <span class="fu">=&lt;&lt;</span> loadAll <span class="st">&quot;posts/*&quot;</span></a>
<a class="sourceLine" id="cb3-9" title="9">            <span class="kw">let</span> archiveCtx <span class="fu">=</span></a>
<a class="sourceLine" id="cb3-10" title="10">                    listField <span class="st">&quot;posts&quot;</span> postCtx (<span class="fu">return</span> posts) <span class="ot">`mappend`</span></a>
<a class="sourceLine" id="cb3-11" title="11">                    constField <span class="st">&quot;title&quot;</span> <span class="st">&quot;Archives&quot;</span>            <span class="ot">`mappend`</span></a>
<a class="sourceLine" id="cb3-12" title="12">                    defaultContext</a>
<a class="sourceLine" id="cb3-13" title="13"></a>
<a class="sourceLine" id="cb3-14" title="14">            makeItem <span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb3-15" title="15">                <span class="fu">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/archive.html&quot;</span> archiveCtx</a>
<a class="sourceLine" id="cb3-16" title="16">                <span class="fu">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/default.html&quot;</span> archiveCtx</a></code></pre></div>
<p>Reading the code above, this essentially says</p>
<ol>
<li>here’s a file we want to create that <em>does not yet exist</em> (how <code>create</code> differs from <code>match</code>)</li>
<li>when you create the route, keep the filename (what <code>idRoute</code> does)</li>
<li>when you compile, load all the posts, specify what the context to send to each template will be, then make the item (the <code>&quot;&quot;</code> is an identifier… see <a href="https://github.com/jaspervdj/hakyll/blob/1abdeee743d65d96c6f469213ca6e7ea823340a7/lib/Hakyll/Core/Compiler.hs#L65-L68">the source</a> for more), then pass the context to the archive template and pass that on to the default template, ultimately building up a full webpage from the inside-out</li>
</ol>
<p>Let’s change this 3-step rule to suit our needs before we wrangle the code. We want our rules to say:</p>
<ol>
<li>here’s a file we want to create that <em>does not yet exist</em> (<code>sitemap.xml</code>)</li>
<li>when you create the route, keep the filename (what <code>idRoute</code> does)</li>
<li>when you compile, load all the posts, load all the other pages, specify what the context to send to each template will be, then make the item, then pass the context to the sitemap template, ultimately building up an XML file</li>
</ol>
<p>This is almost the same! Let’s write it:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb4-1" title="1"><span class="ot">main ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb4-2" title="2">main <span class="fu">=</span> hakyllWith config <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb4-3" title="3">    <span class="co">-- ...</span></a>
<a class="sourceLine" id="cb4-4" title="4"></a>
<a class="sourceLine" id="cb4-5" title="5">    create [<span class="st">&quot;sitemap.xml&quot;</span>] <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb4-6" title="6">        route idRoute</a>
<a class="sourceLine" id="cb4-7" title="7">        compile <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb4-8" title="8">            <span class="co">-- load and sort the posts</span></a>
<a class="sourceLine" id="cb4-9" title="9">            posts <span class="ot">&lt;-</span> recentFirst <span class="fu">=&lt;&lt;</span> loadAll <span class="st">&quot;posts/*&quot;</span></a>
<a class="sourceLine" id="cb4-10" title="10"></a>
<a class="sourceLine" id="cb4-11" title="11">            <span class="co">-- load individual pages from a list (globs DO NOT work here)</span></a>
<a class="sourceLine" id="cb4-12" title="12">            singlePages <span class="ot">&lt;-</span> loadAll (fromList [<span class="st">&quot;about.rst&quot;</span>, <span class="st">&quot;contact.markdown&quot;</span>])</a>
<a class="sourceLine" id="cb4-13" title="13"></a>
<a class="sourceLine" id="cb4-14" title="14">                           <span class="co">-- mappend the posts and singlePages together</span></a>
<a class="sourceLine" id="cb4-15" title="15">            <span class="kw">let</span> pages <span class="fu">=</span> posts <span class="fu">&lt;&gt;</span> singlePages</a>
<a class="sourceLine" id="cb4-16" title="16"></a>
<a class="sourceLine" id="cb4-17" title="17">                           <span class="co">-- create the `pages` field with the postCtx</span></a>
<a class="sourceLine" id="cb4-18" title="18">                           <span class="co">-- and return the `pages` value for it</span></a>
<a class="sourceLine" id="cb4-19" title="19">                sitemapCtx <span class="fu">=</span> listField <span class="st">&quot;pages&quot;</span> postCtx (<span class="fu">return</span> pages)</a>
<a class="sourceLine" id="cb4-20" title="20"></a>
<a class="sourceLine" id="cb4-21" title="21">            <span class="co">-- make the item and apply our sitemap template</span></a>
<a class="sourceLine" id="cb4-22" title="22">            makeItem <span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb4-23" title="23">                <span class="fu">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/sitemap.xml&quot;</span> sitemapCtx</a></code></pre></div>
<p>This is starting to look good! But what’s wrong here? Remember the <code>root</code> context bits? We’re going to need to define what that is, and the best way that I’ve found right now is simply as a <code>String</code>; if you want to do something fancy with configuration or reading it in dynamically, then go nuts.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb5-1" title="1"><span class="ot">root ::</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb5-2" title="2">root <span class="fu">=</span> <span class="st">&quot;https://ourblog.com&quot;</span></a></code></pre></div>
<p>With that defined, we can add it to our contexts:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb6-1" title="1"><span class="ot">main ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb6-2" title="2">main <span class="fu">=</span> hakyllWith config <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb6-3" title="3">    <span class="co">-- ...</span></a>
<a class="sourceLine" id="cb6-4" title="4"></a>
<a class="sourceLine" id="cb6-5" title="5">    create [<span class="st">&quot;sitemap.xml&quot;</span>] <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb6-6" title="6">        route idRoute</a>
<a class="sourceLine" id="cb6-7" title="7">        compile <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb6-8" title="8">            posts <span class="ot">&lt;-</span> recentFirst <span class="fu">=&lt;&lt;</span> loadAll <span class="st">&quot;posts/*&quot;</span></a>
<a class="sourceLine" id="cb6-9" title="9">            singlePages <span class="ot">&lt;-</span> loadAll (fromList [<span class="st">&quot;about.rst&quot;</span>, <span class="st">&quot;contact.markdown&quot;</span>])</a>
<a class="sourceLine" id="cb6-10" title="10">            <span class="kw">let</span> pages <span class="fu">=</span> posts <span class="fu">&lt;&gt;</span> singlePages</a>
<a class="sourceLine" id="cb6-11" title="11">                sitemapCtx <span class="fu">=</span></a>
<a class="sourceLine" id="cb6-12" title="12">                    constField <span class="st">&quot;root&quot;</span> root <span class="fu">&lt;&gt;</span> <span class="co">-- here</span></a>
<a class="sourceLine" id="cb6-13" title="13">                    listField <span class="st">&quot;pages&quot;</span> postCtx (<span class="fu">return</span> pages)</a>
<a class="sourceLine" id="cb6-14" title="14">            makeItem <span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb6-15" title="15">                <span class="fu">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/sitemap.xml&quot;</span> sitemapCtx</a>
<a class="sourceLine" id="cb6-16" title="16"></a>
<a class="sourceLine" id="cb6-17" title="17"></a>
<a class="sourceLine" id="cb6-18" title="18"><span class="co">-- ...</span></a>
<a class="sourceLine" id="cb6-19" title="19"></a>
<a class="sourceLine" id="cb6-20" title="20"></a>
<a class="sourceLine" id="cb6-21" title="21"><span class="ot">postCtx ::</span> <span class="dt">Context</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb6-22" title="22">postCtx <span class="fu">=</span></a>
<a class="sourceLine" id="cb6-23" title="23">    constField <span class="st">&quot;root&quot;</span> root      <span class="fu">&lt;&gt;</span> <span class="co">-- here</span></a>
<a class="sourceLine" id="cb6-24" title="24">    dateField <span class="st">&quot;date&quot;</span> <span class="st">&quot;%Y-%m-%d&quot;</span> <span class="fu">&lt;&gt;</span></a>
<a class="sourceLine" id="cb6-25" title="25">    defaultContext</a></code></pre></div>
<p><em>Hint: if the <code>&lt;&gt;</code> is throwing you for a loop, it’s defined as the same as thing as <a href="https://wiki.haskell.org/Monoid"><code>mappend</code></a>.</em></p>
<p>See how we defined <code>constField &quot;root&quot; root</code> in two places? We’re talking about two different contexts here: the <em>sitemap</em> context and the <em>post</em> context. While you could have the <code>postCtx</code> be combined with the <code>sitemapCtx</code>, thus giving the <code>pages</code> field access to the <code>root</code> field, you probably want to use <code>root</code> (and perhaps other constants) wherever you work with posts, so adding them to <code>postCtx</code> for use everywhere seems like the right thing to do.</p>
<p>Once you’ve got all this, run the following to build (or rebuild) your <code>docs/sitemap.xml</code> file:</p>
<ol>
<li><code>λ stack build</code></li>
<li><code>λ stack exec site clean</code></li>
<li><code>λ stack exec site build</code></li>
</ol>
<p>Your <code>docs/sitemap.xml</code> should now have all your pages defined in it!</p>
<h2 id="adding-other-pages-and-directories">Adding Other Pages and Directories</h2>
<p>We’ve done some epic traveling in New Zealand and now want to include a bunch of pages we’ve written in the sitemap. Those pages are:</p>
<ul>
<li><code>new-zealand/index.md</code></li>
<li><code>new-zealand/otago/index.md</code></li>
<li><code>new-zealand/otago/dunedin-area.md</code></li>
<li><code>new-zealand/otago/queenstown-area.md</code></li>
<li><code>new-zealand/otago/wanaka-area.md</code></li>
</ul>
<p>First, we make sure that our pages get compiled (we’ll use <code>postCtx</code> for them):</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb7-1" title="1"><span class="ot">main ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb7-2" title="2">main <span class="fu">=</span> hakyllWith config <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb7-3" title="3">    <span class="co">-- ...</span></a>
<a class="sourceLine" id="cb7-4" title="4"></a>
<a class="sourceLine" id="cb7-5" title="5">    match <span class="st">&quot;new-zealand/**&quot;</span> <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb7-6" title="6">        route <span class="fu">$</span> setExtension <span class="st">&quot;html&quot;</span></a>
<a class="sourceLine" id="cb7-7" title="7">        compile <span class="fu">$</span> pandocCompiler</a>
<a class="sourceLine" id="cb7-8" title="8">            <span class="fu">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/post.html&quot;</span>    postCtx</a>
<a class="sourceLine" id="cb7-9" title="9">            <span class="fu">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/default.html&quot;</span> postCtx</a></code></pre></div>
<p>And then we want to make sure we add them to our <code>create</code> function:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb8-1" title="1"><span class="ot">main ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb8-2" title="2">main <span class="fu">=</span> hakyllWith config <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb8-3" title="3">    <span class="co">-- ... match code up here</span></a>
<a class="sourceLine" id="cb8-4" title="4"></a>
<a class="sourceLine" id="cb8-5" title="5">    create [<span class="st">&quot;sitemap.xml&quot;</span>] <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb8-6" title="6">        route idRoute</a>
<a class="sourceLine" id="cb8-7" title="7">        compile <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb8-8" title="8">            posts <span class="ot">&lt;-</span> recentFirst <span class="fu">=&lt;&lt;</span> loadAll <span class="st">&quot;posts/*&quot;</span></a>
<a class="sourceLine" id="cb8-9" title="9">            singlePages <span class="ot">&lt;-</span> loadAll (fromList [<span class="st">&quot;about.rst&quot;</span>, <span class="st">&quot;contact.markdown&quot;</span>])</a>
<a class="sourceLine" id="cb8-10" title="10">            nzPages <span class="ot">&lt;-</span> loadAll <span class="st">&quot;new-zealand/**&quot;</span> <span class="co">-- here</span></a>
<a class="sourceLine" id="cb8-11" title="11">            <span class="kw">let</span> pages <span class="fu">=</span> posts <span class="fu">&lt;&gt;</span> singlePages <span class="fu">&lt;&gt;</span> nzPages <span class="co">-- here</span></a>
<a class="sourceLine" id="cb8-12" title="12">                sitemapCtx <span class="fu">=</span></a>
<a class="sourceLine" id="cb8-13" title="13">                    constField <span class="st">&quot;root&quot;</span> root <span class="fu">&lt;&gt;</span></a>
<a class="sourceLine" id="cb8-14" title="14">                    listField <span class="st">&quot;pages&quot;</span> postCtx (<span class="fu">return</span> pages)</a>
<a class="sourceLine" id="cb8-15" title="15">            makeItem <span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb8-16" title="16">                <span class="fu">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/sitemap.xml&quot;</span> sitemapCtx</a></code></pre></div>
<p>I could not figure out how to mix globs (<code>new-zealand/**</code>) in with individual file paths (included in <code>fromList</code>), so I had to load them separately; if you figure out how, let me know!</p>
<p>Once you’ve got all this, run the following to rebuild your <code>docs/sitemap.xml</code> file:</p>
<ol>
<li><code>λ stack build</code></li>
<li><code>λ stack exec site rebuild</code></li>
</ol>
<h2 id="wrapping-up">Wrapping Up</h2>
<p>In this lesson we learned how to dynamically generate a sitemap.xml file using <a href="https://jaspervdj.be/hakyll">hakyll</a>. Next time, we’ll use these same skills to generate our own RSS and Atom XML feeds.</p>
<p>Next up:</p>
<ul>
<li><em>(wip) Pt. 3 – Generating RSS and Atom XML Feeds</em></li>
<li><em>(wip) Pt. 4 – Customizing Markdown Compiler Options</em></li>
<li><em>(wip) Pt. 5 – Generating Custom Post Filenames From a Title Slug</em></li>
</ul>
<hr />
<p>Thank you for reading! <br /> Robert</p>
    </section>
  </article>
</main>

<footer>
  <section class="subscribe section--padded bg--gray">
  <div class="layout--constrained">
    <h2 class="subscribe__header">Get notified of new posts</h2>

    <form action="//robertwpearce.us13.list-manage.com/subscribe/post?u=2df44e8960266388bff165fa6&amp;id=ee2f2a3737" method="post" name="mc-embedded-subscribe-form" target="_blank" novalidate class="subscribe__form">
      <div id="mce-responses">
        <div class="response" id="mce-error-response" style="display:none"></div>
        <div class="response" id="mce-success-response" style="display:none"></div>
      </div>
      <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_2df44e8960266388bff165fa6_ee2f2a3737" tabindex="-1" value=""></div>
      <div class="subscribe__section">
        <input type="email" value="" id="mce-EMAIL" class="subscribe__input" name="EMAIL" placeholder="you@greatemail.com" aria-label="Email Address">
        <input type="submit" value="Subscribe" name="subscribe" class="subscribe__submit">
      </div>
      <small>Note: I will <em>never</em> give out your email nor spam you. Unsubscribe at any time.</small>
    </form>

    <p>
      <small>(or subscribe to the <a href="/atom.xml" class="subscribe__link">atom</a> or <a class="subscribe__link" href="/rss.xml">rss</a> feeds)</small>
    </p>
  </div>
</section>

</footer>

  </body>
</html>
