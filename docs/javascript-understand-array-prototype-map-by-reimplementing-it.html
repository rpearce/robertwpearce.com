<!DOCTYPE html>
<html lang="en">
  <head>
    <title>JavaScript: Understand Array.prototype.map by Reimplementing It</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Write your own implementation of JavaScript's Array.prototype.map method.">
    <meta name="author" content="Robert Pearce">
    <meta name="keywords" content="javascript, map, Array.prototype.map, reimplement map, js, programming">
    <meta name="google-site-verification" content="QX4bn65yOXBfgnwxlO09yIBc1H8blur-Erx3lmsDVhU">

    <meta property="og:site_name" content="Robert Pearce | Senior Software Developer">
    <meta property="og:title" content="JavaScript: Understand Array.prototype.map by Reimplementing It">
    <meta property="og:url" content="https://robertwpearce.com/javascript-understand-array-prototype-map-by-reimplementing-it.html">
    <meta property="og:description" content="Write your own implementation of JavaScript's Array.prototype.map method.">
    <meta property="og:image" content="https://robertwpearce.com/images/te-mata-hills.jpg">
    
      <meta property="og:type" content="article">
    

    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:site" content="Robert Pearce | Senior Software Developer">
    <meta property="twitter:title" content="JavaScript: Understand Array.prototype.map by Reimplementing It">
    <meta property="twitter:description" content="Write your own implementation of JavaScript's Array.prototype.map method.">
    <meta property="twitter:image" content="https://robertwpearce.com/images/te-mata-hills.jpg">
    <meta property="twitter:creator" content="@RobertWPearce">

    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="canonical" href="https://robertwpearce.com/javascript-understand-array-prototype-map-by-reimplementing-it.html">
    <link rel="stylesheet" href="/css/default.css" />
    
      <link rel="stylesheet" href="/css/article.css" />
    
  </head>
  <body class="light">
    <nav class="nav">
  <div class="layout--constrained" data-nav-wrap>
    <a class="nav__link nav__skip" href="#content">Skip to content</a>
    <a class="nav__link" href="/">Home</a>
    <a class="nav__link" href="mailto:me@robertwpearce.com?subject=Work Inquiry">Hire Me</a>
    <a class="nav__link" href="/atom.xml">atom</a>
    <a class="nav__link" href="/rss.xml">rss</a>
  </div>
</nav>


<main id="content" tabindex="-1">
  <article class="article">
    <header class="article__bg" style="background-image: url('/images/te-mata-hills.jpg')">
      <div class="article__bgHeader">
        <div class="layout--constrained">
          <div class="article__bgTitleWrap">
            <h1 class="article__bgTitle">
              <a href="/javascript-understand-array-prototype-map-by-reimplementing-it.html">JavaScript: Understand Array.prototype.map by Reimplementing It</a>
            </h1>
            <div class="article__bgSubHeader">
              <small class="italic">2020-01-27</small>
              
              
              <small class="article__bgPhotoCred italic">
                [ photo credit <a href="https://www.instagram.com/robertwpearce">robertwpearce</a> ]
              </small>
              
            </div>
          </div>
        </div>
      </div>
    </header>
    <section class="layout--constrained">
      <header class="article__header">
        <h1 class="article__title">
          <a href="/javascript-understand-array-prototype-map-by-reimplementing-it.html">JavaScript: Understand Array.prototype.map by Reimplementing It</a>
        </h1>
        <small class="italic">2020-01-27</small>
        
      </header>
      <p>In this post, we will reimplement JavaScript’s <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map"><code>Array.prototype.map</code></a> function in order to not only understand <code>map</code> better but also to get an idea of how to implement instance methods on <code>Array.prototype</code>.</p>
<p>If you’d prefer to see a ~5 minute recording of what we’ll do in this post, you can watch the video below; otherwise, carry on!</p>
<iframe
  width="560"
  height="315"
  src="https://www.youtube-nocookie.com/embed/n_VTQJARW-o"
  frameborder="0"
  allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
  allowfullscreen
>
</iframe>
<h2 id="initial-example-use-map-to-convert-film-data-to-html-strings">Initial Example: Use <code>map</code> to Convert Film Data to HTML Strings</h2>
<p>First, we will start with some code that will demonstrate <em>one</em> way to take an array of films and output certain HTML strings.</p>
<p>Here is the <code>films</code> array:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1"></a><span class="co">// films :: [Film]</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">const</span> films <span class="op">=</span> [</span>
<span id="cb1-3"><a href="#cb1-3"></a>  <span class="op">{</span> <span class="dt">title</span><span class="op">:</span> <span class="vs">`Pulp Fiction`</span><span class="op">,</span> <span class="dt">score</span><span class="op">:</span> <span class="fl">8.9</span> <span class="op">},</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>  <span class="op">{</span> <span class="dt">title</span><span class="op">:</span> <span class="vs">`Forrest Gump`</span><span class="op">,</span> <span class="dt">score</span><span class="op">:</span> <span class="fl">8.8</span> <span class="op">},</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>  <span class="op">{</span> <span class="dt">title</span><span class="op">:</span> <span class="vs">`Interstellar`</span><span class="op">,</span> <span class="dt">score</span><span class="op">:</span> <span class="fl">8.6</span> <span class="op">},</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>  <span class="op">{</span> <span class="dt">title</span><span class="op">:</span> <span class="vs">`The Prestige`</span><span class="op">,</span> <span class="dt">score</span><span class="op">:</span> <span class="fl">8.5</span> <span class="op">}</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>]</span></code></pre></div>
<p>and here is the output we are going for:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1"></a>[</span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="st">&#39;&lt;li class=&quot;film&quot;&gt;#1 Pulp Fiction: &lt;b&gt;8.9&lt;/b&gt;&lt;/li&gt;&#39;</span><span class="op">,</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="st">&#39;&lt;li class=&quot;film&quot;&gt;#2 Forrest Gump: &lt;b&gt;8.8&lt;/b&gt;&lt;/li&gt;&#39;</span><span class="op">,</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>  <span class="st">&#39;&lt;li class=&quot;film&quot;&gt;#3 Interstellar: &lt;b&gt;8.6&lt;/b&gt;&lt;/li&gt;&#39;</span><span class="op">,</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>  <span class="st">&#39;&lt;li class=&quot;film film--last&quot;&gt;#4 The Prestige: &lt;b&gt;8.5&lt;/b&gt;&lt;/li&gt;&#39;</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>]</span></code></pre></div>
<p>Let’s take a closer look at that output. We can see that the following data needs to be included for each item:</p>
<ul>
<li>position in the list (<code>#3</code>)</li>
<li><code>title</code> (<code>Interstellar</code>)</li>
<li><code>score</code> (<code>8.6</code>)</li>
<li>CSS class of <code>film</code>, unless it is the last item, in which case it gets <code>film</code> and <code>film--last</code></li>
</ul>
<p>Here is the (somewhat unusual) implementation we will use today in order to later test that we successfully reimplemented <code>Array.prototype.map</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">// filmToHtml :: (Film, Index, Films) -&gt; HtmlString</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw">function</span> <span class="at">filmToHtml</span>(film<span class="op">,</span> i<span class="op">,</span> films) <span class="op">{</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="cf">return</span> <span class="kw">this</span>.<span class="at">format</span>(<span class="op">{</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>    <span class="dt">index</span><span class="op">:</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>    <span class="dt">isLast</span><span class="op">:</span> i <span class="op">===</span> <span class="va">films</span>.<span class="at">length</span> <span class="op">-</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>    <span class="dt">score</span><span class="op">:</span> <span class="va">film</span>.<span class="at">score</span><span class="op">,</span></span>
<span id="cb3-7"><a href="#cb3-7"></a>    <span class="dt">title</span><span class="op">:</span> <span class="va">film</span>.<span class="at">title</span><span class="op">,</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>  <span class="op">}</span>)</span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="op">}</span></span>
<span id="cb3-10"><a href="#cb3-10"></a></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="kw">function</span> <span class="at">format</span>(<span class="op">{</span> index<span class="op">,</span> isLast<span class="op">,</span> score<span class="op">,</span> title <span class="op">}</span>) <span class="op">{</span></span>
<span id="cb3-12"><a href="#cb3-12"></a>  <span class="kw">const</span> cn <span class="op">=</span> isLast <span class="op">?</span> <span class="vs">`film film--last`</span> : <span class="vs">`film`</span></span>
<span id="cb3-13"><a href="#cb3-13"></a>  <span class="cf">return</span> <span class="vs">`&lt;li class=&quot;</span><span class="sc">${</span>cn<span class="sc">}</span><span class="vs">&quot;&gt;#</span><span class="sc">${</span>index<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>title<span class="sc">}</span><span class="vs">: &lt;b&gt;</span><span class="sc">${</span>score<span class="sc">}</span><span class="vs">&lt;/b&gt;&lt;/li&gt;`</span></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="op">}</span></span>
<span id="cb3-15"><a href="#cb3-15"></a></span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="va">console</span>.<span class="at">log</span>(</span>
<span id="cb3-17"><a href="#cb3-17"></a>  <span class="va">films</span>.<span class="at">map</span>(filmToHtml<span class="op">,</span> <span class="op">{</span> format <span class="op">}</span>)</span>
<span id="cb3-18"><a href="#cb3-18"></a>)</span>
<span id="cb3-19"><a href="#cb3-19"></a><span class="co">// [</span></span>
<span id="cb3-20"><a href="#cb3-20"></a><span class="co">//   &#39;&lt;li class=&quot;film&quot;&gt;#1 Pulp Fiction: &lt;b&gt;8.9&lt;/b&gt;&lt;/li&gt;&#39;,</span></span>
<span id="cb3-21"><a href="#cb3-21"></a><span class="co">//   &#39;&lt;li class=&quot;film&quot;&gt;#2 Forrest Gump: &lt;b&gt;8.8&lt;/b&gt;&lt;/li&gt;&#39;,</span></span>
<span id="cb3-22"><a href="#cb3-22"></a><span class="co">//   &#39;&lt;li class=&quot;film&quot;&gt;#3 Interstellar: &lt;b&gt;8.6&lt;/b&gt;&lt;/li&gt;&#39;,</span></span>
<span id="cb3-23"><a href="#cb3-23"></a><span class="co">//   &#39;&lt;li class=&quot;film film--last&quot;&gt;#4 The Prestige: &lt;b&gt;8.5&lt;/b&gt;&lt;/li&gt;&#39;</span></span>
<span id="cb3-24"><a href="#cb3-24"></a><span class="co">// ]</span></span></code></pre></div>
<p>This is probably two-to-three times more complicated than it needs to be, but it is a sufficient example for today, for we make use of <em>all</em> of <code>Array.prototype.map</code>’s features.</p>
<p><em>Note: it’s rare to use the second argument to <code>map</code>, but we are doing so today in order to test our implementation.</em></p>
<p>So what is going on here?</p>
<p>The <code>map</code> method iterates over each film and calls <code>filmToHtml</code> with a few arguments:</p>
<ol>
<li>the film object</li>
<li>the film’s index in the array</li>
<li>the <code>films</code> array</li>
</ol>
<p>It also calls the <code>filmToHtml</code> function with an optional <code>this</code> scope. To demonstrate how this works, we pass an object with the method <code>format</code> that <code>filmToHtml</code> then accesses via <code>this.format</code>. The <code>format</code> function then receives some data points and ultimately returns to us the <code>&lt;li&gt;...&lt;/li&gt;</code> HTML for each film.</p>
<h2 id="defining-our-own-map-method-mappy">Defining Our Own <code>map</code> Method, <code>mappy</code></h2>
<p>If we want to write a new method that can be called on our <code>films</code> <code>Array</code> instance, we add it to the <code>Array.prototype</code> like this:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1"></a><span class="va">Array</span>.<span class="va">prototype</span>.<span class="at">mappy</span> <span class="op">=</span> <span class="kw">function</span> <span class="at">mappy</span>(<span class="co">/* ??? */</span>) <span class="op">{</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="co">// our implementation will go here</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="op">}</span></span></code></pre></div>
<p>Since a <em>method</em> is a <em>function</em> defined on an object, we know we are working with a function, but what arguments does our function accept?</p>
<h2 id="what-is-maps-syntax">What Is <code>map</code>’s Syntax?</h2>
<p>As hinted at in a prior section, if we look at <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map#Syntax">MDN’s <code>Array.prototype.map</code> syntax documentation</a>, we can see that we need:</p>
<ol>
<li>a <code>callback</code> that gets called with an optional scope and 3 arguments:
<ol>
<li>the currently iterated item</li>
<li>the current item’s array index (an integer)</li>
<li>the source array that <code>map</code> is called upon</li>
</ol></li>
<li>an optional value to use as <code>this</code> when calling the callback</li>
</ol>
<h2 id="filling-in-the-argument-blanks">Filling In The Argument Blanks</h2>
<p>Let’s give our <code>mappy</code> method a <code>callback</code> parameter, as well as an optional <code>thisArg</code>, which we’ll simply name <code>_this</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1"></a><span class="va">Array</span>.<span class="va">prototype</span>.<span class="at">mappy</span> <span class="op">=</span> <span class="kw">function</span> <span class="at">mappy</span>(callback<span class="op">,</span> _this) <span class="op">{</span></span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="co">// Let&#39;s then have it return our array instance</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="co">// by returning the special `this` keyword.</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>  <span class="cf">return</span> <span class="kw">this</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="op">}</span></span>
<span id="cb5-7"><a href="#cb5-7"></a></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="va">console</span>.<span class="at">log</span>(</span>
<span id="cb5-9"><a href="#cb5-9"></a>  <span class="va">films</span>.<span class="at">map</span>(filmToHtml<span class="op">,</span> <span class="op">{</span> format <span class="op">}</span>)</span>
<span id="cb5-10"><a href="#cb5-10"></a>)</span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="co">// [</span></span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="co">//  { title: `Pulp Fiction`, score: 8.9 },</span></span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="co">//  { title: `Forrest Gump`, score: 8.8 },</span></span>
<span id="cb5-14"><a href="#cb5-14"></a><span class="co">//  { title: `Interstellar`, score: 8.6 },</span></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="co">//  { title: `The Prestige`, score: 8.5 }</span></span>
<span id="cb5-16"><a href="#cb5-16"></a><span class="co">// ]</span></span></code></pre></div>
<p>Since our <code>mappy</code> method, like <code>map</code>, will not alter the original array, we know we’ll need to return a new array, so let’s do that and return the empty array:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1"></a><span class="va">Array</span>.<span class="va">prototype</span>.<span class="at">mappy</span> <span class="op">=</span> <span class="kw">function</span> <span class="at">mappy</span>(callback<span class="op">,</span> _this) <span class="op">{</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="kw">const</span> newArray <span class="op">=</span> []</span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="cf">return</span> newArray</span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="op">}</span></span>
<span id="cb6-5"><a href="#cb6-5"></a></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="va">console</span>.<span class="at">log</span>(</span>
<span id="cb6-7"><a href="#cb6-7"></a>  <span class="va">films</span>.<span class="at">map</span>(filmToHtml<span class="op">,</span> <span class="op">{</span> format <span class="op">}</span>)</span>
<span id="cb6-8"><a href="#cb6-8"></a>)</span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co">// []</span></span></code></pre></div>
<h2 id="the-implementation">The Implementation</h2>
<p>Now that we have a <code>newArray</code>, know we can work with <code>this</code>, have a <code>callback</code> to call and a <code>_this</code> scope to call the <code>callback</code> with, we can populate the <code>newArray</code> with the result of calling the <code>callback</code> function with each item in our array (and with the appropriate arguments, of course):</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1"></a><span class="va">Array</span>.<span class="va">prototype</span>.<span class="at">mappy</span> <span class="op">=</span> <span class="kw">function</span> <span class="at">mappy</span>(callback<span class="op">,</span> _this) <span class="op">{</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="kw">const</span> newArray <span class="op">=</span> []</span>
<span id="cb7-3"><a href="#cb7-3"></a></span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="co">// We&#39;ll use a for loop to iterate over</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>  <span class="co">// each item in our list,</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="kw">this</span>.<span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>    <span class="co">// and then at the end of our `newArray`</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>    <span class="co">// we&#39;ll append the result of calling</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>    <span class="co">// the callback function with the optional</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>    <span class="co">// scope and its 3 arguments:</span></span>
<span id="cb7-11"><a href="#cb7-11"></a>    <span class="co">//   1. the item,</span></span>
<span id="cb7-12"><a href="#cb7-12"></a>    <span class="co">//   2. the current item&#39;s index in the array,</span></span>
<span id="cb7-13"><a href="#cb7-13"></a>    <span class="co">//   3. and lastly the original list, itself.</span></span>
<span id="cb7-14"><a href="#cb7-14"></a>    <span class="va">newArray</span>.<span class="at">push</span>(</span>
<span id="cb7-15"><a href="#cb7-15"></a>      <span class="va">callback</span>.<span class="at">call</span>(_this<span class="op">,</span> <span class="kw">this</span>[i]<span class="op">,</span> i<span class="op">,</span> <span class="kw">this</span>)</span>
<span id="cb7-16"><a href="#cb7-16"></a>    )</span>
<span id="cb7-17"><a href="#cb7-17"></a>  <span class="op">}</span></span>
<span id="cb7-18"><a href="#cb7-18"></a></span>
<span id="cb7-19"><a href="#cb7-19"></a>  <span class="co">// Ultimately, we return the `newArray`</span></span>
<span id="cb7-20"><a href="#cb7-20"></a>  <span class="co">// containing our transformed items.</span></span>
<span id="cb7-21"><a href="#cb7-21"></a>  <span class="cf">return</span> newArray</span>
<span id="cb7-22"><a href="#cb7-22"></a><span class="op">}</span></span>
<span id="cb7-23"><a href="#cb7-23"></a></span>
<span id="cb7-24"><a href="#cb7-24"></a><span class="co">// And when we log out the result,</span></span>
<span id="cb7-25"><a href="#cb7-25"></a><span class="co">// we can see our `filmToHtml` function</span></span>
<span id="cb7-26"><a href="#cb7-26"></a><span class="co">// works as expected.</span></span>
<span id="cb7-27"><a href="#cb7-27"></a><span class="va">console</span>.<span class="at">log</span>(</span>
<span id="cb7-28"><a href="#cb7-28"></a>  <span class="va">films</span>.<span class="at">map</span>(filmToHtml<span class="op">,</span> <span class="op">{</span> format <span class="op">}</span>)</span>
<span id="cb7-29"><a href="#cb7-29"></a>)</span>
<span id="cb7-30"><a href="#cb7-30"></a><span class="co">// [</span></span>
<span id="cb7-31"><a href="#cb7-31"></a><span class="co">//   &#39;&lt;li class=&quot;film&quot;&gt;#1 Pulp Fiction: &lt;b&gt;8.9&lt;/b&gt;&lt;/li&gt;&#39;,</span></span>
<span id="cb7-32"><a href="#cb7-32"></a><span class="co">//   &#39;&lt;li class=&quot;film&quot;&gt;#2 Forrest Gump: &lt;b&gt;8.8&lt;/b&gt;&lt;/li&gt;&#39;,</span></span>
<span id="cb7-33"><a href="#cb7-33"></a><span class="co">//   &#39;&lt;li class=&quot;film&quot;&gt;#3 Interstellar: &lt;b&gt;8.6&lt;/b&gt;&lt;/li&gt;&#39;,</span></span>
<span id="cb7-34"><a href="#cb7-34"></a><span class="co">//   &#39;&lt;li class=&quot;film film--last&quot;&gt;#4 The Prestige: &lt;b&gt;8.5&lt;/b&gt;&lt;/li&gt;&#39;</span></span>
<span id="cb7-35"><a href="#cb7-35"></a><span class="co">// ]</span></span></code></pre></div>
<h2 id="providing-useful-error-messaging">Providing Useful Error Messaging</h2>
<p>What happens if someone tries to use our <code>mappy</code> method but doesn’t provide a callback function? For example:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb8-1"><a href="#cb8-1"></a><span class="va">films</span>.<span class="at">mappy</span>(<span class="dv">123</span>)</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="co">// TypeError: callback.call is not a function</span></span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="va">films</span>.<span class="at">map</span>(<span class="dv">123</span>)</span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="co">// TypeError: 123 is not a function</span></span></code></pre></div>
<p>Unfortunately, our <code>mappy</code> method doesn’t take this scenario into account! But the <code>map</code> method’s error messaging isn’t totally clear at a glance, either, so let’s try a different approach:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb9-1"><a href="#cb9-1"></a><span class="va">Array</span>.<span class="va">prototype</span>.<span class="at">mappy</span> <span class="op">=</span> <span class="kw">function</span> <span class="at">mappy</span>(callback<span class="op">,</span> _this) <span class="op">{</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>  <span class="cf">if</span> (<span class="kw">typeof</span> callback <span class="op">!==</span> <span class="st">&#39;function&#39;</span>) <span class="op">{</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>    <span class="cf">throw</span> <span class="kw">new</span> <span class="at">TypeError</span>(</span>
<span id="cb9-4"><a href="#cb9-4"></a>      <span class="st">&#39;Array.prototype.mappy: &#39;</span> <span class="op">+</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>      <span class="st">&#39;A callback function was expected &#39;</span> <span class="op">+</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>      <span class="st">&#39;as the first argument, but we received &#39;</span> <span class="op">+</span></span>
<span id="cb9-7"><a href="#cb9-7"></a>      <span class="st">&#39;`&#39;</span> <span class="op">+</span> <span class="va">JSON</span>.<span class="at">stringify</span>(callback) <span class="op">+</span> <span class="st">&#39;`&#39;</span></span>
<span id="cb9-8"><a href="#cb9-8"></a>    )</span>
<span id="cb9-9"><a href="#cb9-9"></a>  <span class="op">}</span></span>
<span id="cb9-10"><a href="#cb9-10"></a></span>
<span id="cb9-11"><a href="#cb9-11"></a>  <span class="kw">const</span> newArray <span class="op">=</span> []</span>
<span id="cb9-12"><a href="#cb9-12"></a></span>
<span id="cb9-13"><a href="#cb9-13"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="kw">this</span>.<span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span></span>
<span id="cb9-14"><a href="#cb9-14"></a>    <span class="va">newArray</span>.<span class="at">push</span>(</span>
<span id="cb9-15"><a href="#cb9-15"></a>      <span class="va">callback</span>.<span class="at">call</span>(_this<span class="op">,</span> <span class="kw">this</span>[i]<span class="op">,</span> i<span class="op">,</span> <span class="kw">this</span>)</span>
<span id="cb9-16"><a href="#cb9-16"></a>    )</span>
<span id="cb9-17"><a href="#cb9-17"></a>  <span class="op">}</span></span>
<span id="cb9-18"><a href="#cb9-18"></a></span>
<span id="cb9-19"><a href="#cb9-19"></a>  <span class="cf">return</span> newArray</span>
<span id="cb9-20"><a href="#cb9-20"></a><span class="op">}</span></span>
<span id="cb9-21"><a href="#cb9-21"></a></span>
<span id="cb9-22"><a href="#cb9-22"></a><span class="va">films</span>.<span class="at">mappy</span>(<span class="dv">123</span>)</span>
<span id="cb9-23"><a href="#cb9-23"></a><span class="co">// TypeError:</span></span>
<span id="cb9-24"><a href="#cb9-24"></a><span class="co">//   Array.prototype.mappy: A callback function was</span></span>
<span id="cb9-25"><a href="#cb9-25"></a><span class="co">//   expected as the first argument, but we received `123`</span></span>
<span id="cb9-26"><a href="#cb9-26"></a></span>
<span id="cb9-27"><a href="#cb9-27"></a><span class="va">films</span>.<span class="at">mappy</span>(<span class="op">{</span> <span class="dt">foo</span><span class="op">:</span> <span class="st">&#39;bar&#39;</span> <span class="op">}</span>)</span>
<span id="cb9-28"><a href="#cb9-28"></a><span class="co">// TypeError:</span></span>
<span id="cb9-29"><a href="#cb9-29"></a><span class="co">//   Array.prototype.mappy: A callback function was</span></span>
<span id="cb9-30"><a href="#cb9-30"></a><span class="co">//   expected as the first argument, but we received `{&quot;foo&quot;:&quot;bar&quot;}`</span></span></code></pre></div>
<h2 id="wrapping-up">Wrapping Up</h2>
<p>I hope this post has helped de-mystify how <code>Array.prototype.map</code> conceptually works under the hood! Next time, we’ll look at how to implement <code>map</code> without polluting the <code>Array.prototype</code>, and we might even be able to use <code>map</code> on more data structures than just <code>Array</code>! Stay tuned.</p>
<hr />
<p>Thank you for reading! <br /> Robert</p>
    </section>
  </article>
</main>

<footer>
  <section class="subscribe section--padded">
  <div class="layout--constrained">
    <h2 class="subscribe__header">Get notified of new posts</h2>

    <form action="//robertwpearce.us13.list-manage.com/subscribe/post?u=2df44e8960266388bff165fa6&amp;id=ee2f2a3737" method="post" name="mc-embedded-subscribe-form" target="_blank" novalidate class="subscribe__form">
      <div style="position: absolute; left: -5000px;" aria-hidden="true">
        <input type="text" name="b_2df44e8960266388bff165fa6_ee2f2a3737" tabindex="-1" value="">
      </div>
      <div class="subscribe__section">
        <input type="email" value="" id="mce-EMAIL" class="subscribe__input" name="EMAIL" placeholder="you@greatemail.com" aria-label="Email Address">
        <input type="submit" value="Subscribe" name="subscribe" class="subscribe__submit">
      </div>
      <small>Note: I will <em>never</em> give out your email nor spam you. Unsubscribe at any time.</small>
    </form>
    <p>
      <small>(or subscribe to the <a href="/atom.xml" class="subscribe__link">atom</a> or <a class="subscribe__link" href="/rss.xml">rss</a> feeds)</small>
    </p>
  </div>
</section>

</footer>

    <script async src="/js/dist/index.js"></script>
  </body>
</html>
