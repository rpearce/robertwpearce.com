<!DOCTYPE html><html lang="en"><head><title>Hakyll Pt. 2 â€“ Generating a Sitemap XML File</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Generate a sitemap.xml file for your hakyll site."><meta name="author" content="Robert Pearce"><meta name="keywords" content="hakyll, hakyll sitemap, hakyll tutorial, hakyll blog, hakyll blog tutorial, hakyll static site, static site generator"><meta name="google-site-verification" content="QX4bn65yOXBfgnwxlO09yIBc1H8blur-Erx3lmsDVhU"><meta http-equiv="origin-trial" content="Am4BZ0c7GMyB72dgo/Ny2FfIFscXhYMoN+CVe4jduWh24FvsaCwf7kjZzHzfrJXtIilyZVAEKRxOItGLY7lvkAgAAABSeyJvcmlnaW4iOiJodHRwczovL3JvYmVydHdwZWFyY2UuY29tOjQ0MyIsImZlYXR1cmUiOiJQb3J0YWxzIiwiZXhwaXJ5IjoxNjAzNTQ2NDc3fQ=="><meta property="og:site_name" content="Robert Pearce"><meta property="og:title" content="Hakyll Pt. 2 â€“ Generating a Sitemap XML File"><meta property="og:url" content="https://robertwpearce.com/hakyll-pt-2-generating-a-sitemap-xml-file.html"><meta property="og:description" content="Generate a sitemap.xml file for your hakyll site."><meta property="og:type" content="article"><meta property="twitter:site" content="Robert Pearce"><meta property="twitter:title" content="Hakyll Pt. 2 â€“ Generating a Sitemap XML File"><meta property="twitter:description" content="Generate a sitemap.xml file for your hakyll site."><meta property="twitter:creator" content="@RobertWPearce"><link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ðŸ’¾</text></svg>"><link rel="canonical" href="https://robertwpearce.com/hakyll-pt-2-generating-a-sitemap-xml-file.html"><link rel="alternate" href="./atom.xml" title="Robert Pearce's blog" type="application/atom+xml"><link rel="alternate" href="./rss.xml" title="Robert Pearce's blog" type="application/rss+xml"><link rel="stylesheet" href="./css/base.css"><link rel="stylesheet" href="./css/t-clean.css"><link rel="stylesheet" href="./css/t-clean-note.css"><link rel="stylesheet" href="./css/t-code-dracula.css"><link rel="prefetch" href="./css/t-clean-note.css"></head><body data-theme="clean-night"><script> (() => { window.site = { prefFont: localStorage.getItem('prefFont') || 'monospace', setFont: (family) => { localStorage.setItem('prefFont', family); const rootStyle = document.querySelector(':root').style; rootStyle.setProperty('--type-family-body', family+',monospace'); /* Remove when https://github.com/googlefonts/spacemono/pull/2 is resolved */ if (family === 'Liga Space Mono') { rootStyle.setProperty('font-feature-settings', '"liga" 0'); } else { rootStyle.removeProperty('font-feature-settings'); } return window.site._fetchFont(family); }, prefTheme: localStorage.getItem('prefTheme') || (matchMedia('(prefers-color-scheme: dark)').matches ? 'clean-night' : 'clean-day'), setTheme: (name) => { const rootStyle = document.querySelector(':root').style; if (name === 'clean-night') { rootStyle.removeProperty('color-scheme'); } else { rootStyle.setProperty('color-scheme', 'light'); } document.body.setAttribute('data-theme', name); localStorage.setItem('prefTheme', name); }, _fetchFont: (family) => { if (family === 'monospace') { return Promise.resolve(); } const familyNoSpaces = family.replaceAll(' ', ''); const fontz = [ new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-Regular.woff2") format("woff2")', { display: 'swap', weight: 400 }), new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-Bold.woff2") format("woff2")', { display: 'swap', weight: 700 }), ]; if (family !== 'Fira Code') { fontz.push( new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-Italic.woff2") format("woff2")', { display: 'swap', style: 'italic', weight: 400 }), new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-BoldItalic.woff2") format("woff2")', { display: 'swap', style: 'italic', weight: 700 }) ); } for (const f of fontz) { document.fonts.add(f); } return Promise.allSettled(fontz).then(results => { results.forEach((res, i) => { if (res.status === 'rejected') { console.error('site failed to load font: ' + fontz[i]?.family ?? 'unknown'); } }); }); } }; window.site.setTheme(window.site.prefTheme); window.site.setFont(window.site.prefFont); })(); </script><header><nav><div class="nav-skip"><a href="#content">Skip to content</a></div><a aria-label="Home" class="nav-home" href="./">~</a><span>/</span></nav><div class="header-extra"><a href="./atom.xml">RSS</a><span aria-hidden="true">&compfn;</span><noscript>(requires JS &rarr;)</noscript><label for="select-theme">Theme</label><select data-select-theme id="select-theme"><option value="clean-day">Clean (Day)</option><option value="clean-night">Clean (Night)</option></select><span aria-hidden="true">&compfn;</span><label for="select-font">Font</label><select data-select-font id="select-font"><option value="monospace">monospace</option><option value="Liga Space Mono">Space Mono</option><option value="Victor Mono">Victor Mono</option><option value="Fira Code">Fira Code</option><option value="JetBrains Mono">JetBrains Mono</option></select></div></header><main id="content"><header data-area="heading"><h1>Hakyll Pt. 2 â€“ Generating a Sitemap XML File</h1></header><section data-area="meta"><h2>Info</h2><table data-type="cols-y"><tbody><tr><th>Summary</th><td>Generate a sitemap.xml file for your hakyll site.</td></tr><tr><th>Shared</th><td>2018-11-17</td></tr><tr><th>Revised</th><td>2023-02-11 @ 16:00 UTC</td></tr></tbody></table></section><section data-area="note"><p>This is part 2 of a multipart series where we will look at getting a website / blog set up with <a href="https://jaspervdj.be/hakyll">hakyll</a> and customized a fair bit.</p><ul><li><a href="/hakyll-pt-1-setup-initial-customization.html">Pt. 1 â€“ Setup &amp; Initial Customization</a></li><li>Pt. 2 â€“ Generating a Sitemap XML File</li><li><a href="/hakyll-pt-3-generating-rss-and-atom-xml-feeds.html">Pt. 3 â€“ Generating RSS and Atom XML Feeds</a></li><li><a href="/hakyll-pt-4-copying-static-files-for-your-build.html">Pt. 4 â€“ Copying Static Files For Your Build</a></li><li><a href="/hakyll-pt-5-generating-custom-post-filenames-from-a-title-slug.html">Pt. 5 â€“ Generating Custom Post Filenames From a Title Slug</a></li><li><a href="/hakyll-pt-6-pure-builds-with-nix.html">Pt. 6 â€“ Pure Builds With Nix</a></li><li><a href="/the-hakyll-nix-template-tutorial.html">The hakyll-nix-template Tutorial</a></li></ul><h2 id="overview">Overview</h2><ol><li><a href="#adding-a-sitemap-template">Adding a Sitemap Template</a></li><li><a href="#generating-the-sitemap-xml-file">Generating the Sitemap XML File</a></li><li><a href="#adding-other-pages-and-directories">Adding Other Pages and Directories</a></li></ol><h2 id="adding-a-sitemap-template">Adding a Sitemap Template</h2><p>A sitemap.xml template, just like <a href="/hakyll-pt-1-setup-initial-customization.html#working-with-templates">the templates in the last post</a>, receives context fields to work with (variables, essentially), and outputs the result of applying said context to the template. Here is what our sitemap template will look like today in our projectâ€™s <code>templates/sitemap.xml</code>:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nt">&lt;urlset</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-na">xmlns=</span><span class="pl-s">"http://www.sitemaps.org/schemas/sitemap/0.9"</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-na">xmlns:news=</span><span class="pl-s">"http://www.google.com/schemas/sitemap-news/0.9"</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-na">xmlns:xhtml=</span><span class="pl-s">"http://www.w3.org/1999/xhtml"</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-na">xmlns:mobile=</span><span class="pl-s">"http://www.google.com/schemas/sitemap-mobile/1.0"</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-na">xmlns:image=</span><span class="pl-s">"http://www.google.com/schemas/sitemap-image/1.1"</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-na">xmlns:video=</span><span class="pl-s">"http://www.google.com/schemas/sitemap-video/1.1"</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nt">&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nt">&lt;url&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nt">&lt;loc&gt;</span>$root$<span class="pl-nt">&lt;/loc&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nt">&lt;changefreq&gt;</span>daily<span class="pl-nt">&lt;/changefreq&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nt">&lt;priority&gt;</span>1.0<span class="pl-nt">&lt;/priority&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nt">&lt;/url&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">$for(pages)$
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nt">&lt;url&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nt">&lt;loc&gt;</span>$root$$url$<span class="pl-nt">&lt;/loc&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nt">&lt;lastmod&gt;</span>$if(updated)$$updated$$else$$if(date)$$date$$endif$$endif$<span class="pl-nt">&lt;/lastmod&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nt">&lt;changefreq&gt;</span>weekly<span class="pl-nt">&lt;/changefreq&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nt">&lt;priority&gt;</span>0.8<span class="pl-nt">&lt;/priority&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nt">&lt;/url&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">$endfor$
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nt">&lt;/urlset&gt;</span></span></span></code></pre><p>Apart from the normal sitemap boilerplate, you can see <code>root</code>, <code>pages</code>, <code>url</code>, <code>date</code> and <code>updated</code> context fields. While <code>date</code> and <code>updated</code> would come from your metadata fields defined for a post, and the <code>url</code> is built from hakyllâ€™s <a href="https://github.com/jaspervdj/hakyll/blob/c85198d8cb6ce055c788e287c7f2470eac0aad36/lib/Hakyll/Web/Template/Context.hs#L192"><code>defaultContext</code></a>, the <code>root</code> and <code>pages</code> fields are custom defined in what will be our very own <code>sitemapCtx</code> context. In the next section, weâ€™ll use this template to generate our sitemap.xml file.</p><h2 id="generating-the-sitemap-xml-file">Generating the Sitemap XML File</h2><p>If you <a href="https://robertwpearce.com/hakyll-pt-1-setup-initial-customization.html#installation-setup">create a hakyll project from scratch</a>, you will start out with a few files that we can add to our sitemap: * <code>index.html</code> * <code>about.rst</code> * <code>contact.markdown</code> * <code>posts/2015-08-12-spqr.html</code> * <code>posts/2015-10-07-rosa-rosa-rosam.html</code> * <code>posts/2015-11-28-carpe-diem.html</code> * <code>posts/2015-12-07-tu-quoque.html</code></p><p>You should note that your <code>site.hs</code> file also has the following:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nf">main</span> <span class="pl-ow">::</span> <span class="pl-kt">IO</span> <span class="pl-nb">()</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nf">main</span> <span class="pl-ow">=</span> <span class="pl-n">hakyllWith</span> <span class="pl-n">config</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-c1">-- ...</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">match</span> <span class="pl-p">(</span><span class="pl-n">fromList</span> <span class="pl-p">[</span><span class="pl-s">"about.rst"</span><span class="pl-p">,</span> <span class="pl-s">"contact.markdown"</span><span class="pl-p">])</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-n">route</span>   <span class="pl-o">$</span> <span class="pl-n">setExtension</span> <span class="pl-s">"html"</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-n">compile</span> <span class="pl-o">$</span> <span class="pl-n">pandocCompiler</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-o">&gt;&gt;=</span> <span class="pl-n">loadAndApplyTemplate</span> <span class="pl-s">"templates/default.html"</span> <span class="pl-n">defaultContext</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">match</span> <span class="pl-s">"posts/*"</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-n">route</span> <span class="pl-o">$</span> <span class="pl-n">setExtension</span> <span class="pl-s">"html"</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-n">compile</span> <span class="pl-o">$</span> <span class="pl-n">pandocCompiler</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-o">&gt;&gt;=</span> <span class="pl-n">loadAndApplyTemplate</span> <span class="pl-s">"templates/post.html"</span>    <span class="pl-n">postCtx</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-o">&gt;&gt;=</span> <span class="pl-n">loadAndApplyTemplate</span> <span class="pl-s">"templates/default.html"</span> <span class="pl-n">postCtx</span></span></span></code></pre><p>Itâ€™s important that you understand that any files you want to be loaded and sent to <code>templates/sitemap.xml</code> must first be <code>match</code>ed and <code>compile</code>d <em>before</em> the sitemap can be built. If you donâ€™t do this, youâ€™ll pull your hair out wondering why the file (or folder) youâ€™re trying to include in the sitemap never shows up.</p><p>Now, there is something that we are going to emulate to make this sitemap a reality (this should already be in <code>site.hs</code>):</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nf">main</span> <span class="pl-ow">::</span> <span class="pl-kt">IO</span> <span class="pl-nb">()</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nf">main</span> <span class="pl-ow">=</span> <span class="pl-n">hakyllWith</span> <span class="pl-n">config</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-c1">-- ...</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">create</span> <span class="pl-p">[</span><span class="pl-s">"archive.html"</span><span class="pl-p">]</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-n">route</span> <span class="pl-n">idRoute</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-n">compile</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-n">posts</span> <span class="pl-ow">&lt;-</span> <span class="pl-n">recentFirst</span> <span class="pl-o">=&lt;&lt;</span> <span class="pl-n">loadAll</span> <span class="pl-s">"posts/*"</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-kr">let</span> <span class="pl-n">archiveCtx</span> <span class="pl-ow">=</span>
</span></span><span class="pl-line"><span class="pl-cl">                    <span class="pl-n">listField</span> <span class="pl-s">"posts"</span> <span class="pl-n">postCtx</span> <span class="pl-p">(</span><span class="pl-n">return</span> <span class="pl-n">posts</span><span class="pl-p">)</span> <span class="pl-p">`</span><span class="pl-n">mappend</span><span class="pl-p">`</span>
</span></span><span class="pl-line"><span class="pl-cl">                    <span class="pl-n">constField</span> <span class="pl-s">"title"</span> <span class="pl-s">"Archives"</span>            <span class="pl-p">`</span><span class="pl-n">mappend</span><span class="pl-p">`</span>
</span></span><span class="pl-line"><span class="pl-cl">                    <span class="pl-n">defaultContext</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-n">makeItem</span> <span class="pl-s">""</span>
</span></span><span class="pl-line"><span class="pl-cl">                <span class="pl-o">&gt;&gt;=</span> <span class="pl-n">loadAndApplyTemplate</span> <span class="pl-s">"templates/archive.html"</span> <span class="pl-n">archiveCtx</span>
</span></span><span class="pl-line"><span class="pl-cl">                <span class="pl-o">&gt;&gt;=</span> <span class="pl-n">loadAndApplyTemplate</span> <span class="pl-s">"templates/default.html"</span> <span class="pl-n">archiveCtx</span></span></span></code></pre><p>Reading the code above, this essentially says 1. hereâ€™s a file we want to create that <em>does not yet exist</em> (how <code>create</code> differs from <code>match</code>) 1. when you create the route, keep the filename (what <code>idRoute</code> does) 1. when you compile, load all the posts, specify what the context to send to each template will be, then make the item (the <code>""</code> is an identifierâ€¦ see <a href="https://github.com/jaspervdj/hakyll/blob/1abdeee743d65d96c6f469213ca6e7ea823340a7/lib/Hakyll/Core/Compiler.hs#L65-L68">the source</a> for more), then pass the context to the archive template and pass that on to the default template, ultimately building up a full webpage from the inside-out</p><p>Letâ€™s change this 3-step rule to suit our needs before we wrangle the code. We want our rules to say: 1. hereâ€™s a file we want to create that <em>does not yet exist</em> (<code>sitemap.xml</code>) 1. when you create the route, keep the filename (what <code>idRoute</code> does) 1. when you compile, load all the posts, load all the other pages, specify what the context to send to each template will be, then make the item, then pass the context to the sitemap template, ultimately building up an XML file</p><p>This is almost the same! Letâ€™s write it:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nf">main</span> <span class="pl-ow">::</span> <span class="pl-kt">IO</span> <span class="pl-nb">()</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nf">main</span> <span class="pl-ow">=</span> <span class="pl-n">hakyllWith</span> <span class="pl-n">config</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-c1">-- ...</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">create</span> <span class="pl-p">[</span><span class="pl-s">"sitemap.xml"</span><span class="pl-p">]</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-n">route</span> <span class="pl-n">idRoute</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-n">compile</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-c1">-- load and sort the posts</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-n">posts</span> <span class="pl-ow">&lt;-</span> <span class="pl-n">recentFirst</span> <span class="pl-o">=&lt;&lt;</span> <span class="pl-n">loadAll</span> <span class="pl-s">"posts/*"</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-c1">-- load individual pages from a list (globs DO NOT work here)</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-n">singlePages</span> <span class="pl-ow">&lt;-</span> <span class="pl-n">loadAll</span> <span class="pl-p">(</span><span class="pl-n">fromList</span> <span class="pl-p">[</span><span class="pl-s">"about.rst"</span><span class="pl-p">,</span> <span class="pl-s">"contact.markdown"</span><span class="pl-p">])</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">                           <span class="pl-c1">-- mappend the posts and singlePages together</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-kr">let</span> <span class="pl-n">pages</span> <span class="pl-ow">=</span> <span class="pl-n">posts</span> <span class="pl-o">&lt;&gt;</span> <span class="pl-n">singlePages</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">                           <span class="pl-c1">-- create the `pages` field with the postCtx</span>
</span></span><span class="pl-line"><span class="pl-cl">                           <span class="pl-c1">-- and return the `pages` value for it</span>
</span></span><span class="pl-line"><span class="pl-cl">                <span class="pl-n">sitemapCtx</span> <span class="pl-ow">=</span> <span class="pl-n">listField</span> <span class="pl-s">"pages"</span> <span class="pl-n">postCtx</span> <span class="pl-p">(</span><span class="pl-n">return</span> <span class="pl-n">pages</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-c1">-- make the item and apply our sitemap template</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-n">makeItem</span> <span class="pl-s">""</span>
</span></span><span class="pl-line"><span class="pl-cl">                <span class="pl-o">&gt;&gt;=</span> <span class="pl-n">loadAndApplyTemplate</span> <span class="pl-s">"templates/sitemap.xml"</span> <span class="pl-n">sitemapCtx</span></span></span></code></pre><p>This is starting to look good! But whatâ€™s wrong here? Remember the <code>root</code> context bits? Weâ€™re going to need to define what that is, and the best way that Iâ€™ve found right now is simply as a <code>String</code>; if you want to do something fancy with configuration or reading it in dynamically, then go nuts.</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nf">root</span> <span class="pl-ow">::</span> <span class="pl-kt">String</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nf">root</span> <span class="pl-ow">=</span> <span class="pl-s">"https://ourblog.com"</span></span></span></code></pre><p>With that defined, we can add it to our contexts:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nf">main</span> <span class="pl-ow">::</span> <span class="pl-kt">IO</span> <span class="pl-nb">()</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nf">main</span> <span class="pl-ow">=</span> <span class="pl-n">hakyllWith</span> <span class="pl-n">config</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-c1">-- ...</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">create</span> <span class="pl-p">[</span><span class="pl-s">"sitemap.xml"</span><span class="pl-p">]</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-n">route</span> <span class="pl-n">idRoute</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-n">compile</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-n">posts</span> <span class="pl-ow">&lt;-</span> <span class="pl-n">recentFirst</span> <span class="pl-o">=&lt;&lt;</span> <span class="pl-n">loadAll</span> <span class="pl-s">"posts/*"</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-n">singlePages</span> <span class="pl-ow">&lt;-</span> <span class="pl-n">loadAll</span> <span class="pl-p">(</span><span class="pl-n">fromList</span> <span class="pl-p">[</span><span class="pl-s">"about.rst"</span><span class="pl-p">,</span> <span class="pl-s">"contact.markdown"</span><span class="pl-p">])</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-kr">let</span> <span class="pl-n">pages</span> <span class="pl-ow">=</span> <span class="pl-n">posts</span> <span class="pl-o">&lt;&gt;</span> <span class="pl-n">singlePages</span>
</span></span><span class="pl-line"><span class="pl-cl">                <span class="pl-n">sitemapCtx</span> <span class="pl-ow">=</span>
</span></span><span class="pl-line"><span class="pl-cl">                    <span class="pl-n">constField</span> <span class="pl-s">"root"</span> <span class="pl-n">root</span> <span class="pl-o">&lt;&gt;</span> <span class="pl-c1">-- here</span>
</span></span><span class="pl-line"><span class="pl-cl">                    <span class="pl-n">listField</span> <span class="pl-s">"pages"</span> <span class="pl-n">postCtx</span> <span class="pl-p">(</span><span class="pl-n">return</span> <span class="pl-n">pages</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-n">makeItem</span> <span class="pl-s">""</span>
</span></span><span class="pl-line"><span class="pl-cl">                <span class="pl-o">&gt;&gt;=</span> <span class="pl-n">loadAndApplyTemplate</span> <span class="pl-s">"templates/sitemap.xml"</span> <span class="pl-n">sitemapCtx</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">-- ...</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nf">postCtx</span> <span class="pl-ow">::</span> <span class="pl-kt">Context</span> <span class="pl-kt">String</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nf">postCtx</span> <span class="pl-ow">=</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">constField</span> <span class="pl-s">"root"</span> <span class="pl-n">root</span>      <span class="pl-o">&lt;&gt;</span> <span class="pl-c1">-- here</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">dateField</span> <span class="pl-s">"date"</span> <span class="pl-s">"%Y-%m-%d"</span> <span class="pl-o">&lt;&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">defaultContext</span></span></span></code></pre><p><em>Hint: if the <code>&lt;&gt;</code> is throwing you for a loop, itâ€™s defined as the same as thing as <a href="https://wiki.haskell.org/Monoid"><code>mappend</code></a>.</em></p><p>See how we defined <code>constField "root" root</code> in two places? Weâ€™re talking about two different contexts here: the <em>sitemap</em> context and the <em>post</em> context. While you could have the <code>postCtx</code> be combined with the <code>sitemapCtx</code>, thus giving the <code>pages</code> field access to the <code>root</code> field, you probably want to use <code>root</code> (and perhaps other constants) wherever you work with posts, so adding them to <code>postCtx</code> for use everywhere seems like the right thing to do.</p><p>Once youâ€™ve got all this, run the following to build (or rebuild) your <code>docs/sitemap.xml</code> file: 1. <code>Î» stack build</code> 1. <code>Î» stack exec site clean</code> 1. <code>Î» stack exec site build</code></p><p>Your <code>docs/sitemap.xml</code> should now have all your pages defined in it!</p><h2 id="adding-other-pages-and-directories">Adding Other Pages and Directories</h2><p>Weâ€™ve done some epic traveling in New Zealand and now want to include a bunch of pages weâ€™ve written in the sitemap. Those pages are: * <code>new-zealand/index.md</code> * <code>new-zealand/otago/index.md</code> * <code>new-zealand/otago/dunedin-area.md</code> * <code>new-zealand/otago/queenstown-area.md</code> * <code>new-zealand/otago/wanaka-area.md</code></p><p>First, we make sure that our pages get compiled (weâ€™ll use <code>postCtx</code> for them):</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nf">main</span> <span class="pl-ow">::</span> <span class="pl-kt">IO</span> <span class="pl-nb">()</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nf">main</span> <span class="pl-ow">=</span> <span class="pl-n">hakyllWith</span> <span class="pl-n">config</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-c1">-- ...</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">match</span> <span class="pl-s">"new-zealand/**"</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-n">route</span> <span class="pl-o">$</span> <span class="pl-n">setExtension</span> <span class="pl-s">"html"</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-n">compile</span> <span class="pl-o">$</span> <span class="pl-n">pandocCompiler</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-o">&gt;&gt;=</span> <span class="pl-n">loadAndApplyTemplate</span> <span class="pl-s">"templates/post.html"</span>    <span class="pl-n">postCtx</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-o">&gt;&gt;=</span> <span class="pl-n">loadAndApplyTemplate</span> <span class="pl-s">"templates/default.html"</span> <span class="pl-n">postCtx</span></span></span></code></pre><p>And then we want to make sure we add them to our <code>create</code> function:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nf">main</span> <span class="pl-ow">::</span> <span class="pl-kt">IO</span> <span class="pl-nb">()</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nf">main</span> <span class="pl-ow">=</span> <span class="pl-n">hakyllWith</span> <span class="pl-n">config</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-c1">-- ... match code up here</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">create</span> <span class="pl-p">[</span><span class="pl-s">"sitemap.xml"</span><span class="pl-p">]</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-n">route</span> <span class="pl-n">idRoute</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-n">compile</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-n">posts</span> <span class="pl-ow">&lt;-</span> <span class="pl-n">recentFirst</span> <span class="pl-o">=&lt;&lt;</span> <span class="pl-n">loadAll</span> <span class="pl-s">"posts/*"</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-n">singlePages</span> <span class="pl-ow">&lt;-</span> <span class="pl-n">loadAll</span> <span class="pl-p">(</span><span class="pl-n">fromList</span> <span class="pl-p">[</span><span class="pl-s">"about.rst"</span><span class="pl-p">,</span> <span class="pl-s">"contact.markdown"</span><span class="pl-p">])</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-n">nzPages</span> <span class="pl-ow">&lt;-</span> <span class="pl-n">loadAll</span> <span class="pl-s">"new-zealand/**"</span> <span class="pl-c1">-- here</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-kr">let</span> <span class="pl-n">pages</span> <span class="pl-ow">=</span> <span class="pl-n">posts</span> <span class="pl-o">&lt;&gt;</span> <span class="pl-n">singlePages</span> <span class="pl-o">&lt;&gt;</span> <span class="pl-n">nzPages</span> <span class="pl-c1">-- here</span>
</span></span><span class="pl-line"><span class="pl-cl">                <span class="pl-n">sitemapCtx</span> <span class="pl-ow">=</span>
</span></span><span class="pl-line"><span class="pl-cl">                    <span class="pl-n">constField</span> <span class="pl-s">"root"</span> <span class="pl-n">root</span> <span class="pl-o">&lt;&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">                    <span class="pl-n">listField</span> <span class="pl-s">"pages"</span> <span class="pl-n">postCtx</span> <span class="pl-p">(</span><span class="pl-n">return</span> <span class="pl-n">pages</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-n">makeItem</span> <span class="pl-s">""</span>
</span></span><span class="pl-line"><span class="pl-cl">                <span class="pl-o">&gt;&gt;=</span> <span class="pl-n">loadAndApplyTemplate</span> <span class="pl-s">"templates/sitemap.xml"</span> <span class="pl-n">sitemapCtx</span></span></span></code></pre><p>I could not figure out how to mix globs (<code>new-zealand/**</code>) in with individual file paths (included in <code>fromList</code>), so I had to load them separately; if you figure out how, let me know!</p><p>Once youâ€™ve got all this, run the following to rebuild your <code>docs/sitemap.xml</code> file: 1. <code>Î» stack build</code> 1. <code>Î» stack exec site rebuild</code></p><h2 id="wrapping-up">Wrapping Up</h2><p>In this lesson we learned how to dynamically generate a sitemap.xml file using <a href="https://jaspervdj.be/hakyll">hakyll</a>. Next time, weâ€™ll use these same skills to generate our own RSS and Atom XML feeds.</p><p>Next up: * <a href="/hakyll-pt-3-generating-rss-and-atom-xml-feeds.html">Pt. 3 â€“ Generating RSS and Atom XML Feeds</a> * <a href="/hakyll-pt-4-copying-static-files-for-your-build.html">Pt. 4 â€“ Copying Static Files For Your Build</a> * <a href="/hakyll-pt-5-generating-custom-post-filenames-from-a-title-slug.html">Pt. 5 â€“ Generating Custom Post Filenames From a Title Slug</a> * <em>(wip) Pt. 6 â€“ Customizing Markdown Compiler Options</em></p><hr /><p>Thank you for reading! <br /> Robert</p></section></main><footer><span aria-hidden="true" class="heart">â™¥</span><span aria-hidden="true">&rarr;</span><a href="https://github.com/sponsors/rpearce/">Sponsor my work</a><span aria-hidden="true">&larr;</span><span aria-hidden="true" class="heart">â™¥</span></footer><script async> (() => { const themeEl = document.querySelector('[data-select-theme]'); if (themeEl) { themeEl.querySelector('[value="'+window.site.prefTheme+'"]').selected = 'selected'; themeEl.addEventListener('change', e => { window.site.setTheme(e.target.value); }); } const fontEl = document.querySelector('[data-select-font]'); if (fontEl) { fontEl.querySelector('[value="'+window.site.prefFont+'"]').selected = 'selected'; fontEl.addEventListener('change', e => { window.site.setFont(e.target.value); }) } })(); </script></body></html>