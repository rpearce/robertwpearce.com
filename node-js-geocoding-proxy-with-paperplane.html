<!DOCTYPE html><html lang="en"><head><title>Node.js Geocoding Proxy with Paperplane</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Tutorial on creating a location geocoding proxy server in Node.js with Paperplane"><meta name="author" content="Robert Pearce"><meta name="keywords" content="node geocoding, nodejs geocoding, nodejs proxy, nodejs geocoding proxy, nodejs paperplane"><meta name="google-site-verification" content="QX4bn65yOXBfgnwxlO09yIBc1H8blur-Erx3lmsDVhU"><meta http-equiv="origin-trial" content="Am4BZ0c7GMyB72dgo/Ny2FfIFscXhYMoN+CVe4jduWh24FvsaCwf7kjZzHzfrJXtIilyZVAEKRxOItGLY7lvkAgAAABSeyJvcmlnaW4iOiJodHRwczovL3JvYmVydHdwZWFyY2UuY29tOjQ0MyIsImZlYXR1cmUiOiJQb3J0YWxzIiwiZXhwaXJ5IjoxNjAzNTQ2NDc3fQ=="><meta property="og:site_name" content="Robert Pearce"><meta property="og:title" content="Node.js Geocoding Proxy with Paperplane"><meta property="og:url" content="https://robertwpearce.com/node-js-geocoding-proxy-with-paperplane.html"><meta property="og:description" content="Tutorial on creating a location geocoding proxy server in Node.js with Paperplane"><meta property="og:type" content="article"><meta property="twitter:site" content="Robert Pearce"><meta property="twitter:title" content="Node.js Geocoding Proxy with Paperplane"><meta property="twitter:description" content="Tutorial on creating a location geocoding proxy server in Node.js with Paperplane"><meta property="twitter:creator" content="@RobertWPearce"><link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üíæ</text></svg>"><link rel="canonical" href="https://robertwpearce.com/node-js-geocoding-proxy-with-paperplane.html"><link rel="alternate" href="./atom.xml" title="Robert Pearce's blog" type="application/atom+xml"><link rel="alternate" href="./rss.xml" title="Robert Pearce's blog" type="application/rss+xml"><link rel="stylesheet" href="./css/base.css"><link rel="stylesheet" href="./css/t-clean.css"><link rel="stylesheet" href="./css/t-clean-note.css"><link rel="stylesheet" href="./css/t-code-dracula.css"><link rel="prefetch" href="./css/t-clean-note.css"></head><body data-theme="clean-night"><script> (() => { window.site = { prefFont: localStorage.getItem('prefFont') || 'monospace', setFont: (family) => { localStorage.setItem('prefFont', family); const rootStyle = document.querySelector(':root').style; rootStyle.setProperty('--type-family-body', family+',monospace'); /* Remove when https://github.com/googlefonts/spacemono/pull/2 is resolved */ if (family === 'Liga Space Mono') { rootStyle.setProperty('font-feature-settings', '"liga" 0'); } else { rootStyle.removeProperty('font-feature-settings'); } return window.site._fetchFont(family); }, prefTheme: localStorage.getItem('prefTheme') || (matchMedia('(prefers-color-scheme: dark)').matches ? 'clean-night' : 'clean-day'), setTheme: (name) => { const rootStyle = document.querySelector(':root').style; if (name === 'clean-night') { rootStyle.removeProperty('color-scheme'); } else { rootStyle.setProperty('color-scheme', 'light'); } document.body.setAttribute('data-theme', name); localStorage.setItem('prefTheme', name); }, _fetchFont: (family) => { if (family === 'monospace') { return Promise.resolve(); } const familyNoSpaces = family.replaceAll(' ', ''); const fontz = [ new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-Regular.woff2") format("woff2")', { display: 'swap', weight: 400 }), new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-Bold.woff2") format("woff2")', { display: 'swap', weight: 700 }), ]; if (family !== 'Fira Code') { fontz.push( new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-Italic.woff2") format("woff2")', { display: 'swap', style: 'italic', weight: 400 }), new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-BoldItalic.woff2") format("woff2")', { display: 'swap', style: 'italic', weight: 700 }) ); } for (const f of fontz) { document.fonts.add(f); } return Promise.allSettled(fontz).then(results => { results.forEach((res, i) => { if (res.status === 'rejected') { console.error('site failed to load font: ' + fontz[i]?.family ?? 'unknown'); } }); }); } }; window.site.setTheme(window.site.prefTheme); window.site.setFont(window.site.prefFont); })(); </script><header><nav><div class="nav-skip"><a href="#content">Skip to content</a></div><a aria-label="Home" class="nav-home" href="./">~</a><span>/</span></nav><div class="header-extra"><a href="./atom.xml">RSS</a><span aria-hidden="true">&compfn;</span><noscript>(requires JS &rarr;)</noscript><label for="select-theme">Theme</label><select data-select-theme id="select-theme"><option value="clean-day">Clean (Day)</option><option value="clean-night">Clean (Night)</option></select><span aria-hidden="true">&compfn;</span><label for="select-font">Font</label><select data-select-font id="select-font"><option value="monospace">monospace</option><option value="Liga Space Mono">Space Mono</option><option value="Victor Mono">Victor Mono</option><option value="Fira Code">Fira Code</option><option value="JetBrains Mono">JetBrains Mono</option></select></div></header><main id="content"><header data-area="heading"><h1>Node.js Geocoding Proxy with Paperplane</h1></header><section data-area="meta"><h2>Info</h2><table data-type="cols-y"><tbody><tr><th>Summary</th><td>Tutorial on creating a location geocoding proxy server in Node.js with Paperplane</td></tr><tr><th>Shared</th><td>2017-06-22</td></tr><tr><th>Revised</th><td>2017-07-29 @ 00:00 UTC</td></tr></tbody></table></section><section data-area="note"><p><em>tl;dr =&gt; use a proxy server when private API keys are involved; <a href="https://github.com/articulate/paperplane">paperplane</a> is a great functional server framework.</em></p><p>Converting addresses, cities and other locations to latitude and logitude and back again is something that is expected in the software application world today. Whether someone is asking for directions, <a href="http://www.brewpublik.com">plotting optimal beer delivery routes</a> or tagging a photo of their cronut in a local cafe, managing location data is an important skillset for developers to have. Numerous services, typically in the form of <a href="https://en.wikipedia.org/wiki/Application_programming_interface">application programming interfaces</a> (APIs), exist to provide folks with ways of accessing this data. Today we‚Äôll be using the <a href="https://developers.google.com/maps/documentation/geocoding/start">Google Maps Geocoding API</a> to complete the task of acquiring the geo-data for any place name; however, we will be creating a <a href="https://nodejs.org">Node.js</a> server as a proxy (a go-between) for our request instead of embedding this request in a browser.</p><h2 id="why-a-proxy-server">Why A Proxy Server?</h2><p>If you are granted an API key for a service that is private and mapped to you, it is a good idea to keep it that way. If you commit this API key to source control or expose it via your frontend code, then someone could take your key and pretend to be you. In order to avoid this, it is recommended that you keep such keys hidden, for example, as environment variables set on a server. Thus, we are going to create a small server to act as a proxy between the client (a web browser, app or cURL) and the API in question: the Google Maps Geocoding API.</p><h2 id="why-paperplane-as-a-nodejs-server-framework">Why Paperplane as a Node.js Server Framework?</h2><p>It is possible to do everything you need with Node‚Äôs <code>http</code> package, but I like the approach <a href="https://github.com/articulate/paperplane">paperplane</a> takes with viewing the request and response aspects of handling an HTTP request as a pure function where the request is the input and the response is what is returned from it:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-kt">Request</span> <span class="pl-ow">-&gt;</span> <span class="pl-kt">Response</span></span></span></code></pre><p>whereas many Node frameworks‚Äô handlers accept a function with the request and response as two arguments and not utilizing a return value, yielding the signature:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-p">(</span><span class="pl-kt">IncomingMessage</span><span class="pl-p">,</span> <span class="pl-kt">ServerResponse</span><span class="pl-p">)</span> <span class="pl-ow">-&gt;</span> <span class="pl-nb">()</span></span></span></code></pre><p>The paperplane approach makes a good deal more sense to me. You can read more about the ‚Äúwhy‚Äù on <a href="https://github.com/articulate/paperplane/blob/master/docs/getting-started.md">paperplane‚Äôs getting started guide</a>.</p><h2 id="project-source-code">Project Source Code</h2><p>The project we‚Äôll be making can be seen in its entirety here: <a href="https://github.com/rpearce/geocoding-proxy/">https://github.com/rpearce/geocoding-proxy/</a>.</p><h2 id="pre-requisites">Pre-requisites</h2><p><em>Note: what we‚Äôll be making is by no means a production-level application, as that would be outside the scope of this post. However, there are some slightly advanced tangential topics that I will be glossing over (sometimes providing links to) in order to not write a book. Send me an email if I can be clearer in certain areas.</em></p><p>This tutorial assumes that you already have installed Node.js (I use <a href="https://github.com/creationix/nvm">NVM</a> for managing Node versions and am using <code>v8.1</code>) and optionally the <a href="https://yarnpkg.com/lang/en/docs/install/">yarn package manager</a>.</p><p>Once you‚Äôve got Node and yarn installed, we can begin.</p><h2 id="project-setup">Project Setup</h2><p>From your favorite project folder, let‚Äôs create a new project folder named <code>geocoding-proxy</code> and change the current working directory to be the new folder:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">Œª mkdir geocoding-proxy
</span></span><span class="pl-line"><span class="pl-cl">Œª cd geocoding-proxy</span></span></code></pre><h3 id="installing-dependencies">Installing Dependencies</h3><p>Once we‚Äôre in the project folder, let‚Äôs initialize a <code>package.json</code> file to make it easy to manage and hang on to our project‚Äôs dependencies:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">Œª npm init -y</span></span></code></pre><p>or if you have yarn installed:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">Œª yarn init -y</span></span></code></pre><p>You should now have a <code>package.json</code> file with some JSON values in it.</p><p>Next, let‚Äôs install the tools that we‚Äôre going to use:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">Œª npm install --save axios dotenv paperplane ramda</span></span></code></pre><p>or</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">Œª yarn add axios dotenv paperplane ramda</span></span></code></pre><h3 id="get-a-google-maps-geocoding-api-key">Get A Google Maps Geocoding API Key</h3><p>You can get yourself an API key from <a href="https://developers.google.com/maps/documentation/geocoding/get-api-key">this page</a>. Once you‚Äôve done this, you‚Äôll need to copy the <code>.env.example</code> file at your project‚Äôs root (<code>Œª cp .env.example .env</code>) and replace the value of the <code>GEO_KEY</code> with your API key. Your <code>.env</code> file should look like</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">GEO_KEY=abcdefg-hijklmn-op
</span></span><span class="pl-line"><span class="pl-cl">PORT=5050</span></span></code></pre><h2 id="hello-world-with-paperplane">Hello, World! With Paperplane</h2><p>Once your dependencies are installed, let‚Äôs create a server to see if we can get things working. First, create <code>index.js</code> at your project‚Äôs root and open it in your favorite text editor.</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">Œª touch index.js</span></span></code></pre><p>Next, let‚Äôs import the packages we‚Äôll be using and create a basic ‚ÄúHello, World!‚Äù server:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// Make our .env configuration file available
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-nx">require</span><span class="pl-p">(</span><span class="pl-s1">'dotenv'</span><span class="pl-p">).</span><span class="pl-nx">config</span><span class="pl-p">()</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// Import libraries
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-kr">const</span> <span class="pl-nx">http</span> <span class="pl-o">=</span> <span class="pl-nx">require</span><span class="pl-p">(</span><span class="pl-s1">'http'</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">const</span> <span class="pl-p">{</span> <span class="pl-nx">compose</span> <span class="pl-p">}</span> <span class="pl-o">=</span> <span class="pl-nx">require</span><span class="pl-p">(</span><span class="pl-s1">'ramda'</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">const</span> <span class="pl-p">{</span> <span class="pl-nx">json</span><span class="pl-p">,</span> <span class="pl-nx">logger</span><span class="pl-p">,</span> <span class="pl-nx">methods</span><span class="pl-p">,</span> <span class="pl-nx">mount</span><span class="pl-p">,</span> <span class="pl-nx">parseJson</span><span class="pl-p">,</span> <span class="pl-nx">routes</span> <span class="pl-p">}</span> <span class="pl-o">=</span> <span class="pl-nx">require</span><span class="pl-p">(</span><span class="pl-s1">'paperplane'</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// Application-specific code
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-kr">const</span> <span class="pl-nx">endpoints</span> <span class="pl-o">=</span> <span class="pl-nx">routes</span><span class="pl-p">({</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s1">'/'</span><span class="pl-o">:</span> <span class="pl-nx">methods</span><span class="pl-p">({</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">GET</span><span class="pl-o">:</span> <span class="pl-nx">req</span> <span class="pl-p">=&gt;</span> <span class="pl-p">(</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-nb">Promise</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-p">.</span><span class="pl-nx">resolve</span><span class="pl-p">(</span><span class="pl-s1">'hello world'</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-p">.</span><span class="pl-nx">then</span><span class="pl-p">(</span><span class="pl-nx">json</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">})</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">})</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">const</span> <span class="pl-nx">app</span> <span class="pl-o">=</span> <span class="pl-nx">compose</span><span class="pl-p">(</span><span class="pl-nx">endpoints</span><span class="pl-p">,</span> <span class="pl-nx">parseJson</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// Server options
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-kr">const</span> <span class="pl-nx">opts</span> <span class="pl-o">=</span> <span class="pl-p">{</span> <span class="pl-nx">errLogger</span><span class="pl-o">:</span> <span class="pl-nx">logger</span><span class="pl-p">,</span> <span class="pl-nx">logger</span> <span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">const</span> <span class="pl-nx">port</span> <span class="pl-o">=</span> <span class="pl-nx">process</span><span class="pl-p">.</span><span class="pl-nx">env</span><span class="pl-p">.</span><span class="pl-nx">PORT</span> <span class="pl-o">||</span> <span class="pl-mi">3000</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">const</span> <span class="pl-nx">listening</span> <span class="pl-o">=</span> <span class="pl-nx">err</span> <span class="pl-p">=&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">err</span> <span class="pl-o">?</span> <span class="pl-nx">console</span><span class="pl-p">.</span><span class="pl-nx">error</span><span class="pl-p">(</span><span class="pl-nx">err</span><span class="pl-p">)</span> <span class="pl-o">:</span> <span class="pl-nx">console</span><span class="pl-p">.</span><span class="pl-nx">info</span><span class="pl-p">(</span><span class="pl-sb">`Listening on port: </span><span class="pl-si">${</span><span class="pl-nx">port</span><span class="pl-si">}</span><span class="pl-sb">`</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// Start the server
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-nx">http</span><span class="pl-p">.</span><span class="pl-nx">createServer</span><span class="pl-p">(</span><span class="pl-nx">mount</span><span class="pl-p">(</span><span class="pl-nx">app</span><span class="pl-p">,</span> <span class="pl-nx">opts</span><span class="pl-p">)).</span><span class="pl-nx">listen</span><span class="pl-p">(</span><span class="pl-nx">port</span><span class="pl-p">,</span> <span class="pl-nx">listening</span><span class="pl-p">)</span></span></span></code></pre><p><em>(Read up more on how paperplane works on its <a href="https://github.com/articulate/paperplane/blob/master/docs/getting-started.md">getting started page</a> or by taking a look at <a href="https://github.com/articulate/paperplane/blob/master/demo/index.js">the demo application</a>. Also check out <a href="http://ramdajs.com/docs/#compose">Ramda‚Äôs compose function</a> to learn about effective function composition.)</em></p><p>We can start the server in a terminal window by running</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">Œª node index.js
</span></span><span class="pl-line"><span class="pl-cl">Listening on port: 5050</span></span></code></pre><p>From another terminal window, let‚Äôs use cURL to see if this works:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">Œª curl localhost:5050
</span></span><span class="pl-line"><span class="pl-cl">"hello world"</span></span></code></pre><p>It works!</p><h2 id="hello-location">Hello, Location</h2><p>Now that we know our server works, let‚Äôs see if we can get it to echo back a location/address parameter we send it at a route we‚Äôll create called <code>/geocode</code>. Let‚Äôs remove our <code>'/'</code> endpoint and ‚Äúhello, world!‚Äù code and add some for geocoding:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-kr">const</span> <span class="pl-nx">endpoints</span> <span class="pl-o">=</span> <span class="pl-nx">routes</span><span class="pl-p">({</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s1">'/geocode/:address'</span><span class="pl-o">:</span> <span class="pl-nx">methods</span><span class="pl-p">({</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">GET</span><span class="pl-o">:</span> <span class="pl-nx">req</span> <span class="pl-p">=&gt;</span> <span class="pl-p">(</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-nb">Promise</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-p">.</span><span class="pl-nx">resolve</span><span class="pl-p">(</span><span class="pl-nx">req</span><span class="pl-p">.</span><span class="pl-nx">params</span><span class="pl-p">.</span><span class="pl-nx">address</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-p">.</span><span class="pl-nx">then</span><span class="pl-p">(</span><span class="pl-nx">json</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">})</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">})</span></span></span></code></pre><p>The <code>req</code> object gives us a <code>params</code> object with the key <code>address</code>, since that was what we specified we‚Äôd like our parameter to be named by setting the <code>/geocode/:address</code> key in the <code>routes</code> function argument.</p><p>With the new endpoint added, save the file, restart your server (stop it with <code>Ctrl + C</code>), and run cURL with a city name this time:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">Œª curl localhost:5050/geocode/Auckland
</span></span><span class="pl-line"><span class="pl-cl">"Auckland"</span></span></code></pre><h2 id="sending-to-the-geocoding-api">Sending to the Geocoding API</h2><p>We‚Äôre almost there! Instead of echoing back whatever address the server receives, let‚Äôs instead make an HTTP GET request to the geocode API using the <code>axios</code> package:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-kr">const</span> <span class="pl-nx">endpoints</span> <span class="pl-o">=</span> <span class="pl-nx">routes</span><span class="pl-p">({</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s1">'/geocode/:address'</span><span class="pl-o">:</span> <span class="pl-nx">methods</span><span class="pl-p">({</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">GET</span><span class="pl-o">:</span> <span class="pl-nx">req</span> <span class="pl-p">=&gt;</span> <span class="pl-p">(</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-nx">axios</span><span class="pl-p">({</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-nx">method</span><span class="pl-o">:</span> <span class="pl-s1">'GET'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-nx">url</span><span class="pl-o">:</span> <span class="pl-s1">'https://maps.googleapis.com/maps/api/geocode/json'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-nx">params</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">          <span class="pl-nx">key</span><span class="pl-o">:</span> <span class="pl-nx">process</span><span class="pl-p">.</span><span class="pl-nx">env</span><span class="pl-p">.</span><span class="pl-nx">GEO_KEY</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">          <span class="pl-nx">address</span><span class="pl-o">:</span> <span class="pl-nx">req</span><span class="pl-p">.</span><span class="pl-nx">params</span><span class="pl-p">.</span><span class="pl-nx">address</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-p">})</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-p">.</span><span class="pl-nx">then</span><span class="pl-p">(</span><span class="pl-nx">json</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">})</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">})</span></span></span></code></pre><p>In this code, we are using the JavaScript Promise-based axios tool to create a GET request to the geocode API. Take note of our <code>params</code> object here; since we‚Äôre using the <code>dotenv</code> package and configuring that above, we get access to the <code>GEO_KEY</code> value in our <code>.env</code> file, and we separately get to pass on the <code>address</code> param, as well. When this request is sent, the <code>url</code> will look like:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">https://maps.googleapis.com/maps/api/geocode/json?key=abcdefg&amp;address=Auckland</span></span></code></pre><p>After restarting your server, run <code>Œª curl localhost:5050/geocode/Auckland</code> again.</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">Œª curl localhost:5050/geocode/Auckland
</span></span><span class="pl-line"><span class="pl-cl">{"message":"Converting circular structure to JSON","name":"TypeError"}</span></span></code></pre><p>Uh oh! If we log the axios result, we‚Äôll see a big response object that we don‚Äôt care too much about right now. The only key we want right now from this big response is the <code>data</code> key, so we can use <a href="http://ramdajs.com/docs/#prop">Ramda‚Äôs prop method</a> to simply access this object key and pass its return value down the chain:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// add `prop` to the require statement
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-kr">const</span> <span class="pl-p">{</span> <span class="pl-nx">compose</span><span class="pl-p">,</span> <span class="pl-nx">prop</span> <span class="pl-p">}</span> <span class="pl-o">=</span> <span class="pl-nx">require</span><span class="pl-p">(</span><span class="pl-s1">'ramda'</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">const</span> <span class="pl-nx">endpoints</span> <span class="pl-o">=</span> <span class="pl-nx">routes</span><span class="pl-p">({</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s1">'/geocode/:address'</span><span class="pl-o">:</span> <span class="pl-nx">methods</span><span class="pl-p">({</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">GET</span><span class="pl-o">:</span> <span class="pl-nx">req</span> <span class="pl-p">=&gt;</span> <span class="pl-p">(</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-nx">axios</span><span class="pl-p">({</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-nx">method</span><span class="pl-o">:</span> <span class="pl-s1">'GET'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-nx">url</span><span class="pl-o">:</span> <span class="pl-s1">'https://maps.googleapis.com/maps/api/geocode/json'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-nx">params</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">          <span class="pl-nx">key</span><span class="pl-o">:</span> <span class="pl-nx">process</span><span class="pl-p">.</span><span class="pl-nx">env</span><span class="pl-p">.</span><span class="pl-nx">GEO_KEY</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">          <span class="pl-nx">address</span><span class="pl-o">:</span> <span class="pl-nx">req</span><span class="pl-p">.</span><span class="pl-nx">params</span><span class="pl-p">.</span><span class="pl-nx">address</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-p">})</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-p">.</span><span class="pl-nx">then</span><span class="pl-p">(</span><span class="pl-nx">prop</span><span class="pl-p">(</span><span class="pl-s1">'data'</span><span class="pl-p">))</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-p">.</span><span class="pl-nx">then</span><span class="pl-p">(</span><span class="pl-nx">json</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">})</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">})</span></span></span></code></pre><p>If all the stars have aligned and you restart and rerun the command again, you should see</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">Œª curl localhost:5050/geocode/Auckland
</span></span><span class="pl-line"><span class="pl-cl">{"results":[{"address_components":[{"long_name":"Auckland","short_name":"Auckland","types":["locality","political"]},{"long_name":"Auckland","short_name":"Auckland","types":["administrative_area_level_1","political"]},{"long_name":"New Zealand","short_name":"NZ","types":["country","political"]}],"formatted_address":"Auckland, New Zealand","geometry":{"bounds":{"northeast":{"lat":-36.660571,"lng":175.2871371},"southwest":{"lat":-37.0654751,"lng":174.4438016}},"location":{"lat":-36.8484597,"lng":174.7633315},"location_type":"APPROXIMATE","viewport":{"northeast":{"lat":-36.660571,"lng":175.2871371},"southwest":{"lat":-37.0654751,"lng":174.4438016}}},"place_id":"ChIJ--acWvtHDW0RF5miQ2HvAAU","types":["locality","political"]}],"status":"OK"}</span></span></code></pre><p>Hooray! We now have geocode response data for Auckland like:</p><ul><li><code>"status":"OK"</code></li><li><code>"formatted_address":"Auckland, New Zealand"</code></li><li><code>"location":{"lat":-36.8484597,"lng":174.7633315}</code></li></ul><h2 id="refactoring-the-routes">Refactoring the Routes</h2><p>As you might imagine, having all of the request handling functions inside of paperplane‚Äôs <code>routes</code> function might get difficult to follow and modularize. With that in mind, let‚Äôs first pull the handler function out and into its own function:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-kr">const</span> <span class="pl-nx">geocode</span> <span class="pl-o">=</span> <span class="pl-nx">req</span> <span class="pl-p">=&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">axios</span><span class="pl-p">({</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">method</span><span class="pl-o">:</span> <span class="pl-s1">'GET'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">url</span><span class="pl-o">:</span> <span class="pl-s1">'https://maps.googleapis.com/maps/api/geocode/json'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">params</span><span class="pl-o">:</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-nx">key</span><span class="pl-o">:</span> <span class="pl-nx">process</span><span class="pl-p">.</span><span class="pl-nx">env</span><span class="pl-p">.</span><span class="pl-nx">GEO_KEY</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-nx">address</span><span class="pl-o">:</span> <span class="pl-nx">req</span><span class="pl-p">.</span><span class="pl-nx">params</span><span class="pl-p">.</span><span class="pl-nx">address</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">})</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">.</span><span class="pl-nx">then</span><span class="pl-p">(</span><span class="pl-nx">prop</span><span class="pl-p">(</span><span class="pl-s1">'data'</span><span class="pl-p">))</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">.</span><span class="pl-nx">then</span><span class="pl-p">(</span><span class="pl-nx">json</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">const</span> <span class="pl-nx">endpoints</span> <span class="pl-o">=</span> <span class="pl-nx">routes</span><span class="pl-p">({</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s1">'/geocode/:address'</span><span class="pl-o">:</span> <span class="pl-nx">methods</span><span class="pl-p">({</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">GET</span><span class="pl-o">:</span> <span class="pl-nx">geocode</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">})</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">})</span></span></span></code></pre><p>You could now abstract the <code>geocode</code> function to another file if you wanted to, as well as the object that is passed to routes (think of a routes file that requires in the different handlers it needs).</p><h3 id="leveraging-ramda">Leveraging Ramda</h3><p>We can refactor the code above even further and make it a bit more functional and closer to being <a href="https://lucasmreis.github.io/blog/pointfree-javascript">‚Äúpoint-free‚Äù</a> by including a few Ramda helpers:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-kr">const</span> <span class="pl-p">{</span> <span class="pl-nx">compose</span><span class="pl-p">,</span> <span class="pl-nx">composeP</span><span class="pl-p">,</span> <span class="pl-nx">curryN</span><span class="pl-p">,</span> <span class="pl-nx">path</span><span class="pl-p">,</span> <span class="pl-nx">prop</span> <span class="pl-p">}</span> <span class="pl-o">=</span> <span class="pl-nx">require</span><span class="pl-p">(</span><span class="pl-s1">'ramda'</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// Application-specific code
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-kr">const</span> <span class="pl-nx">getGeocode</span> <span class="pl-o">=</span> <span class="pl-nx">curryN</span><span class="pl-p">(</span><span class="pl-mi">2</span><span class="pl-p">,</span> <span class="pl-p">(</span><span class="pl-nx">key</span><span class="pl-p">,</span> <span class="pl-nx">address</span><span class="pl-p">)</span> <span class="pl-p">=&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">axios</span><span class="pl-p">({</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">method</span><span class="pl-o">:</span> <span class="pl-s1">'GET'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">url</span><span class="pl-o">:</span> <span class="pl-s1">'https://maps.googleapis.com/maps/api/geocode/json'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">params</span><span class="pl-o">:</span> <span class="pl-p">{</span> <span class="pl-nx">key</span><span class="pl-p">,</span> <span class="pl-nx">address</span> <span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">})</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">.</span><span class="pl-nx">then</span><span class="pl-p">(</span><span class="pl-nx">prop</span><span class="pl-p">(</span><span class="pl-s1">'data'</span><span class="pl-p">))</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">})</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">const</span> <span class="pl-nx">geocode</span> <span class="pl-o">=</span> <span class="pl-nx">compose</span><span class="pl-p">(</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">composeP</span><span class="pl-p">(</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">json</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">getGeocode</span><span class="pl-p">(</span><span class="pl-nx">process</span><span class="pl-p">.</span><span class="pl-nx">env</span><span class="pl-p">.</span><span class="pl-nx">GEO_KEY</span><span class="pl-p">),</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">),</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">path</span><span class="pl-p">([</span><span class="pl-s1">'params'</span><span class="pl-p">,</span> <span class="pl-s1">'address'</span><span class="pl-p">])</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">const</span> <span class="pl-nx">endpoints</span> <span class="pl-o">=</span> <span class="pl-nx">routes</span><span class="pl-p">({</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s1">'/geocode/:address'</span><span class="pl-o">:</span> <span class="pl-nx">methods</span><span class="pl-p">({</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">GET</span><span class="pl-o">:</span> <span class="pl-nx">geocode</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">})</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">})</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">const</span> <span class="pl-nx">app</span> <span class="pl-o">=</span> <span class="pl-nx">compose</span><span class="pl-p">(</span><span class="pl-nx">endpoints</span><span class="pl-p">,</span> <span class="pl-nx">parseJson</span><span class="pl-p">)</span></span></span></code></pre><p>This code accomplishes the same goal as before, but now we have accomplished a few things:</p><ol><li>We no longer access <code>req.params.address</code> ‚Äì what happens if any of those returned <code>null</code> or <code>undefined</code>? Instead, we use Ramda‚Äôs <a href="http://ramdajs.com/docs/#path">path helper</a>.</li><li>Ramda‚Äôs <a href="http://ramdajs.com/docs/#compose">compose</a> rears its head again, allowing us to make a chain of functions. However, note the use of <a href="http://ramdajs.com/docs/#composeP">composeP</a>. The <code>getGeocode</code> function returns a <code>Promise</code> thanks to <code>axios</code>, so we need to use <code>composeP</code> to compose our Promise-returning function.</li><li>We can use <a href="http://ramdajs.com/docs/#curryN">currying</a> to accept both <code>key</code> and <code>address</code> parameters at separate times. This is handy, for we could partially apply our <code>key</code> once, store that in a variable and reuse it over and over with different <code>address</code>es.</li><li>We have decoupled the use of paperplane‚Äôs <code>json</code> helper from <code>getGeocode</code> and <code>axios</code>, meaning that function can now be leveraged in other ways instead of being hard-set to JSON.</li></ol><p>If this scares the hell out of you, fear not! Check out <a href="https://egghead.io/instructors/andrew-van-slaars">Andrew van Slaar‚Äôs Ramda lessons on egghead.io</a>, and if you‚Äôre liking what you‚Äôre seeing, <a href="https://github.com/MostlyAdequate/mostly-adequate-guide">Dr.¬†Boolean‚Äôs ‚ÄúMostly Adequate Guide to Functional Programming‚Äù</a>.</p><h2 id="all-of-the-code">All of the Code</h2><p>The project itself can be found at <a href="https://github.com/rpearce/geocoding-proxy">https://github.com/rpearce/geocoding-proxy</a>, but here is our <code>index.js</code> file in its entirety:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// Make our .env configuration file available
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-nx">require</span><span class="pl-p">(</span><span class="pl-s1">'dotenv'</span><span class="pl-p">).</span><span class="pl-nx">config</span><span class="pl-p">()</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// Import libraries
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-kr">const</span> <span class="pl-nx">http</span> <span class="pl-o">=</span> <span class="pl-nx">require</span><span class="pl-p">(</span><span class="pl-s1">'http'</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">const</span> <span class="pl-nx">axios</span> <span class="pl-o">=</span> <span class="pl-nx">require</span><span class="pl-p">(</span><span class="pl-s1">'axios'</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">const</span> <span class="pl-p">{</span> <span class="pl-nx">compose</span><span class="pl-p">,</span> <span class="pl-nx">composeP</span><span class="pl-p">,</span> <span class="pl-nx">curryN</span><span class="pl-p">,</span> <span class="pl-nx">path</span><span class="pl-p">,</span> <span class="pl-nx">prop</span> <span class="pl-p">}</span> <span class="pl-o">=</span> <span class="pl-nx">require</span><span class="pl-p">(</span><span class="pl-s1">'ramda'</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">const</span> <span class="pl-p">{</span> <span class="pl-nx">json</span><span class="pl-p">,</span> <span class="pl-nx">logger</span><span class="pl-p">,</span> <span class="pl-nx">methods</span><span class="pl-p">,</span> <span class="pl-nx">mount</span><span class="pl-p">,</span> <span class="pl-nx">parseJson</span><span class="pl-p">,</span> <span class="pl-nx">routes</span> <span class="pl-p">}</span> <span class="pl-o">=</span> <span class="pl-nx">require</span><span class="pl-p">(</span><span class="pl-s1">'paperplane'</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// Application-specific code
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-kr">const</span> <span class="pl-nx">getGeocode</span> <span class="pl-o">=</span> <span class="pl-nx">curryN</span><span class="pl-p">(</span><span class="pl-mi">2</span><span class="pl-p">,</span> <span class="pl-p">(</span><span class="pl-nx">key</span><span class="pl-p">,</span> <span class="pl-nx">address</span><span class="pl-p">)</span> <span class="pl-p">=&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">axios</span><span class="pl-p">({</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">method</span><span class="pl-o">:</span> <span class="pl-s1">'GET'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">url</span><span class="pl-o">:</span> <span class="pl-s1">'https://maps.googleapis.com/maps/api/geocode/json'</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">params</span><span class="pl-o">:</span> <span class="pl-p">{</span> <span class="pl-nx">key</span><span class="pl-p">,</span> <span class="pl-nx">address</span> <span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">})</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">.</span><span class="pl-nx">then</span><span class="pl-p">(</span><span class="pl-nx">prop</span><span class="pl-p">(</span><span class="pl-s1">'data'</span><span class="pl-p">))</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">const</span> <span class="pl-nx">geocode</span> <span class="pl-o">=</span> <span class="pl-nx">compose</span><span class="pl-p">(</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">composeP</span><span class="pl-p">(</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">json</span><span class="pl-p">,</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">getGeocode</span><span class="pl-p">(</span><span class="pl-nx">process</span><span class="pl-p">.</span><span class="pl-nx">env</span><span class="pl-p">.</span><span class="pl-nx">GEO_KEY</span><span class="pl-p">),</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">),</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">path</span><span class="pl-p">([</span><span class="pl-s1">'params'</span><span class="pl-p">,</span> <span class="pl-s1">'address'</span><span class="pl-p">])</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">const</span> <span class="pl-nx">endpoints</span> <span class="pl-o">=</span> <span class="pl-nx">routes</span><span class="pl-p">({</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-s1">'/geocode/:address'</span><span class="pl-o">:</span> <span class="pl-nx">methods</span><span class="pl-p">({</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nx">GET</span><span class="pl-o">:</span> <span class="pl-nx">geocode</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">})</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">})</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">const</span> <span class="pl-nx">app</span> <span class="pl-o">=</span> <span class="pl-nx">compose</span><span class="pl-p">(</span><span class="pl-nx">endpoints</span><span class="pl-p">,</span> <span class="pl-nx">parseJson</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// Server options
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-kr">const</span> <span class="pl-nx">opts</span> <span class="pl-o">=</span> <span class="pl-p">{</span> <span class="pl-nx">errLogger</span><span class="pl-o">:</span> <span class="pl-nx">logger</span><span class="pl-p">,</span> <span class="pl-nx">logger</span> <span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">const</span> <span class="pl-nx">port</span> <span class="pl-o">=</span> <span class="pl-nx">process</span><span class="pl-p">.</span><span class="pl-nx">env</span><span class="pl-p">.</span><span class="pl-nx">PORT</span> <span class="pl-o">||</span> <span class="pl-mi">3000</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">const</span> <span class="pl-nx">listening</span> <span class="pl-o">=</span> <span class="pl-nx">err</span> <span class="pl-p">=&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-nx">err</span> <span class="pl-o">?</span> <span class="pl-nx">console</span><span class="pl-p">.</span><span class="pl-nx">error</span><span class="pl-p">(</span><span class="pl-nx">err</span><span class="pl-p">)</span> <span class="pl-o">:</span> <span class="pl-nx">console</span><span class="pl-p">.</span><span class="pl-nx">info</span><span class="pl-p">(</span><span class="pl-sb">`Listening on port: </span><span class="pl-si">${</span><span class="pl-nx">port</span><span class="pl-si">}</span><span class="pl-sb">`</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// Start the server
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-nx">http</span><span class="pl-p">.</span><span class="pl-nx">createServer</span><span class="pl-p">(</span><span class="pl-nx">mount</span><span class="pl-p">(</span><span class="pl-nx">app</span><span class="pl-p">,</span> <span class="pl-nx">opts</span><span class="pl-p">)).</span><span class="pl-nx">listen</span><span class="pl-p">(</span><span class="pl-nx">port</span><span class="pl-p">,</span> <span class="pl-nx">listening</span><span class="pl-p">)</span></span></span></code></pre><h2 id="conclusion">Conclusion</h2><p>Tools like Node.js with paperplane make it very easy to create proxy servers to handle your requests in a safe fashion, so use them and always keep your API keys secret!</p><h2 id="update-2017-07-30">Update: 2017-07-30</h2><p>I‚Äôve seen a some feedback asking about CORS (cross-origin resource sharing), so here‚Äôs how you can do it (useful for running things on localhost):</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-kr">const</span> <span class="pl-p">{</span> <span class="pl-nx">cors</span><span class="pl-p">,</span> <span class="pl-p">...</span> <span class="pl-p">}</span> <span class="pl-o">=</span> <span class="pl-nx">require</span><span class="pl-p">(</span><span class="pl-s1">'paperplane'</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// Server options
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-kr">const</span> <span class="pl-nx">corsOpts</span> <span class="pl-o">=</span> <span class="pl-p">{</span> <span class="pl-nx">methods</span><span class="pl-o">:</span> <span class="pl-s1">'GET'</span> <span class="pl-p">}</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">const</span> <span class="pl-nx">corsApp</span> <span class="pl-o">=</span> <span class="pl-nx">cors</span><span class="pl-p">(</span><span class="pl-nx">app</span><span class="pl-p">,</span> <span class="pl-nx">corsOpts</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// ...
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">// Start the server
</span></span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1"></span><span class="pl-nx">http</span><span class="pl-p">.</span><span class="pl-nx">createServer</span><span class="pl-p">(</span><span class="pl-nx">mount</span><span class="pl-p">(</span><span class="pl-nx">corsApp</span><span class="pl-p">,</span> <span class="pl-nx">opts</span><span class="pl-p">)).</span><span class="pl-nx">listen</span><span class="pl-p">(</span><span class="pl-nx">port</span><span class="pl-p">,</span> <span class="pl-nx">listening</span><span class="pl-p">)</span></span></span></code></pre><p>Read more about paperplane‚Äôs CORS API in <a href="https://github.com/articulate/paperplane/blob/master/docs/API.md#cors">paperplane‚Äôs CORS docs</a>.</p></section></main><footer><span aria-hidden="true" class="heart">‚ô•</span><span aria-hidden="true">&rarr;</span><a href="https://github.com/sponsors/rpearce/">Sponsor my work</a><span aria-hidden="true">&larr;</span><span aria-hidden="true" class="heart">‚ô•</span></footer><script async> (() => { const themeEl = document.querySelector('[data-select-theme]'); if (themeEl) { themeEl.querySelector('[value="'+window.site.prefTheme+'"]').selected = 'selected'; themeEl.addEventListener('change', e => { window.site.setTheme(e.target.value); }); } const fontEl = document.querySelector('[data-select-font]'); if (fontEl) { fontEl.querySelector('[value="'+window.site.prefFont+'"]').selected = 'selected'; fontEl.addEventListener('change', e => { window.site.setFont(e.target.value); }) } })(); </script></body></html>