<!DOCTYPE html><html lang="en"><head><title>Hakyll Pt. 3 – Generating RSS and Atom XML Feeds</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Generate rss.xml and atom.xml feeds for your hakyll site."><meta name="author" content="Robert Pearce"><meta name="keywords" content="hakyll, rss, atom, rss.xml, atom.xml, hakyll tutorial, hakyll blog, hakyll blog tutorial, hakyll static site, static site generator"><meta name="google-site-verification" content="QX4bn65yOXBfgnwxlO09yIBc1H8blur-Erx3lmsDVhU"><meta http-equiv="origin-trial" content="Am4BZ0c7GMyB72dgo/Ny2FfIFscXhYMoN+CVe4jduWh24FvsaCwf7kjZzHzfrJXtIilyZVAEKRxOItGLY7lvkAgAAABSeyJvcmlnaW4iOiJodHRwczovL3JvYmVydHdwZWFyY2UuY29tOjQ0MyIsImZlYXR1cmUiOiJQb3J0YWxzIiwiZXhwaXJ5IjoxNjAzNTQ2NDc3fQ=="><meta property="og:site_name" content="Robert Pearce"><meta property="og:title" content="Hakyll Pt. 3 – Generating RSS and Atom XML Feeds"><meta property="og:url" content="https://robertwpearce.com/hakyll-pt-3-generating-rss-and-atom-xml-feeds.html"><meta property="og:description" content="Generate rss.xml and atom.xml feeds for your hakyll site."><meta property="og:type" content="article"><meta property="twitter:site" content="Robert Pearce"><meta property="twitter:title" content="Hakyll Pt. 3 – Generating RSS and Atom XML Feeds"><meta property="twitter:description" content="Generate rss.xml and atom.xml feeds for your hakyll site."><meta property="twitter:creator" content="@RobertWPearce"><link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>💾</text></svg>"><link rel="canonical" href="https://robertwpearce.com/hakyll-pt-3-generating-rss-and-atom-xml-feeds.html"><link rel="alternate" href="./atom.xml" title="Robert Pearce's blog" type="application/atom+xml"><link rel="alternate" href="./rss.xml" title="Robert Pearce's blog" type="application/rss+xml"><link rel="stylesheet" href="./css/base.css"><link rel="stylesheet" href="./css/t-clean.css"><link rel="stylesheet" href="./css/t-clean-note.css"><link rel="stylesheet" href="./css/t-code-dracula.css"><link rel="prefetch" href="./css/t-clean-note.css"></head><body data-theme="clean-night"><script> (() => { window.site = { prefFont: localStorage.getItem('prefFont') || 'monospace', setFont: (family) => { localStorage.setItem('prefFont', family); const rootStyle = document.querySelector(':root').style; rootStyle.setProperty('--type-family-body', family+',monospace'); /* Remove when https://github.com/googlefonts/spacemono/pull/2 is resolved */ if (family === 'Liga Space Mono') { rootStyle.setProperty('font-feature-settings', '"liga" 0'); } else { rootStyle.removeProperty('font-feature-settings'); } return window.site._fetchFont(family); }, prefTheme: localStorage.getItem('prefTheme') || (matchMedia('(prefers-color-scheme: dark)').matches ? 'clean-night' : 'clean-day'), setTheme: (name) => { const rootStyle = document.querySelector(':root').style; if (name === 'clean-night') { rootStyle.removeProperty('color-scheme'); } else { rootStyle.setProperty('color-scheme', 'light'); } document.body.setAttribute('data-theme', name); localStorage.setItem('prefTheme', name); }, _fetchFont: (family) => { if (family === 'monospace') { return Promise.resolve(); } const familyNoSpaces = family.replaceAll(' ', ''); const fontz = [ new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-Regular.woff2") format("woff2")', { display: 'swap', weight: 400 }), new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-Bold.woff2") format("woff2")', { display: 'swap', weight: 700 }), ]; if (family !== 'Fira Code') { fontz.push( new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-Italic.woff2") format("woff2")', { display: 'swap', style: 'italic', weight: 400 }), new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-BoldItalic.woff2") format("woff2")', { display: 'swap', style: 'italic', weight: 700 }) ); } for (const f of fontz) { document.fonts.add(f); } return Promise.allSettled(fontz).then(results => { results.forEach((res, i) => { if (res.status === 'rejected') { console.error('site failed to load font: ' + fontz[i]?.family ?? 'unknown'); } }); }); } }; window.site.setTheme(window.site.prefTheme); window.site.setFont(window.site.prefFont); })(); </script><header><nav><div class="nav-skip"><a href="#content">Skip to content</a></div><a aria-label="Home" class="nav-home" href="./">~</a><span>/</span></nav><div class="header-extra"><a href="./atom.xml">RSS</a><span aria-hidden="true">&compfn;</span><noscript>(requires JS &rarr;)</noscript><label for="select-theme">Theme</label><select data-select-theme id="select-theme"><option value="clean-day">Clean (Day)</option><option value="clean-night">Clean (Night)</option></select><span aria-hidden="true">&compfn;</span><label for="select-font">Font</label><select data-select-font id="select-font"><option value="monospace">monospace</option><option value="Liga Space Mono">Space Mono</option><option value="Victor Mono">Victor Mono</option><option value="Fira Code">Fira Code</option><option value="JetBrains Mono">JetBrains Mono</option></select></div></header><main id="content"><header data-area="heading"><h1>Hakyll Pt. 3 – Generating RSS and Atom XML Feeds</h1></header><section data-area="meta"><h2>Info</h2><table data-type="cols-y"><tbody><tr><th>Summary</th><td>Generate rss.xml and atom.xml feeds for your hakyll site.</td></tr><tr><th>Shared</th><td>2019-01-23</td></tr><tr><th>Revised</th><td>2023-02-11 @ 16:00 UTC</td></tr></tbody></table></section><section data-area="note"><p>This is part 3 of a multipart series where we will look at getting a website / blog set up with <a href="https://jaspervdj.be/hakyll">hakyll</a> and customized a fair bit.</p><ul><li><a href="/hakyll-pt-1-setup-initial-customization.html">Pt. 1 – Setup &amp; Initial Customization</a></li><li><a href="/hakyll-pt-2-generating-a-sitemap-xml-file.html">Pt. 2 – Generating a Sitemap XML File</a></li><li>Pt. 3 – Generating RSS and Atom XML Feeds</li><li><a href="/hakyll-pt-4-copying-static-files-for-your-build.html">Pt. 4 – Copying Static Files For Your Build</a></li><li><a href="/hakyll-pt-5-generating-custom-post-filenames-from-a-title-slug.html">Pt. 5 – Generating Custom Post Filenames From a Title Slug</a></li><li><a href="/hakyll-pt-6-pure-builds-with-nix.html">Pt. 6 – Pure Builds With Nix</a></li><li><a href="/the-hakyll-nix-template-tutorial.html">The hakyll-nix-template Tutorial</a></li></ul><h2 id="overview">Overview</h2><ol><li><a href="#hakyll-feed-required-reading">Hakyll Feed Required Reading</a></li><li><a href="#hakylls-prebuilt-rss--atom-templates">Hakyll’s Prebuilt RSS &amp; Atom Templates</a></li><li><a href="#hakyll-feed-setup">Hakyll Feed Setup</a></li><li><a href="#creating-the-atom-rss-xml-files">Creating the Atom &amp; RSS XML Files</a></li><li><a href="#unexpected-issue-setting-an-updated-field">Unexpected Issue: Setting an <code>updated</code> Field</a></li><li><a href="#using-your-own-rss-atom-templates">Using Your Own RSS &amp; Atom Templates</a></li><li><a href="#validating-and-using-our-feeds">Validating and Using Our Feeds</a></li></ol><h2 id="hakyll-feed-required-reading">Hakyll Feed Required Reading</h2><p>There is already a great starter guide at <a href="https://jaspervdj.be/hakyll/tutorials/05-snapshots-feeds.html" class="uri">https://jaspervdj.be/hakyll/tutorials/05-snapshots-feeds.html</a>, so be sure to read this first – it might make it so you don’t have to read <em>this</em> blog post at all.</p><h2 id="hakylls-prebuilt-rss--atom-templates">Hakyll’s Prebuilt RSS &amp; Atom Templates</h2><p>Thankfully, hakyll aready comes with prebuilt RSS and Atom templates! You can find the source here: <a href="https://github.com/jaspervdj/hakyll/tree/master/data/templates" class="uri">https://github.com/jaspervdj/hakyll/tree/master/data/templates</a>. While you won’t need to copy and paste nor even directly use these files, you should look them over to see what fields they are expecting. There are two levels to be aware of: the feed itself and each individual feed item.</p><h3 id="feed-level">Feed-Level</h3><p>The feed itself is looking for the following, and you’ll provide these through a <code>FeedConfiguration</code> that we’ll discuss in a moment. Here are the fields the <code>atom.xml</code> and <code>rss.xml</code> templates are expecting:</p><ul><li><code>title</code> (title of feed)</li><li><code>description</code> (description of feed)</li><li><code>authorName</code> (feed author name)</li><li><code>authorEmail</code> (feed author email)</li><li><code>root</code> (your website)</li><li><code>updated</code> (feed last updated at; should be done for you)</li><li><code>body</code> (feed body; should be done for you)</li><li><code>url</code> (path to the XML file; based off of a <code>create ["rss.xml"]</code> function that we’ll discuss)</li></ul><h3 id="feed-item-level">Feed Item-Level</h3><p>Each feed item, or <em>entry</em>, expects the following:</p><ul><li><code>title</code> (title of the entry)</li><li><code>root</code> (your website)</li><li><code>url</code> (path to resource)</li><li><code>published</code> (published date; <code>"%Y-%m-%dT%H:%M:%SZ"</code> format; should be done for you via hakyll’s <code>dateField</code> context)</li><li><code>updated</code> (updated date; <code>"%Y-%m-%dT%H:%M:%SZ"</code> format; should be done for you, unless you provide you own)</li></ul><hr /><p>Now that you know what sort of data are expected, let’s begin.</p><h2 id="hakyll-feed-setup">Hakyll Feed Setup</h2><p>As is introduced in <a href="https://jaspervdj.be/hakyll/tutorials/05-snapshots-feeds.html">the required hakyll feed reading</a>, we need to create a <code>FeedConfiguration</code>. If you’d like to see the <code>FeedConfiguration</code> data constructor, you can view it here: <a href="https://github.com/jaspervdj/hakyll/blob/f3a17454fae3b140ada30ebef13f508179f4cd0d/lib/Hakyll/Web/Feed.hs#L63-L75" class="uri">https://github.com/jaspervdj/hakyll/blob/f3a17454fae3b140ada30ebef13f508179f4cd0d/lib/Hakyll/Web/Feed.hs#L63-L75</a>.</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nf">feedConfiguration</span> <span class="pl-ow">::</span> <span class="pl-kt">FeedConfiguration</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nf">feedConfiguration</span> <span class="pl-ow">=</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-kt">FeedConfiguration</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-p">{</span> <span class="pl-n">feedTitle</span>       <span class="pl-ow">=</span> <span class="pl-s">"My Blog"</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-p">,</span> <span class="pl-n">feedDescription</span> <span class="pl-ow">=</span> <span class="pl-s">"Posts about x, y &amp; z"</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-p">,</span> <span class="pl-n">feedAuthorName</span>  <span class="pl-ow">=</span> <span class="pl-s">"My Name"</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-p">,</span> <span class="pl-n">feedAuthorEmail</span> <span class="pl-ow">=</span> <span class="pl-s">"me@myemail.com"</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-p">,</span> <span class="pl-n">feedRoot</span>        <span class="pl-ow">=</span> <span class="pl-s">"https://example.com"</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-p">}</span></span></span></code></pre><p>We should next figure out what we want our “feed context” to consist of. The official hakyll feed guide (linked above) is:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-kr">let</span> <span class="pl-n">feedCtx</span> <span class="pl-ow">=</span> <span class="pl-n">postCtx</span> <span class="pl-p">`</span><span class="pl-n">mappend</span><span class="pl-p">`</span> <span class="pl-n">bodyField</span> <span class="pl-s">"description"</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-c1">-- which can be abbreviated to</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">let</span> <span class="pl-n">feedCtx</span> <span class="pl-ow">=</span> <span class="pl-n">postCtx</span> <span class="pl-o">&lt;&gt;</span> <span class="pl-n">bodyField</span> <span class="pl-s">"description"</span></span></span></code></pre><p>This will enable you to include the body of your post as the <code>description</code>, but if you provide your own <code>description</code> field in your posts, then this step isn’t necessary. For the mean time, let’s make our own <code>feedCtx</code> function that sticks to the original post.</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nf">feedCtx</span> <span class="pl-ow">::</span> <span class="pl-kt">Context</span> <span class="pl-kt">String</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nf">feedCtx</span> <span class="pl-ow">=</span> <span class="pl-n">postCtx</span> <span class="pl-o">&lt;&gt;</span> <span class="pl-n">bodyField</span> <span class="pl-s">"description"</span></span></span></code></pre><p>If you’re unsure of what <code>postCtx</code> is, I recommend checking out the <a href="/hakyll-pt-2-generating-a-sitemap-xml-file.html">previous article</a> or viewing the source of this site: <a href="https://github.com/rpearce/robertwpearce.com/blob/858163216f445eb8b6ab3b4304b022b64814b6f8/site.hs#L131-L136" class="uri">https://github.com/rpearce/robertwpearce.com/blob/858163216f445eb8b6ab3b4304b022b64814b6f8/site.hs#L131-L136</a>.</p><h2 id="creating-the-atom--rss-xml-files">Creating the Atom &amp; RSS XML Files</h2><p>Here is what <a href="https://jaspervdj.be/hakyll/tutorials/05-snapshots-feeds.html">the official hakyll feed guide</a> recommends:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nf">create</span> <span class="pl-p">[</span><span class="pl-s">"atom.xml"</span><span class="pl-p">]</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">route</span> <span class="pl-n">idRoute</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">compile</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-kr">let</span> <span class="pl-n">feedCtx</span> <span class="pl-ow">=</span> <span class="pl-n">postCtx</span> <span class="pl-p">`</span><span class="pl-n">mappend</span><span class="pl-p">`</span> <span class="pl-n">bodyField</span> <span class="pl-s">"description"</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-n">posts</span> <span class="pl-ow">&lt;-</span> <span class="pl-n">fmap</span> <span class="pl-p">(</span><span class="pl-n">take</span> <span class="pl-mi">10</span><span class="pl-p">)</span> <span class="pl-o">.</span> <span class="pl-n">recentFirst</span> <span class="pl-o">=&lt;&lt;</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-n">loadAllSnapshots</span> <span class="pl-s">"posts/*"</span> <span class="pl-s">"content"</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-n">renderAtom</span> <span class="pl-n">myFeedConfiguration</span> <span class="pl-n">feedCtx</span> <span class="pl-n">posts</span></span></span></code></pre><p>This is great! However, if we want to generate both an <code>atom.xml</code> feed and an <code>rss.xml</code> feed, we’ll end up with almost duplicated code:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nf">create</span> <span class="pl-p">[</span><span class="pl-s">"rss.xml"</span><span class="pl-p">]</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">route</span> <span class="pl-n">idRoute</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">compile</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-kr">let</span> <span class="pl-n">feedCtx</span> <span class="pl-ow">=</span> <span class="pl-n">postCtx</span> <span class="pl-p">`</span><span class="pl-n">mappend</span><span class="pl-p">`</span> <span class="pl-n">bodyField</span> <span class="pl-s">"description"</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-n">posts</span> <span class="pl-ow">&lt;-</span> <span class="pl-n">fmap</span> <span class="pl-p">(</span><span class="pl-n">take</span> <span class="pl-mi">10</span><span class="pl-p">)</span> <span class="pl-o">.</span> <span class="pl-n">recentFirst</span> <span class="pl-o">=&lt;&lt;</span>
</span></span><span class="pl-line"><span class="pl-cl">            <span class="pl-n">loadAllSnapshots</span> <span class="pl-s">"posts/*"</span> <span class="pl-s">"content"</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-n">renderRss</span> <span class="pl-n">myFeedConfiguration</span> <span class="pl-n">feedCtx</span> <span class="pl-n">posts</span></span></span></code></pre><p>It looks like all the feed compilation is exactly the same except for the <code>renderAtom</code> and <code>renderRss</code> functions that come bundled with hakyll. With this in mind, let’s write our own feed compiler and reduce as much boilerplate as we reasonably can.</p><p>To start out, let’s see what we want our top-level end result to be:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nf">create</span> <span class="pl-p">[</span><span class="pl-s">"atom.xml"</span><span class="pl-p">]</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">route</span> <span class="pl-n">idRoute</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">compile</span> <span class="pl-p">(</span><span class="pl-n">feedCompiler</span> <span class="pl-n">renderAtom</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nf">create</span> <span class="pl-p">[</span><span class="pl-s">"rss.xml"</span><span class="pl-p">]</span> <span class="pl-o">$</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">route</span> <span class="pl-n">idRoute</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">compile</span> <span class="pl-p">(</span><span class="pl-n">feedCompiler</span> <span class="pl-n">renderRss</span><span class="pl-p">)</span></span></span></code></pre><p>While we could potentially abstract this further, this leaves wiggle room for customizing the <code>route</code> for whatever reason you may want to.</p><p>This <code>feedCompiler</code> is a function that we need to write that will house the missing logic. Let’s look at its type:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nf">feedCompiler</span> <span class="pl-ow">::</span> <span class="pl-kt">FeedConfiguration</span>
</span></span><span class="pl-line"><span class="pl-cl">                <span class="pl-ow">-&gt;</span> <span class="pl-kt">Context</span> <span class="pl-kt">String</span>
</span></span><span class="pl-line"><span class="pl-cl">                <span class="pl-ow">-&gt;</span> <span class="pl-p">[</span><span class="pl-kt">Item</span> <span class="pl-kt">String</span><span class="pl-p">]</span>
</span></span><span class="pl-line"><span class="pl-cl">                <span class="pl-ow">-&gt;</span> <span class="pl-kt">Compiler</span> <span class="pl-p">(</span><span class="pl-kt">Item</span> <span class="pl-kt">String</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">                <span class="pl-ow">-&gt;</span> <span class="pl-kt">Compiler</span> <span class="pl-p">(</span><span class="pl-kt">Item</span> <span class="pl-kt">String</span><span class="pl-p">)</span></span></span></code></pre><p>The first 4 parameters describe the types of both <code>renderAtom</code> and <code>renderRss</code> (they’re the same). For reading’s sake, let’s set those to a type alias called <code>FeedRenderer</code>:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-kr">type</span> <span class="pl-kt">FeedRenderer</span> <span class="pl-ow">=</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-kt">FeedConfiguration</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-ow">-&gt;</span> <span class="pl-kt">Context</span> <span class="pl-kt">String</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-ow">-&gt;</span> <span class="pl-p">[</span><span class="pl-kt">Item</span> <span class="pl-kt">String</span><span class="pl-p">]</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-ow">-&gt;</span> <span class="pl-kt">Compiler</span> <span class="pl-p">(</span><span class="pl-kt">Item</span> <span class="pl-kt">String</span><span class="pl-p">)</span></span></span></code></pre><p>And now we can define our feed but do it in a slightly cleaner way:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nf">feedCompiler</span> <span class="pl-ow">::</span> <span class="pl-kt">FeedRenderer</span> <span class="pl-ow">-&gt;</span> <span class="pl-kt">Compiler</span> <span class="pl-p">(</span><span class="pl-kt">Item</span> <span class="pl-kt">String</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nf">feedCompiler</span> <span class="pl-n">renderer</span> <span class="pl-ow">=</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">renderer</span> <span class="pl-n">feedConfiguration</span> <span class="pl-n">feedCtx</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-o">=&lt;&lt;</span> <span class="pl-n">fmap</span> <span class="pl-p">(</span><span class="pl-n">take</span> <span class="pl-mi">10</span><span class="pl-p">)</span> <span class="pl-o">.</span> <span class="pl-n">recentFirst</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-o">=&lt;&lt;</span> <span class="pl-n">loadAllSnapshots</span> <span class="pl-s">"posts/*"</span> <span class="pl-s">"content"</span></span></span></code></pre><h2 id="using-your-own-rss--atom-templates">Using Your Own RSS &amp; Atom Templates</h2><p>Thanks to <a href="https://abhinavsarkar.net/">Abhinav Sarkar</a> on <a href="https://lobste.rs/s/6pdk3c/hakyll_pt_3_generating_rss_atom_xml_feeds">lobste.rs</a>, I was pointed to a pull request, <a href="https://github.com/jaspervdj/hakyll/pull/652" class="uri">https://github.com/jaspervdj/hakyll/pull/652</a>, that allows hakyll users to use their own feed templates. Here is some example usage from the PR:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nf">customRenderAtom</span> <span class="pl-ow">::</span> <span class="pl-kt">FeedConfiguration</span> <span class="pl-ow">-&gt;</span> <span class="pl-kt">Context</span> <span class="pl-kt">String</span> <span class="pl-ow">-&gt;</span> <span class="pl-p">[</span><span class="pl-kt">Item</span> <span class="pl-kt">String</span><span class="pl-p">]</span> <span class="pl-ow">-&gt;</span> <span class="pl-kt">Compiler</span> <span class="pl-p">(</span><span class="pl-kt">Item</span> <span class="pl-kt">String</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nf">customRenderAtom</span> <span class="pl-n">config</span> <span class="pl-n">context</span> <span class="pl-n">items</span> <span class="pl-ow">=</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-n">atomTemplate</span>     <span class="pl-ow">&lt;-</span> <span class="pl-n">unsafeCompiler</span> <span class="pl-o">$</span> <span class="pl-n">readFile</span> <span class="pl-s">"templates/atom.xml"</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-n">atomItemTemplate</span> <span class="pl-ow">&lt;-</span> <span class="pl-n">unsafeCompiler</span> <span class="pl-o">$</span> <span class="pl-n">readFile</span> <span class="pl-s">"templates/atom-item.xml"</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-n">renderAtomWithTemplates</span> <span class="pl-n">atomTemplate</span> <span class="pl-n">atomItemTemplate</span> <span class="pl-n">config</span> <span class="pl-n">context</span> <span class="pl-n">items</span></span></span></code></pre><h2 id="validating-and-using-our-feeds">Validating and Using Our Feeds</h2><p>If you’ve made it this far and have successfully generated and published your <code>atom.xml</code> and/or <code>rss.xml</code> files, see if they’re valid! Head to <a href="https://validator.w3.org/feed/" class="uri">https://validator.w3.org/feed/</a> and see if yours validate.</p><p>You can check out your new feed in an RSS/Atom feed reader such as the browser plugin <a href="https://nodetics.com/feedbro/">FeedBro</a> or any others.</p><h2 id="unexpected-issue-setting-an-updated-field">Unexpected Issue: Setting an <code>updated</code> Field</h2><p>I ran into a feed validation problem where, in a few posts, I manually set the <code>updated</code> field to a <em>date</em> – not <em>datetime</em> – and thus invalidated my feed. The value <code>2017-06-30</code> needed to be in the <code>"%Y-%m-%dT%H:%M:%SZ"</code> format, or <code>2017-06-30T00:00:00Z</code>. This led me down a rabbit hole that ended in me essentially repurposing the <code>dateField</code> code from hakyll (<a href="https://github.com/jaspervdj/hakyll/blob/c85198d8cb6ce055c788e287c7f2470eac0aad36/lib/Hakyll/Web/Template/Context.hs#L273-L321" class="uri">https://github.com/jaspervdj/hakyll/blob/c85198d8cb6ce055c788e287c7f2470eac0aad36/lib/Hakyll/Web/Template/Context.hs#L273-L321</a>). While I tried to use <code>parseTimeM</code> and <code>formatTime</code> from <a href="https://hackage.haskell.org/package/time-1.9.2/docs/Data-Time-Format.html"><code>Data.Time.Format</code></a> in my own way, I couldn’t make it as simple as I wanted, thus leading to me giving up and using what was already there. Here’s what I did:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-nf">feedCtx</span> <span class="pl-ow">::</span> <span class="pl-kt">Context</span> <span class="pl-kt">String</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nf">feedCtx</span> <span class="pl-ow">=</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">updatedField</span> <span class="pl-o">&lt;&gt;</span> <span class="pl-c1">-- THIS IS NEW</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">postCtx</span>      <span class="pl-o">&lt;&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">bodyField</span> <span class="pl-s">"description"</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nf">updatedField</span> <span class="pl-ow">::</span> <span class="pl-kt">Context</span> <span class="pl-kt">String</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nf">updatedField</span> <span class="pl-ow">=</span> <span class="pl-n">field</span> <span class="pl-s">"updated"</span> <span class="pl-o">$</span> <span class="pl-nf">\</span><span class="pl-n">i</span> <span class="pl-ow">-&gt;</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-kr">let</span> <span class="pl-n">locale</span> <span class="pl-ow">=</span> <span class="pl-n">defaultTimeLocale</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">time</span> <span class="pl-ow">&lt;-</span> <span class="pl-n">getUpdatedUTC</span> <span class="pl-n">locale</span> <span class="pl-o">$</span> <span class="pl-n">itemIdentifier</span> <span class="pl-n">i</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">return</span> <span class="pl-o">$</span> <span class="pl-n">formatTime</span> <span class="pl-n">locale</span> <span class="pl-s">"%Y-%m-%dT%H:%M:%SZ"</span> <span class="pl-n">time</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nf">getUpdatedUTC</span> <span class="pl-ow">::</span> <span class="pl-kt">MonadMetadata</span> <span class="pl-n">m</span> <span class="pl-ow">=&gt;</span> <span class="pl-kt">TimeLocale</span> <span class="pl-ow">-&gt;</span> <span class="pl-kt">Identifier</span> <span class="pl-ow">-&gt;</span> <span class="pl-n">m</span> <span class="pl-kt">Clock</span><span class="pl-o">.</span><span class="pl-kt">UTCTime</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-nf">getUpdatedUTC</span> <span class="pl-n">locale</span> <span class="pl-n">id'</span> <span class="pl-ow">=</span> <span class="pl-kr">do</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">metadata</span> <span class="pl-ow">&lt;-</span> <span class="pl-n">getMetadata</span> <span class="pl-n">id'</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-kr">let</span> <span class="pl-n">tryField</span> <span class="pl-n">k</span> <span class="pl-n">fmt</span> <span class="pl-ow">=</span> <span class="pl-n">lookupString</span> <span class="pl-n">k</span> <span class="pl-n">metadata</span> <span class="pl-o">&gt;&gt;=</span> <span class="pl-n">parseTime'</span> <span class="pl-n">fmt</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">maybe</span> <span class="pl-n">empty'</span> <span class="pl-n">return</span> <span class="pl-o">$</span> <span class="pl-n">msum</span> <span class="pl-p">[</span><span class="pl-n">tryField</span> <span class="pl-s">"updated"</span> <span class="pl-n">fmt</span> <span class="pl-o">|</span> <span class="pl-n">fmt</span> <span class="pl-ow">&lt;-</span> <span class="pl-n">formats</span><span class="pl-p">]</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-kr">where</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">empty'</span>     <span class="pl-ow">=</span> <span class="pl-n">fail</span> <span class="pl-o">$</span> <span class="pl-s">"Hakyll.Web.Template.Context.getUpdatedUTC: "</span> <span class="pl-o">++</span> <span class="pl-s">"could not parse time for "</span> <span class="pl-o">++</span> <span class="pl-n">show</span> <span class="pl-n">id'</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">parseTime'</span> <span class="pl-ow">=</span> <span class="pl-n">parseTimeM</span> <span class="pl-kt">True</span> <span class="pl-n">locale</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-n">formats</span>    <span class="pl-ow">=</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-p">[</span> <span class="pl-s">"%a, %d %b %Y %H:%M:%S %Z"</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-p">,</span> <span class="pl-s">"%Y-%m-%dT%H:%M:%S%Z"</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-p">,</span> <span class="pl-s">"%Y-%m-%d %H:%M:%S%Z"</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-p">,</span> <span class="pl-s">"%Y-%m-%d"</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-p">,</span> <span class="pl-s">"%B %e, %Y %l:%M %p"</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-p">,</span> <span class="pl-s">"%B %e, %Y"</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-p">,</span> <span class="pl-s">"%b %d, %Y"</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-p">]</span></span></span></code></pre><p>Woah! We need to break down what’s happening here.</p><h3 id="feedctx"><code>feedCtx</code></h3><p>The addition to <code>feedCtx</code> is before our <code>postCtx</code> because of the <code>mappend</code> precedence of what comes out of the pipeline with the value <code>updated</code>. We want first rights to transforming the <code>updated</code> field, so it needs to come first.</p><h3 id="updatedfield"><code>updatedField</code></h3><p>This function is a <code>Context</code> that leans on hakyll’s <code>field</code> function to say that we want to work with the <code>updated</code> field and then do some Monad stuff with time. The tl;dr is that we send the field’s current value off in order to get a <code>UTCTime</code> value back, and then we format it to be the way we need it.</p><h3 id="getupdatedutc"><code>getUpdatedUTC</code></h3><p>It’s really not as bad as it looks! The root of this function does two things:</p><ol><li>looks up the the <code>updated</code> value in the metadata</li><li>tries to parse it using a bunch of different formats</li></ol><p>If it can’t do these things, it simply <code>fail</code>s.</p><hr /><p>Yes, I could have simply written my <code>updated</code> field in the correct format. But where’s the fun in that? I would hate for my feed to silently invalidate itself over something so simple!</p><h2 id="wrapping-up">Wrapping Up</h2><p>Whew! We dove in to generating Atom &amp; RSS XML feeds with hakyll, uncovered a nice refactor opportunity via <code>feedCompiler</code>, learned how to validate our feeds and ultimately learned about how a seemingly harmless <code>updated</code> date could prevent us from having a totally valid feed!</p><p>Next up:</p><ul><li><a href="/hakyll-pt-4-copying-static-files-for-your-build.html">Pt. 4 – Copying Static Files For Your Build</a></li><li><a href="/hakyll-pt-5-generating-custom-post-filenames-from-a-title-slug.html">Pt. 5 – Generating Custom Post Filenames From a Title Slug</a></li><li><em>(wip) Pt. 6 – Customizing Markdown Compiler Options</em></li></ul><hr /><p>Thank you for reading! <br /> Robert</p></section></main><footer><span aria-hidden="true" class="heart">♥</span><span aria-hidden="true">&rarr;</span><a href="https://github.com/sponsors/rpearce/">Sponsor my work</a><span aria-hidden="true">&larr;</span><span aria-hidden="true" class="heart">♥</span></footer><script async> (() => { const themeEl = document.querySelector('[data-select-theme]'); if (themeEl) { themeEl.querySelector('[value="'+window.site.prefTheme+'"]').selected = 'selected'; themeEl.addEventListener('change', e => { window.site.setTheme(e.target.value); }); } const fontEl = document.querySelector('[data-select-font]'); if (fontEl) { fontEl.querySelector('[value="'+window.site.prefFont+'"]').selected = 'selected'; fontEl.addEventListener('change', e => { window.site.setFont(e.target.value); }) } })(); </script></body></html>