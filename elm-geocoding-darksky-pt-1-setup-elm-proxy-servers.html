<!DOCTYPE html><html lang="en"><head><title>Elm, Geocoding & DarkSky: Pt. 1 ‚Äì Setup Elm & Proxy Servers</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="In Part 1 we will begin building a small weather forecast app using Elm, Google's Geocoding API and the DarkSky API."><meta name="author" content="Robert Pearce"><meta name="keywords" content="elm, elm tutorial, elmlang, elm geocoding, elm darksky, elm weather, elm functional programming"><meta name="google-site-verification" content="QX4bn65yOXBfgnwxlO09yIBc1H8blur-Erx3lmsDVhU"><meta http-equiv="origin-trial" content="Am4BZ0c7GMyB72dgo/Ny2FfIFscXhYMoN+CVe4jduWh24FvsaCwf7kjZzHzfrJXtIilyZVAEKRxOItGLY7lvkAgAAABSeyJvcmlnaW4iOiJodHRwczovL3JvYmVydHdwZWFyY2UuY29tOjQ0MyIsImZlYXR1cmUiOiJQb3J0YWxzIiwiZXhwaXJ5IjoxNjAzNTQ2NDc3fQ=="><meta property="og:site_name" content="Robert Pearce"><meta property="og:title" content="Elm, Geocoding & DarkSky: Pt. 1 ‚Äì Setup Elm & Proxy Servers"><meta property="og:url" content="https://robertwpearce.com/elm-geocoding-darksky-pt-1-setup-elm-proxy-servers.html"><meta property="og:description" content="In Part 1 we will begin building a small weather forecast app using Elm, Google's Geocoding API and the DarkSky API."><meta property="og:type" content="article"><meta property="twitter:site" content="Robert Pearce"><meta property="twitter:title" content="Elm, Geocoding & DarkSky: Pt. 1 ‚Äì Setup Elm & Proxy Servers"><meta property="twitter:description" content="In Part 1 we will begin building a small weather forecast app using Elm, Google's Geocoding API and the DarkSky API."><meta property="twitter:creator" content="@RobertWPearce"><link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üíæ</text></svg>"><link rel="canonical" href="https://robertwpearce.com/elm-geocoding-darksky-pt-1-setup-elm-proxy-servers.html"><link rel="alternate" href="./atom.xml" title="Robert Pearce's blog" type="application/atom+xml"><link rel="alternate" href="./rss.xml" title="Robert Pearce's blog" type="application/rss+xml"><link rel="stylesheet" href="./css/base.css"><link rel="stylesheet" href="./css/t-clean.css"><link rel="stylesheet" href="./css/t-clean-note.css"><link rel="stylesheet" href="./css/t-code-dracula.css"><link rel="prefetch" href="./css/t-clean-note.css"></head><body data-theme="clean-night"><script> (() => { window.site = { prefFont: localStorage.getItem('prefFont') || 'monospace', setFont: (family) => { localStorage.setItem('prefFont', family); const rootStyle = document.querySelector(':root').style; rootStyle.setProperty('--type-family-body', family+',monospace'); /* Remove when https://github.com/googlefonts/spacemono/pull/2 is resolved */ if (family === 'Liga Space Mono') { rootStyle.setProperty('font-feature-settings', '"liga" 0'); } else { rootStyle.removeProperty('font-feature-settings'); } return window.site._fetchFont(family); }, prefTheme: localStorage.getItem('prefTheme') || (matchMedia('(prefers-color-scheme: dark)').matches ? 'clean-night' : 'clean-day'), setTheme: (name) => { const rootStyle = document.querySelector(':root').style; if (name === 'clean-night') { rootStyle.removeProperty('color-scheme'); } else { rootStyle.setProperty('color-scheme', 'light'); } document.body.setAttribute('data-theme', name); localStorage.setItem('prefTheme', name); }, _fetchFont: (family) => { if (family === 'monospace') { return Promise.resolve(); } const familyNoSpaces = family.replaceAll(' ', ''); const fontz = [ new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-Regular.woff2") format("woff2")', { display: 'swap', weight: 400 }), new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-Bold.woff2") format("woff2")', { display: 'swap', weight: 700 }), ]; if (family !== 'Fira Code') { fontz.push( new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-Italic.woff2") format("woff2")', { display: 'swap', style: 'italic', weight: 400 }), new FontFace(family, 'url("./fonts/'+familyNoSpaces+'-BoldItalic.woff2") format("woff2")', { display: 'swap', style: 'italic', weight: 700 }) ); } for (const f of fontz) { document.fonts.add(f); } return Promise.allSettled(fontz).then(results => { results.forEach((res, i) => { if (res.status === 'rejected') { console.error('site failed to load font: ' + fontz[i]?.family ?? 'unknown'); } }); }); } }; window.site.setTheme(window.site.prefTheme); window.site.setFont(window.site.prefFont); })(); </script><header><nav><div class="nav-skip"><a href="#content">Skip to content</a></div><a aria-label="Home" class="nav-home" href="./">~</a><span>/</span></nav><div class="header-extra"><a href="./atom.xml">RSS</a><span aria-hidden="true">&compfn;</span><noscript>(requires JS &rarr;)</noscript><label for="select-theme">Theme</label><select data-select-theme id="select-theme"><option value="clean-day">Clean (Day)</option><option value="clean-night">Clean (Night)</option></select><span aria-hidden="true">&compfn;</span><label for="select-font">Font</label><select data-select-font id="select-font"><option value="monospace">monospace</option><option value="Liga Space Mono">Space Mono</option><option value="Victor Mono">Victor Mono</option><option value="Fira Code">Fira Code</option><option value="JetBrains Mono">JetBrains Mono</option></select></div></header><main id="content"><header data-area="heading"><h1>Elm, Geocoding & DarkSky: Pt. 1 ‚Äì Setup Elm & Proxy Servers</h1></header><section data-area="meta"><h2>Info</h2><table data-type="cols-y"><tbody><tr><th>Summary</th><td>In Part 1 we will begin building a small weather forecast app using Elm, Google's Geocoding API and the DarkSky API.</td></tr><tr><th>Shared</th><td>2017-07-22</td></tr></tbody></table></section><section data-area="note"><p>This is part 1 of a multipart series where we will be building a small weather forecast app using <a href="http://elm-lang.org/">Elm</a>, <a href="https://developers.google.com/maps/documentation/geocoding/start">Google‚Äôs Geocoding API</a> and the <a href="https://darksky.net/dev/">DarkSky API</a>. Instead of doing everything in one massive post, I‚Äôve broken the steps down into parts of a series. Here is the series plan:</p><ul><li>Pt. 1 ‚Äì Setup Elm &amp; Proxy Servers</li><li><a href="/elm-geocoding-and-darksky-pt-2-geocoding-an-address.html">Pt. 2 ‚Äì Geocoding an Address</a></li><li><a href="/elm-geocoding-and-darksky-pt-3-fetching-the-current-weather.html">Pt. 3 ‚Äì Fetching the Current Weather</a></li><li><a href="/elm-geocoding-and-darksky-pt-4-extracting-our-elm-code.html">Pt. 4 ‚Äì Extracting Our Elm Code</a></li></ul><h2 id="overview">Overview</h2><p>This post will cover setting up <a href="http://elm-lang.org/">Elm</a>, a <a href="/node-js-geocoding-proxy-with-paperplane.html">geocoding proxy</a>, and a <a href="https://github.com/rpearce/DarkSky-proxy/">DarkSky proxy</a>. We‚Äôll need all of these things set up in order to get our weather app to work and not sacrifice our API keys.</p><p>By the end of this post, you will have a ‚ÄúHello, world!‚Äù Elm app with a simple <code>./build</code> command, and you should be able to <code>cURL</code> both your geocoding and DarkSky proxies to receive response data that we will use in the coming lessons.</p><h2 id="project-source-code">Project Source Code</h2><p>The project we‚Äôre making will be broken into parts here (branches will be named for each part): <a href="https://github.com/rpearce/elm-geocoding-darksky/">https://github.com/rpearce/elm-geocoding-darksky/</a>. Be sure to check out the other branches to see the other parts as they become available.</p><p>The code for this part is located in the <code>pt-1</code> branch: <a href="https://github.com/rpearce/elm-geocoding-darksky/tree/pt-1">https://github.com/rpearce/elm-geocoding-darksky/tree/pt-1</a>.</p><h2 id="pre-requisites">Pre-requisites</h2><p>This tutorial assumes that you already have installed Node.js (I use <a href="https://github.com/creationix/nvm">NVM</a> for managing Node versions and am using <code>v8.3</code>).</p><p>Once you‚Äôve got Node installed, we can begin.</p><h2 id="project-setup">Project Setup</h2><p>From your favorite project folder, let‚Äôs create a new project folder named <code>elm-geocoding-darksky</code> and change the current working directory to be the new folder:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">Œª mkdir elm-geocoding-darksky
</span></span><span class="pl-line"><span class="pl-cl">Œª cd elm-geocoding-darksky</span></span></code></pre><h2 id="elm">Elm</h2><h3 id="installing-elm">Installing Elm</h3><p>You can install elm via any of the methods on the <a href="https://guide.elm-lang.org/install.html">elm install page</a> or by one of these methods:</p><ul><li>Homebrew: <code>brew install elm</code></li><li>Node.js: <code>npm i elm -g</code> for a global binary or <code>npm init -y &amp;&amp; npm i elm</code> to create a <code>package.json</code> file and install <code>elm</code> to it; you‚Äôll have to run this latter method via <code>npx elm</code>, as it‚Äôll be looking for the binary in your <code>./node_modules/.bin/</code> directory)</li></ul><h3 id="elm-format">elm-format</h3><p>I‚Äôve found that having a tool re-format my Elm code to an agreed-upon format makes me more efficient and makes it easier for others to read my code. Check out these projects for more on how to do this:</p><ul><li><a href="https://github.com/avh4/elm-format">https://github.com/avh4/elm-format</a></li><li><a href="https://github.com/ElmCast/elm-vim">elm-vim</a></li></ul><h3 id="adding-elm-to-a-webpage">Adding Elm to a Webpage</h3><p>Our goal here is to compile our elm project to an <code>elm.js</code> file and include that on a webpage (which we‚Äôll make in a minute).</p><p>First, let‚Äôs create a <code>src/</code> directory to house our source code and a <code>Main.elm</code> file within it:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">Œª mkdir src
</span></span><span class="pl-line"><span class="pl-cl">Œª touch src/Main.elm</span></span></code></pre><p>Next, we want to install Elm‚Äôs HTML package so that so that we can access its HTML-related functions:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">Œª elm package install elm-lang/html</span></span></code></pre><p>Within the <code>Main.elm</code> file, add the following:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-kn">module </span><span class="pl-nc">Main</span> <span class="pl-nv">exposing</span> <span class="pl-nf">(..)</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kn">import </span><span class="pl-nc">Html</span> <span class="pl-nv">exposing</span> <span class="pl-p">(</span><span class="pl-nv">text</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-kr">main </span><span class="pl-nf">=</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-nv">text</span> <span class="pl-s">"Hello, world!"</span></span></span></code></pre><p>Here, we import the <code>Html</code> package that we installed, specifically expose the <code>text</code> function from it and then use that function to tell Elm that we want some HTML-friendly text.</p><p><em>Note: to learn more about the Elm language and syntax, check out the <a href="https://www.elm-tutorial.org/en/">Elm Tutorial</a>, the <a href="https://egghead.io/courses/start-using-elm-to-build-web-applications">EggHead.io Elm course</a>, subscribe to <a href="https://www.dailydrip.com/topics/elm">DailyDrip‚Äôs Elm Topic</a>, <a href="http://courses.knowthen.com">James Moore‚Äôs Elm Courses</a> or check out <a href="http://exercism.io/languages/elm/about">Elm on exercism.io</a>.</em></p><p>We can then compile this and output it to <code>elm.js</code>:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">Œª elm make src/Main.elm --output=elm.js</span></span></code></pre><p>You should now have a (quite large) file, <code>elm.js</code>, in your project‚Äôs root. We‚Äôre almost done!</p><p>Finally, create a new file, <code>index.html</code>, and add the following to it:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl"><span class="pl-cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">&lt;</span><span class="pl-nt">html</span> <span class="pl-na">lang</span><span class="pl-o">=</span><span class="pl-s">"en"</span><span class="pl-p">&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">&lt;</span><span class="pl-nt">head</span><span class="pl-p">&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">&lt;</span><span class="pl-nt">title</span><span class="pl-p">&gt;</span>Weather<span class="pl-p">&lt;/</span><span class="pl-nt">title</span><span class="pl-p">&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">&lt;</span><span class="pl-nt">meta</span> <span class="pl-na">charset</span><span class="pl-o">=</span><span class="pl-s">"utf-8"</span><span class="pl-p">&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">&lt;</span><span class="pl-nt">meta</span> <span class="pl-na">name</span><span class="pl-o">=</span><span class="pl-s">"viewport"</span> <span class="pl-na">content</span><span class="pl-o">=</span><span class="pl-s">"width=device-width, initial-scale=1"</span><span class="pl-p">&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">&lt;/</span><span class="pl-nt">head</span><span class="pl-p">&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">&lt;</span><span class="pl-nt">body</span><span class="pl-p">&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">&lt;</span><span class="pl-nt">script</span> <span class="pl-na">type</span><span class="pl-o">=</span><span class="pl-s">"text/javascript"</span> <span class="pl-na">src</span><span class="pl-o">=</span><span class="pl-s">"elm.js"</span><span class="pl-p">&gt;&lt;/</span><span class="pl-nt">script</span><span class="pl-p">&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">&lt;</span><span class="pl-nt">script</span><span class="pl-p">&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-p">(</span><span class="pl-kd">function</span><span class="pl-p">(</span><span class="pl-nx">global</span><span class="pl-p">)</span> <span class="pl-p">{</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-kd">var</span> <span class="pl-nx">node</span> <span class="pl-o">=</span> <span class="pl-nb">document</span><span class="pl-p">.</span><span class="pl-nx">createElement</span><span class="pl-p">(</span><span class="pl-s1">'div'</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-nb">document</span><span class="pl-p">.</span><span class="pl-nx">body</span><span class="pl-p">.</span><span class="pl-nx">appendChild</span><span class="pl-p">(</span><span class="pl-nx">node</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-kd">var</span> <span class="pl-nx">app</span> <span class="pl-o">=</span> <span class="pl-nx">Elm</span><span class="pl-p">.</span><span class="pl-nx">Main</span><span class="pl-p">.</span><span class="pl-nx">embed</span><span class="pl-p">(</span><span class="pl-nx">node</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">        <span class="pl-nx">global</span><span class="pl-p">.</span><span class="pl-nx">app</span> <span class="pl-o">=</span> <span class="pl-nx">app</span>
</span></span><span class="pl-line"><span class="pl-cl">      <span class="pl-p">})(</span><span class="pl-nb">window</span><span class="pl-p">)</span>
</span></span><span class="pl-line"><span class="pl-cl">    <span class="pl-p">&lt;/</span><span class="pl-nt">script</span><span class="pl-p">&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl">  <span class="pl-p">&lt;/</span><span class="pl-nt">body</span><span class="pl-p">&gt;</span>
</span></span><span class="pl-line"><span class="pl-cl"><span class="pl-p">&lt;/</span><span class="pl-nt">html</span><span class="pl-p">&gt;</span></span></span></code></pre><p>If you run <code>Œª open index.html</code>, you should be able to view the file in the browser and see <code>Hello, world!</code>. Congrats! You‚Äôre primed and ready to start building.</p><h3 id="creating-a-build-file">Creating a Build File</h3><p>If you‚Äôre lazy like me, you can create an executable file, <code>build</code>, that will perform our <code>elm make ...</code> command for us:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">Œª touch build
</span></span><span class="pl-line"><span class="pl-cl">Œª chmod +x build
</span></span><span class="pl-line"><span class="pl-cl">Œª cat &lt;&lt;EOF &gt; ./build
</span></span><span class="pl-line"><span class="pl-cl">#!/bin/bash
</span></span><span class="pl-line"><span class="pl-cl">
</span></span><span class="pl-line"><span class="pl-cl">elm-make src/Main.elm --output ./elm.js
</span></span><span class="pl-line"><span class="pl-cl">EOF</span></span></code></pre><p>This executable can now handle whatever build options and processes we‚Äôll add for the future (such as JavaScript minification &amp; uglifying):</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">Œª ./build
</span></span><span class="pl-line"><span class="pl-cl">Success! Compiled 1 module.
</span></span><span class="pl-line"><span class="pl-cl">Successfully generated ./elm.js</span></span></code></pre><h2 id="proxies">Proxies</h2><p>In order to not expose our API keys for geocoding and weather forecasts, we‚Äôll be using a separate proxy server for each service. I wrote recently wrote a post entitled <a href="/node-js-geocoding-proxy-with-paperplane.html">Node.js Geocoding Proxy with Paperplane</a> where you can see a full explanation of what we‚Äôre doing and how to do it. If you don‚Äôt care about the how and why about setting up these little servers, then just continue on!</p><h3 id="setting-up-your-geocoding-proxy">Setting Up Your Geocoding Proxy</h3><p>First, you‚Äôll need to get a Google Maps API Key from here: <a href="https://developers.google.com/maps/documentation/geocoding/start#get-a-key">https://developers.google.com/maps/documentation/geocoding/start#get-a-key</a>.</p><p>Once you‚Äôve done that, go ahead and clone or download <a href="https://github.com/rpearce/geocoding-proxy">the geocoding-proxy project on GitHub</a> and follow the directions to get set up. Given you‚Äôve got Node installed, you‚Äôve copied over the <code>.env</code> file and set your API key in there, then running <code>Œª node index.js</code> should start the server. From another command-line tab, run this and see if you get a similar result:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">Œª curl localhost:5050/geocode/Auckland
</span></span><span class="pl-line"><span class="pl-cl">{"results":[...]}</span></span></code></pre><p>If so, congrats! If you get stuck, create an issue on the <a href="https://github.com/rpearce/geocoding-proxy/issues">geocoding-proxy issues page</a>, and I‚Äôll see if I can help.</p><h3 id="setting-up-your-darksky-proxy">Setting Up Your DarkSky Proxy</h3><p>(This is almost exactly like the geocoding proxy setup.)</p><p>First, you‚Äôll need to get a DarkSky API Key from here: <a href="https://darksky.net/dev/">https://darksky.net/dev/</a>.</p><p>Once you‚Äôve done that, go ahead and clone or download <a href="https://github.com/rpearce/DarkSky-proxy">the DarkSky-proxy project on GitHub</a> and follow the directions to get set up. Given you‚Äôve got Node installed, you‚Äôve copied over the <code>.env</code> file and set your API key in there, then running <code>Œª node index.js</code> should start the server. From another command-line tab, run this and see if you get a similar result:</p><pre class="pl-chroma"><code><span class="pl-line"><span class="pl-cl">Œª curl http://localhost:5051/forecast/37.8267,-122.4233
</span></span><span class="pl-line"><span class="pl-cl">{"latitude":37.8267,"longitude":-122.4233,...}</span></span></code></pre><p>If so, congrats! If you get stuck, create an issue on the <a href="https://github.com/rpearce/DarkSky-proxy/issues">DarkSky-proxy issues page</a>, and I‚Äôll see if I can help.</p><h2 id="wrapping-up">Wrapping Up</h2><p>Thank you for reading this far! Now that we‚Äôve got our Elm app build process set up and your proxy servers ready to work, we can start constructing our application piece-by-piece in the next article in the series.</p><p>If you‚Äôd like to be notified of when articles are published, subscribe!</p><p>Until next time, <br> Robert</p></section></main><footer><span aria-hidden="true" class="heart">‚ô•</span><span aria-hidden="true">&rarr;</span><a href="https://github.com/sponsors/rpearce/">Sponsor my work</a><span aria-hidden="true">&larr;</span><span aria-hidden="true" class="heart">‚ô•</span></footer><script async> (() => { const themeEl = document.querySelector('[data-select-theme]'); if (themeEl) { themeEl.querySelector('[value="'+window.site.prefTheme+'"]').selected = 'selected'; themeEl.addEventListener('change', e => { window.site.setTheme(e.target.value); }); } const fontEl = document.querySelector('[data-select-font]'); if (fontEl) { fontEl.querySelector('[value="'+window.site.prefFont+'"]').selected = 'selected'; fontEl.addEventListener('change', e => { window.site.setFont(e.target.value); }) } })(); </script></body></html>